
<html>
<head>
<title>verification/cbmc/aws-c-common/include/aws/common/ring_buffer.h</title>
<link rel="stylesheet" type="text/css" href="../../../../../../viewer.css">
</head>

<body>
<div class="code">
<div id="1" class="line none">    1 #ifndef <a href="ring_buffer.h.html#2">AWS_COMMON_RING_BUFFER_H</a></div><div id="2" class="line none">    2 #define <a href="ring_buffer.h.html#2">AWS_COMMON_RING_BUFFER_H</a></div><div id="3" class="line none">    3 /**</div><div id="4" class="line none">    4  * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.</div><div id="5" class="line none">    5  * SPDX-License-Identifier: Apache-2.0.</div><div id="6" class="line none">    6  */</div><div id="7" class="line none">    7 </div><div id="8" class="line none">    8 #include &lt;aws/common/atomics.h&gt;</div><div id="9" class="line none">    9 </div><div id="10" class="line none">   10 /**</div><div id="11" class="line none">   11  * Lockless ring buffer implementation that is thread safe assuming a single thread acquires and a single thread</div><div id="12" class="line none">   12  * releases. For any other use case (other than the single-threaded use-case), you must manage thread-safety manually.</div><div id="13" class="line none">   13  *</div><div id="14" class="line none">   14  * Also, a very important note: release must happen in the same order as acquire. If you do not your application, and</div><div id="15" class="line none">   15  * possibly computers within a thousand mile radius, may die terrible deaths, and the local drinking water will be</div><div id="16" class="line none">   16  * poisoned for generations with fragments of what is left of your radioactive corrupted memory.</div><div id="17" class="line none">   17  */</div><div id="18" class="line none">   18 struct <a href="ring_buffer.h.html#18">aws_ring_buffer</a> {</div><div id="19" class="line none">   19     struct <a href="allocator.h.html#15">aws_allocator</a> *<a href="ring_buffer.h.html#19">allocator</a>;</div><div id="20" class="line none">   20     uint8_t *<a href="ring_buffer.h.html#20">allocation</a>;</div><div id="21" class="line none">   21     struct <a href="atomics.h.html#16">aws_atomic_var</a> <a href="linked_list.h.html#19">head</a>;</div><div id="22" class="line none">   22     struct <a href="atomics.h.html#16">aws_atomic_var</a> <a href="linked_list.h.html#20">tail</a>;</div><div id="23" class="line none">   23     uint8_t *<a href="ring_buffer.h.html#23">allocation_end</a>;</div><div id="24" class="line none">   24 };</div><div id="25" class="line none">   25 </div><div id="26" class="line none">   26 struct <a href="byte_buf.h.html#25">aws_byte_buf</a>;</div><div id="27" class="line none">   27 </div><div id="28" class="line none">   28 AWS_EXTERN_C_BEGIN</div><div id="29" class="line none">   29 </div><div id="30" class="line none">   30 /**</div><div id="31" class="line none">   31  * Initializes a ring buffer with an allocation of size `size`. Returns AWS_OP_SUCCESS on a successful initialization,</div><div id="32" class="line none">   32  * AWS_OP_ERR otherwise.</div><div id="33" class="line none">   33  */</div><div id="34" class="line none">   34 AWS_COMMON_API int aws_ring_buffer_init(struct <a href="ring_buffer.h.html#18">aws_ring_buffer</a> *ring_buf, struct <a href="allocator.h.html#15">aws_allocator</a> *<a href="ring_buffer.h.html#19">allocator</a>, size_t <a href="private/hash_table_impl.h.html#35">size</a>);</div><div id="35" class="line none">   35 </div><div id="36" class="line none">   36 /*</div><div id="37" class="line none">   37  * Checks whether atomic_ptr correctly points to a memory location within the bounds of the aws_ring_buffer</div><div id="38" class="line none">   38  */</div><div id="39" class="line none">   39 AWS_STATIC_IMPL bool <a href="ring_buffer.inl.html#14">aws_ring_buffer_check_atomic_ptr</a>(</div><div id="40" class="line none">   40     const struct <a href="ring_buffer.h.html#18">aws_ring_buffer</a> *ring_buf,</div><div id="41" class="line none">   41     const uint8_t *atomic_ptr);</div><div id="42" class="line none">   42 /**</div><div id="43" class="line none">   43  * Checks whether the ring buffer is empty</div><div id="44" class="line none">   44  */</div><div id="45" class="line none">   45 AWS_STATIC_IMPL bool <a href="ring_buffer.inl.html#23">aws_ring_buffer_is_empty</a>(const struct <a href="ring_buffer.h.html#18">aws_ring_buffer</a> *ring_buf);</div><div id="46" class="line none">   46 </div><div id="47" class="line none">   47 /**</div><div id="48" class="line none">   48  * Evaluates the set of properties that define the shape of all valid aws_ring_buffer structures.</div><div id="49" class="line none">   49  * It is also a cheap check, in the sense it run in constant time (i.e., no loops or recursion).</div><div id="50" class="line none">   50  */</div><div id="51" class="line none">   51 AWS_STATIC_IMPL bool <a href="ring_buffer.inl.html#33">aws_ring_buffer_is_valid</a>(const struct <a href="ring_buffer.h.html#18">aws_ring_buffer</a> *ring_buf);</div><div id="52" class="line none">   52 </div><div id="53" class="line none">   53 /**</div><div id="54" class="line none">   54  * Cleans up the ring buffer's resources.</div><div id="55" class="line none">   55  */</div><div id="56" class="line none">   56 AWS_COMMON_API void aws_ring_buffer_clean_up(struct <a href="ring_buffer.h.html#18">aws_ring_buffer</a> *ring_buf);</div><div id="57" class="line none">   57 </div><div id="58" class="line none">   58 /**</div><div id="59" class="line none">   59  * Attempts to acquire `requested_size` buffer and stores the result in `dest` if successful. Returns AWS_OP_SUCCESS if</div><div id="60" class="line none">   60  * the requested size was available for use, AWS_OP_ERR otherwise.</div><div id="61" class="line none">   61  */</div><div id="62" class="line none">   62 AWS_COMMON_API int aws_ring_buffer_acquire(</div><div id="63" class="line none">   63     struct <a href="ring_buffer.h.html#18">aws_ring_buffer</a> *ring_buf,</div><div id="64" class="line none">   64     size_t requested_size,</div><div id="65" class="line none">   65     struct <a href="byte_buf.h.html#25">aws_byte_buf</a> *dest);</div><div id="66" class="line none">   66 </div><div id="67" class="line none">   67 /**</div><div id="68" class="line none">   68  * Attempts to acquire `requested_size` buffer and stores the result in `dest` if successful. If not available, it will</div><div id="69" class="line none">   69  * attempt to acquire anywhere from 1 byte to `requested_size`. Returns AWS_OP_SUCCESS if some buffer space is available</div><div id="70" class="line none">   70  * for use, AWS_OP_ERR otherwise.</div><div id="71" class="line none">   71  */</div><div id="72" class="line none">   72 AWS_COMMON_API int aws_ring_buffer_acquire_up_to(</div><div id="73" class="line none">   73     struct <a href="ring_buffer.h.html#18">aws_ring_buffer</a> *ring_buf,</div><div id="74" class="line none">   74     size_t minimum_size,</div><div id="75" class="line none">   75     size_t requested_size,</div><div id="76" class="line none">   76     struct <a href="byte_buf.h.html#25">aws_byte_buf</a> *dest);</div><div id="77" class="line none">   77 </div><div id="78" class="line none">   78 /**</div><div id="79" class="line none">   79  * Releases `buf` back to the ring buffer for further use. RELEASE MUST HAPPEN in the SAME ORDER AS ACQUIRE.</div><div id="80" class="line none">   80  * If you do not, your application, and possibly computers within a thousand mile radius, may die terrible deaths,</div><div id="81" class="line none">   81  * and the local drinking water will be poisoned for generations</div><div id="82" class="line none">   82  * with fragments of what is left of your radioactive corrupted memory.</div><div id="83" class="line none">   83  */</div><div id="84" class="line none">   84 AWS_COMMON_API void aws_ring_buffer_release(struct <a href="ring_buffer.h.html#18">aws_ring_buffer</a> *ring_buffer, struct <a href="byte_buf.h.html#25">aws_byte_buf</a> *buf);</div><div id="85" class="line none">   85 </div><div id="86" class="line none">   86 /**</div><div id="87" class="line none">   87  * Returns true if the memory in `buf` was vended by this ring buffer, false otherwise.</div><div id="88" class="line none">   88  * Make sure `buf-&gt;buffer` and `ring_buffer-&gt;allocation` refer to the same memory region.</div><div id="89" class="line none">   89  */</div><div id="90" class="line none">   90 AWS_COMMON_API bool aws_ring_buffer_buf_belongs_to_pool(</div><div id="91" class="line none">   91     const struct <a href="ring_buffer.h.html#18">aws_ring_buffer</a> *ring_buffer,</div><div id="92" class="line none">   92     const struct <a href="byte_buf.h.html#25">aws_byte_buf</a> *buf);</div><div id="93" class="line none">   93 </div><div id="94" class="line none">   94 /**</div><div id="95" class="line none">   95  * Initializes the supplied allocator to be based on the provided ring buffer. Allocations must be allocated</div><div id="96" class="line none">   96  * and freed in the same order, or the ring buffer will assert.</div><div id="97" class="line none">   97  */</div><div id="98" class="line none">   98 AWS_COMMON_API int aws_ring_buffer_allocator_init(struct <a href="allocator.h.html#15">aws_allocator</a> *<a href="ring_buffer.h.html#19">allocator</a>, struct <a href="ring_buffer.h.html#18">aws_ring_buffer</a> *ring_buffer);</div><div id="99" class="line none">   99 </div><div id="100" class="line none">  100 /**</div><div id="101" class="line none">  101  * Cleans up a ring buffer allocator instance. Does not clean up the ring buffer.</div><div id="102" class="line none">  102  */</div><div id="103" class="line none">  103 AWS_COMMON_API void aws_ring_buffer_allocator_clean_up(struct <a href="allocator.h.html#15">aws_allocator</a> *<a href="ring_buffer.h.html#19">allocator</a>);</div><div id="104" class="line none">  104 </div><div id="105" class="line none">  105 #ifndef AWS_NO_STATIC_IMPL</div><div id="106" class="line none">  106 #    include &lt;aws/common/ring_buffer.inl&gt;</div><div id="107" class="line none">  107 #endif /* AWS_NO_STATIC_IMPL */</div><div id="108" class="line none">  108 </div><div id="109" class="line none">  109 AWS_EXTERN_C_END</div><div id="110" class="line none">  110 </div><div id="111" class="line none">  111 #endif /* AWS_COMMON_RING_BUFFER_H */</div>
</div>
</body>
</html>
