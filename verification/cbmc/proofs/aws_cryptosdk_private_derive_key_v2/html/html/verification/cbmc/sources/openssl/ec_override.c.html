
<html>
<head>
<title>verification/cbmc/sources/openssl/ec_override.c</title>
<link rel="stylesheet" type="text/css" href="../../../../viewer.css">
</head>

<body>
<div class="code">
<div id="1" class="line none">    1 /*</div><div id="2" class="line none">    2  * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.</div><div id="3" class="line none">    3  *</div><div id="4" class="line none">    4  * Licensed under the Apache License, Version 2.0 (the "License").</div><div id="5" class="line none">    5  * You may not use this file except in compliance with the License.</div><div id="6" class="line none">    6  * A copy of the License is located at</div><div id="7" class="line none">    7  *</div><div id="8" class="line none">    8  *  http://aws.amazon.com/apache2.0</div><div id="9" class="line none">    9  *</div><div id="10" class="line none">   10  * or in the "license" file accompanying this file. This file is distributed</div><div id="11" class="line none">   11  * on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either</div><div id="12" class="line none">   12  * express or implied. See the License for the specific language governing</div><div id="13" class="line none">   13  * permissions and limitations under the License.</div><div id="14" class="line none">   14  */</div><div id="15" class="line none">   15 </div><div id="16" class="line none">   16 #include &lt;limits.h&gt;</div><div id="17" class="line none">   17 </div><div id="18" class="line none">   18 #include &lt;bn_utils.h&gt;</div><div id="19" class="line none">   19 #include &lt;ec_utils.h&gt;</div><div id="20" class="line none">   20 #include &lt;openssl/ec.h&gt;</div><div id="21" class="line none">   21 #include &lt;openssl/objects.h&gt;</div><div id="22" class="line none">   22 </div><div id="23" class="line none">   23 #include &lt;proof_helpers/nondet.h&gt;</div><div id="24" class="line none">   24 #include &lt;proof_helpers/proof_allocators.h&gt;</div><div id="25" class="line none">   25 </div><div id="26" class="line none">   26 /* Abstraction of the EC_GROUP struct */</div><div id="27" class="line none">   27 struct <a href="../../include/openssl/ec.h.html#38">ec_group_st</a> {</div><div id="28" class="line none">   28     int <a href="ec_override.c.html#28">curve_name</a>;</div><div id="29" class="line none">   29     <a href="../../include/openssl/ec.h.html#36">point_conversion_form_t</a> <a href="ec_override.c.html#29">asn1_form</a>;</div><div id="30" class="line none">   30     <a href="../../include/openssl/ossl_typ.h.html#31">BIGNUM</a> *<a href="ec_override.c.html#30">order</a>;</div><div id="31" class="line none">   31 };</div><div id="32" class="line none">   32 </div><div id="33" class="line none">   33 /*</div><div id="34" class="line none">   34  * Description: In order to construct a builtin curve use the function EC_GROUP_new_by_curve_name and provide the nid of</div><div id="35" class="line none">   35  * the curve to be constructed. Return values: All EC_GROUP_new* functions return a pointer to the newly constructed</div><div id="36" class="line none">   36  * group, or NULL on error.</div><div id="37" class="line none">   37  */</div><div id="38" class="line none">   38 <a href="../../include/openssl/ec.h.html#38">EC_GROUP</a> *<a href="ec_override.c.html#38">EC_GROUP_new_by_curve_name</a>(int nid) {</div><div id="39" class="line none">   39     assert(nid == <a href="../../include/openssl/objects.h.html#21">NID_X9_62_prime256v1</a> || nid == <a href="../../include/openssl/objects.h.html#22">NID_secp384r1</a>);</div><div id="40" class="line none">   40 </div><div id="41" class="line none">   41     <a href="../../include/openssl/ec.h.html#38">EC_GROUP</a> *<a href="ec_override.c.html#83">group</a> = <a href="../../aws-c-common/verification/cbmc/sources/proof_allocators.c.html#76">can_fail_malloc</a>(sizeof(<a href="../../include/openssl/ec.h.html#38">EC_GROUP</a>));</div><div id="42" class="line none">   42 </div><div id="43" class="line none">   43     if (<a href="ec_override.c.html#83">group</a>) {</div><div id="44" class="line none">   44         <a href="ec_override.c.html#83">group</a>-&gt;<a href="ec_override.c.html#28">curve_name</a> = nid;</div><div id="45" class="line none">   45         <a href="ec_override.c.html#83">group</a>-&gt;<a href="ec_override.c.html#29">asn1_form</a>  = <a href="../../include/openssl/ec.h.html#32">POINT_CONVERSION_UNCOMPRESSED</a>;</div><div id="46" class="line none">   46         <a href="ec_override.c.html#83">group</a>-&gt;<a href="ec_override.c.html#30">order</a>      = <a href="bn_override.c.html#96">bignum_nondet_alloc</a>();</div><div id="47" class="line none">   47         __CPROVER_assume(<a href="bn_override.c.html#92">bignum_is_valid</a>(<a href="ec_override.c.html#83">group</a>-&gt;<a href="ec_override.c.html#30">order</a>));</div><div id="48" class="line none">   48     }</div><div id="49" class="line none">   49 </div><div id="50" class="line none">   50     return <a href="ec_override.c.html#83">group</a>;</div><div id="51" class="line none">   51 }</div><div id="52" class="line none">   52 </div><div id="53" class="line none">   53 /*</div><div id="54" class="line none">   54  * Description: The functions EC_GROUP_set_point_conversion_form and EC_GROUP_get_point_conversion_form set and get the</div><div id="55" class="line none">   55  * point_conversion_form for the curve respectively.</div><div id="56" class="line none">   56  */</div><div id="57" class="line none">   57 void <a href="ec_override.c.html#57">EC_GROUP_set_point_conversion_form</a>(<a href="../../include/openssl/ec.h.html#38">EC_GROUP</a> *<a href="ec_override.c.html#83">group</a>, <a href="../../include/openssl/ec.h.html#36">point_conversion_form_t</a> form) {</div><div id="58" class="line none">   58     assert(<a href="ec_override.c.html#83">group</a>);</div><div id="59" class="line none">   59     <a href="ec_override.c.html#83">group</a>-&gt;<a href="ec_override.c.html#29">asn1_form</a> = form;</div><div id="60" class="line none">   60 }</div><div id="61" class="line none">   61 </div><div id="62" class="line none">   62 /*</div><div id="63" class="line none">   63  * Return values: EC_GROUP_get0_order() returns an internal pointer to the group order.</div><div id="64" class="line none">   64  */</div><div id="65" class="line none">   65 const <a href="../../include/openssl/ossl_typ.h.html#31">BIGNUM</a> *<a href="ec_override.c.html#65">EC_GROUP_get0_order</a>(const <a href="../../include/openssl/ec.h.html#38">EC_GROUP</a> *<a href="ec_override.c.html#83">group</a>) {</div><div id="66" class="line none">   66     assert(<a href="ec_override.c.html#381">ec_group_is_valid</a>(<a href="ec_override.c.html#83">group</a>));</div><div id="67" class="line none">   67     return <a href="ec_override.c.html#83">group</a>-&gt;<a href="ec_override.c.html#30">order</a>;</div><div id="68" class="line none">   68 }</div><div id="69" class="line none">   69 </div><div id="70" class="line none">   70 /*</div><div id="71" class="line none">   71  * Description: EC_GROUP_free frees the memory associated with the EC_GROUP. If group is NULL nothing is done.</div><div id="72" class="line none">   72  */</div><div id="73" class="line none">   73 void <a href="ec_override.c.html#73">EC_GROUP_free</a>(<a href="../../include/openssl/ec.h.html#38">EC_GROUP</a> *<a href="ec_override.c.html#83">group</a>) {</div><div id="74" class="line none">   74     if (<a href="ec_override.c.html#83">group</a>) {</div><div id="75" class="line none">   75         <a href="bn_override.c.html#77">BN_free</a>(<a href="ec_override.c.html#83">group</a>-&gt;<a href="ec_override.c.html#30">order</a>);</div><div id="76" class="line none">   76         free(<a href="ec_override.c.html#83">group</a>);</div><div id="77" class="line none">   77     }</div><div id="78" class="line none">   78 }</div><div id="79" class="line none">   79 </div><div id="80" class="line none">   80 /* Abstraction of the EC_KEY struct */</div><div id="81" class="line none">   81 struct <a href="../../include/openssl/ossl_typ.h.html#33">ec_key_st</a> {</div><div id="82" class="line none">   82     int <a href="ec_override.c.html#82">references</a>;</div><div id="83" class="line none">   83     <a href="../../include/openssl/ec.h.html#38">EC_GROUP</a> *<a href="ec_override.c.html#83">group</a>;</div><div id="84" class="line none">   84     <a href="../../include/openssl/ec.h.html#36">point_conversion_form_t</a> <a href="ec_override.c.html#84">conv_form</a>;</div><div id="85" class="line none">   85     <a href="../../include/openssl/ossl_typ.h.html#31">BIGNUM</a> *<a href="ec_override.c.html#85">priv_key</a>;</div><div id="86" class="line none">   86     bool <a href="ec_override.c.html#86">pub_key_is_set</a>;  // We never have to return a public-key object, so just having this flag is enough</div><div id="87" class="line none">   87 };</div><div id="88" class="line none">   88 </div><div id="89" class="line none">   89 /*</div><div id="90" class="line none">   90  * Description: A new EC_KEY with no associated curve can be constructed by calling EC_KEY_new(). The reference count</div><div id="91" class="line none">   91  * for the newly created EC_KEY is initially set to 1. Return value: EC_KEY_new(), EC_KEY_new_by_curve_name() and</div><div id="92" class="line none">   92  * EC_KEY_dup() return a pointer to the newly created EC_KEY object, or NULL on error.</div><div id="93" class="line none">   93  */</div><div id="94" class="line none">   94 <a href="../../include/openssl/ossl_typ.h.html#33">EC_KEY</a> *<a href="ec_override.c.html#94">EC_KEY_new</a>() {</div><div id="95" class="line none">   95     <a href="../../include/openssl/ossl_typ.h.html#33">EC_KEY</a> *<a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a> = <a href="../../aws-c-common/verification/cbmc/sources/proof_allocators.c.html#76">can_fail_malloc</a>(sizeof(<a href="../../include/openssl/ossl_typ.h.html#33">EC_KEY</a>));</div><div id="96" class="line none">   96 </div><div id="97" class="line none">   97     if (<a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>) {</div><div id="98" class="line none">   98         <a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>-&gt;<a href="ec_override.c.html#82">references</a> = 1;</div><div id="99" class="line none">   99         <a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>-&gt;<a href="ec_override.c.html#83">group</a>      = NULL;  // no associated curve</div><div id="100" class="line none">  100         <a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>-&gt;<a href="ec_override.c.html#84">conv_form</a>  = <a href="../../include/openssl/ec.h.html#32">POINT_CONVERSION_UNCOMPRESSED</a>;</div><div id="101" class="line none">  101         // Can we assume that initially the keys are not set?</div><div id="102" class="line none">  102         <a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>-&gt;<a href="ec_override.c.html#85">priv_key</a>       = NULL;</div><div id="103" class="line none">  103         <a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>-&gt;<a href="ec_override.c.html#86">pub_key_is_set</a> = false;</div><div id="104" class="line none">  104     }</div><div id="105" class="line none">  105 </div><div id="106" class="line none">  106     return <a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>;</div><div id="107" class="line none">  107 }</div><div id="108" class="line none">  108 </div><div id="109" class="line none">  109 /*</div><div id="110" class="line none">  110  * Description: The function EC_KEY_get0_group() gets the EC_GROUP object for the key.</div><div id="111" class="line none">  111  * Return values: EC_KEY_get0_group() returns the EC_GROUP associated with the EC_KEY.</div><div id="112" class="line none">  112  */</div><div id="113" class="line none">  113 const <a href="../../include/openssl/ec.h.html#38">EC_GROUP</a> *<a href="ec_override.c.html#113">EC_KEY_get0_group</a>(const <a href="../../include/openssl/ossl_typ.h.html#33">EC_KEY</a> *<a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>) {</div><div id="114" class="line none">  114     assert(<a href="ec_override.c.html#396">ec_key_is_valid</a>(<a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>));</div><div id="115" class="line none">  115     return <a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>-&gt;<a href="ec_override.c.html#83">group</a>;</div><div id="116" class="line none">  116 }</div><div id="117" class="line none">  117 </div><div id="118" class="line none">  118 /*</div><div id="119" class="line none">  119  * Description: The function EC_KEY_set_group() sets the EC_GROUP object for the key.</div><div id="120" class="line none">  120  * Return values: Returns 1 on success or 0 on error.</div><div id="121" class="line none">  121  */</div><div id="122" class="line none">  122 int <a href="ec_override.c.html#122">EC_KEY_set_group</a>(<a href="../../include/openssl/ossl_typ.h.html#33">EC_KEY</a> *<a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>, const <a href="../../include/openssl/ec.h.html#38">EC_GROUP</a> *<a href="ec_override.c.html#83">group</a>) {</div><div id="123" class="line none">  123     assert(<a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>);</div><div id="124" class="line none">  124 </div><div id="125" class="line none">  125     if (!<a href="ec_override.c.html#83">group</a> || <a href="../../aws-c-common/verification/cbmc/include/proof_helpers/nondet.h.html#15">nondet_bool</a>()) return 0;</div><div id="126" class="line none">  126 </div><div id="127" class="line none">  127     <a href="ec_override.c.html#73">EC_GROUP_free</a>(<a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>-&gt;<a href="ec_override.c.html#83">group</a>);</div><div id="128" class="line none">  128     <a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>-&gt;<a href="ec_override.c.html#83">group</a> = <a href="../../aws-c-common/verification/cbmc/sources/proof_allocators.c.html#76">can_fail_malloc</a>(sizeof(<a href="../../include/openssl/ec.h.html#38">EC_GROUP</a>));</div><div id="129" class="line none">  129 </div><div id="130" class="line none">  130     if (!<a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>-&gt;<a href="ec_override.c.html#83">group</a>) return 0;</div><div id="131" class="line none">  131 </div><div id="132" class="line none">  132     <a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>-&gt;<a href="ec_override.c.html#83">group</a>-&gt;<a href="ec_override.c.html#28">curve_name</a> = <a href="ec_override.c.html#83">group</a>-&gt;<a href="ec_override.c.html#28">curve_name</a>;</div><div id="133" class="line none">  133     <a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>-&gt;<a href="ec_override.c.html#83">group</a>-&gt;<a href="ec_override.c.html#29">asn1_form</a>  = <a href="ec_override.c.html#83">group</a>-&gt;<a href="ec_override.c.html#29">asn1_form</a>;</div><div id="134" class="line none">  134     <a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>-&gt;<a href="ec_override.c.html#83">group</a>-&gt;<a href="ec_override.c.html#30">order</a>      = <a href="bn_override.c.html#49">BN_dup</a>(<a href="ec_override.c.html#83">group</a>-&gt;<a href="ec_override.c.html#30">order</a>);</div><div id="135" class="line none">  135     __CPROVER_assume(<a href="ec_override.c.html#381">ec_group_is_valid</a>(<a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>-&gt;<a href="ec_override.c.html#83">group</a>));  // Since this is the success path, ensure that BN_dup succeeds</div><div id="136" class="line none">  136 </div><div id="137" class="line none">  137     return 1;</div><div id="138" class="line none">  138 }</div><div id="139" class="line none">  139 </div><div id="140" class="line none">  140 /*</div><div id="141" class="line none">  141  * Description: The functions EC_KEY_get_conv_form() and EC_KEY_set_conv_form() get and set the point_conversion_form</div><div id="142" class="line none">  142  * for the key.</div><div id="143" class="line none">  143  */</div><div id="144" class="line none">  144 void <a href="ec_override.c.html#144">EC_KEY_set_conv_form</a>(<a href="../../include/openssl/ossl_typ.h.html#33">EC_KEY</a> *<a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>, <a href="../../include/openssl/ec.h.html#36">point_conversion_form_t</a> cform) {</div><div id="145" class="line none">  145     assert(<a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>);</div><div id="146" class="line none">  146     <a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>-&gt;<a href="ec_override.c.html#84">conv_form</a> = cform;</div><div id="147" class="line none">  147     if (<a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>-&gt;<a href="ec_override.c.html#83">group</a> != NULL) <a href="ec_override.c.html#57">EC_GROUP_set_point_conversion_form</a>(<a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>-&gt;<a href="ec_override.c.html#83">group</a>, cform);</div><div id="148" class="line none">  148 }</div><div id="149" class="line none">  149 </div><div id="150" class="line none">  150 /*</div><div id="151" class="line none">  151  * Description: The function EC_KEY_set_private_key() sets the private key for the key.</div><div id="152" class="line none">  152  * Return values: Returns 1 on success or 0 on error.</div><div id="153" class="line none">  153  */</div><div id="154" class="line none">  154 int <a href="ec_override.c.html#154">EC_KEY_set_private_key</a>(<a href="../../include/openssl/ossl_typ.h.html#33">EC_KEY</a> *<a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>, const <a href="../../include/openssl/ossl_typ.h.html#31">BIGNUM</a> *prv) {</div><div id="155" class="line none">  155     assert(<a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>);</div><div id="156" class="line none">  156     assert(<a href="bn_override.c.html#92">bignum_is_valid</a>(prv));</div><div id="157" class="line none">  157 </div><div id="158" class="line none">  158     if (<a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>-&gt;<a href="ec_override.c.html#83">group</a> == NULL || <a href="../../aws-c-common/verification/cbmc/include/proof_helpers/nondet.h.html#15">nondet_bool</a>()) {</div><div id="159" class="line none">  159         return 0;</div><div id="160" class="line none">  160     }</div><div id="161" class="line none">  161 </div><div id="162" class="line none">  162     <a href="bn_override.c.html#85">BN_clear_free</a>(<a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>-&gt;<a href="ec_override.c.html#85">priv_key</a>);</div><div id="163" class="line none">  163     <a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>-&gt;<a href="ec_override.c.html#85">priv_key</a> = <a href="bn_override.c.html#49">BN_dup</a>(prv);</div><div id="164" class="line none">  164     return (<a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>-&gt;<a href="ec_override.c.html#85">priv_key</a> == NULL) ? 0 : 1;</div><div id="165" class="line none">  165 }</div><div id="166" class="line none">  166 </div><div id="167" class="line none">  167 /*</div><div id="168" class="line none">  168  * Description: The function EC_KEY_get0_private_key gets the private key for the key.</div><div id="169" class="line none">  169  * Return values: EC_KEY_get0_private_key() returns the private key associated with the EC_KEY.</div><div id="170" class="line none">  170  */</div><div id="171" class="line none">  171 const <a href="../../include/openssl/ossl_typ.h.html#31">BIGNUM</a> *<a href="ec_override.c.html#171">EC_KEY_get0_private_key</a>(const <a href="../../include/openssl/ossl_typ.h.html#33">EC_KEY</a> *<a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>) {</div><div id="172" class="line none">  172     assert(<a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>);</div><div id="173" class="line none">  173     return <a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>-&gt;<a href="ec_override.c.html#85">priv_key</a>;</div><div id="174" class="line none">  174 }</div><div id="175" class="line none">  175 </div><div id="176" class="line none">  176 /*</div><div id="177" class="line none">  177  * Description: EC_KEY_generate_key generates a new public and private key for the supplied eckey object. eckey must</div><div id="178" class="line none">  178  * have an EC_GROUP object associated with it before calling this function. The private key is a random integer (0 &lt;</div><div id="179" class="line none">  179  * priv_key &lt; order, where order is the order of the EC_GROUP object). The public key is an EC_POINT on the curve</div><div id="180" class="line none">  180  * calculated by multiplying the generator for the curve by the private key. Return value: Returns 1 on success or 0 on</div><div id="181" class="line none">  181  * error.</div><div id="182" class="line none">  182  */</div><div id="183" class="line none">  183 int <a href="ec_override.c.html#183">EC_KEY_generate_key</a>(<a href="../../include/openssl/ossl_typ.h.html#33">EC_KEY</a> *<a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>) {</div><div id="184" class="line none">  184     assert(<a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>);</div><div id="185" class="line none">  185     assert(<a href="ec_override.c.html#381">ec_group_is_valid</a>(<a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>-&gt;<a href="ec_override.c.html#83">group</a>));</div><div id="186" class="line none">  186 </div><div id="187" class="line none">  187     <a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>-&gt;<a href="ec_override.c.html#85">priv_key</a>       = <a href="bn_override.c.html#96">bignum_nondet_alloc</a>();</div><div id="188" class="line none">  188     <a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>-&gt;<a href="ec_override.c.html#86">pub_key_is_set</a> = <a href="../../aws-c-common/verification/cbmc/include/proof_helpers/nondet.h.html#15">nondet_bool</a>();</div><div id="189" class="line none">  189 </div><div id="190" class="line none">  190     __CPROVER_assume(!<a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>-&gt;<a href="ec_override.c.html#85">priv_key</a> || <a href="bn_override.c.html#92">bignum_is_valid</a>(<a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>-&gt;<a href="ec_override.c.html#85">priv_key</a>));</div><div id="191" class="line none">  191 </div><div id="192" class="line none">  192     return <a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>-&gt;<a href="ec_override.c.html#85">priv_key</a> &amp;&amp; <a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>-&gt;<a href="ec_override.c.html#86">pub_key_is_set</a>;</div><div id="193" class="line none">  193 }</div><div id="194" class="line none">  194 </div><div id="195" class="line none">  195 /*</div><div id="196" class="line none">  196  * Description: EC_KEY_up_ref() increments the reference count associated with the EC_KEY object.</div><div id="197" class="line none">  197  * Return values: EC_KEY_up_ref() returns 1 on success or 0 on error.</div><div id="198" class="line none">  198  */</div><div id="199" class="line none">  199 int <a href="ec_override.c.html#199">EC_KEY_up_ref</a>(<a href="../../include/openssl/ossl_typ.h.html#33">EC_KEY</a> *<a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>) {</div><div id="200" class="line none">  200     assert(<a href="ec_override.c.html#396">ec_key_is_valid</a>(<a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>));</div><div id="201" class="line none">  201 </div><div id="202" class="line none">  202     <a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>-&gt;<a href="ec_override.c.html#82">references</a> += 1;</div><div id="203" class="line none">  203     return 1;  // Can we assume that this never fails?</div><div id="204" class="line none">  204 }</div><div id="205" class="line none">  205 </div><div id="206" class="line none">  206 /*</div><div id="207" class="line none">  207  * Description: Calling EC_KEY_free() decrements the reference count for the EC_KEY object, and if it has dropped to</div><div id="208" class="line none">  208  * zero then frees the memory associated with it. If key is NULL nothing is done.</div><div id="209" class="line none">  209  */</div><div id="210" class="line none">  210 void <a href="ec_override.c.html#210">EC_KEY_free</a>(<a href="../../include/openssl/ossl_typ.h.html#33">EC_KEY</a> *<a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>) {</div><div id="211" class="line none">  211     if (<a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>) {</div><div id="212" class="line none">  212         <a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>-&gt;<a href="ec_override.c.html#82">references</a> -= 1;</div><div id="213" class="line none">  213         if (<a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>-&gt;<a href="ec_override.c.html#82">references</a> == 0) {</div><div id="214" class="line none">  214             <a href="ec_override.c.html#73">EC_GROUP_free</a>(<a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>-&gt;<a href="ec_override.c.html#83">group</a>);</div><div id="215" class="line none">  215             <a href="bn_override.c.html#85">BN_clear_free</a>(<a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>-&gt;<a href="ec_override.c.html#85">priv_key</a>);</div><div id="216" class="line none">  216             free(<a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>);</div><div id="217" class="line none">  217         }</div><div id="218" class="line none">  218     }</div><div id="219" class="line none">  219 }</div><div id="220" class="line none">  220 </div><div id="221" class="line none">  221 /* Could not find OpenSSL documentation. The following is taken from the header file. */</div><div id="222" class="line none">  222 /** Decodes a ec public key from a octet string.</div><div id="223" class="line none">  223  *  \param  key  a pointer to a EC_KEY object which should be used</div><div id="224" class="line none">  224  *  \param  in   memory buffer with the encoded public key</div><div id="225" class="line none">  225  *  \param  len  length of the encoded public key</div><div id="226" class="line none">  226  *  \return EC_KEY object with decoded public key or NULL if an error</div><div id="227" class="line none">  227  *          occurred.</div><div id="228" class="line none">  228  */</div><div id="229" class="line none">  229 <a href="../../include/openssl/ossl_typ.h.html#33">EC_KEY</a> *<a href="ec_override.c.html#229">o2i_ECPublicKey</a>(<a href="../../include/openssl/ossl_typ.h.html#33">EC_KEY</a> **<a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>, const unsigned char **in, long <a href="../../aws-c-common/include/aws/common/byte_buf.h.html#27">len</a>) {</div><div id="230" class="line none">  230     assert(in);</div><div id="231" class="line none">  231     assert(*in);</div><div id="232" class="line none">  232     assert(AWS_MEM_IS_READABLE(*in, <a href="../../aws-c-common/include/aws/common/byte_buf.h.html#27">len</a>));</div><div id="233" class="line none">  233 </div><div id="234" class="line none">  234     if (!<a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a> || !(*<a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>) || !(*<a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>)-&gt;<a href="ec_override.c.html#83">group</a> || <a href="../../aws-c-common/verification/cbmc/include/proof_helpers/nondet.h.html#15">nondet_bool</a>()) {</div><div id="235" class="line none">  235         return NULL;</div><div id="236" class="line none">  236     }</div><div id="237" class="line none">  237 </div><div id="238" class="line none">  238     (*<a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>)-&gt;<a href="ec_override.c.html#86">pub_key_is_set</a> = true;</div><div id="239" class="line none">  239 </div><div id="240" class="line none">  240     // o2i_ECPublicKey calls EC_KEY_oct2key, which in some cases sets the conversion form.</div><div id="241" class="line none">  241     // Can we guarantee that this never happens in our use cases?</div><div id="242" class="line none">  242     // Any other possible changes to the EC_KEY?</div><div id="243" class="line none">  243 </div><div id="244" class="line none">  244     long offset;</div><div id="245" class="line none">  245     __CPROVER_assume(0 &lt;= offset &amp;&amp; offset &lt;= <a href="../../aws-c-common/include/aws/common/byte_buf.h.html#27">len</a>);  // public key can be shorter than length</div><div id="246" class="line none">  246     *in += offset;</div><div id="247" class="line none">  247 </div><div id="248" class="line none">  248     return *<a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>;</div><div id="249" class="line none">  249 }</div><div id="250" class="line none">  250 </div><div id="251" class="line none">  251 /* Could not find OpenSSL documentation. The following is taken from the header file. */</div><div id="252" class="line none">  252 /** Encodes a ec public key in an octet string.</div><div id="253" class="line none">  253  *  \param  key  the EC_KEY object with the public key</div><div id="254" class="line none">  254  *  \param  out  the buffer for the result (if NULL the function returns number</div><div id="255" class="line none">  255  *               of bytes needed).</div><div id="256" class="line none">  256  *  \return 1 on success and 0 if an error occurred</div><div id="257" class="line none">  257  */</div><div id="258" class="line none">  258 int <a href="ec_override.c.html#258">i2o_ECPublicKey</a>(const <a href="../../include/openssl/ossl_typ.h.html#33">EC_KEY</a> *<a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>, unsigned char **out) {</div><div id="259" class="line none">  259     assert(<a href="ec_override.c.html#396">ec_key_is_valid</a>(<a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>));</div><div id="260" class="line none">  260     assert(out);           // Assuming that it's always called in ESDK with non-NULL out</div><div id="261" class="line none">  261     assert(*out == NULL);  // Assuming that it's always called with NULL *out, so buffer needs to be allocated</div><div id="262" class="line none">  262 </div><div id="263" class="line none">  263     if (!<a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>) return 0;</div><div id="264" class="line none">  264 </div><div id="265" class="line none">  265     int buf_len;</div><div id="266" class="line none">  266     __CPROVER_assume(0 &lt; buf_len);</div><div id="267" class="line none">  267     *out = <a href="../../aws-c-common/verification/cbmc/sources/proof_allocators.c.html#76">can_fail_malloc</a>(buf_len);</div><div id="268" class="line none">  268 </div><div id="269" class="line none">  269     if (*out == NULL) {</div><div id="270" class="line none">  270         int <a href="../../aws-c-common/include/aws/common/error.h.html#25">error_code</a>;</div><div id="271" class="line none">  271         __CPROVER_assume(<a href="../../aws-c-common/include/aws/common/error.h.html#25">error_code</a> &lt;= 0);</div><div id="272" class="line none">  272         return <a href="../../aws-c-common/include/aws/common/error.h.html#25">error_code</a>;  // Retuns 0 or negative value on error</div><div id="273" class="line none">  273     }</div><div id="274" class="line none">  274 </div><div id="275" class="line none">  275     // Should *out be incremented?</div><div id="276" class="line none">  276 </div><div id="277" class="line none">  277     return buf_len;</div><div id="278" class="line none">  278 }</div><div id="279" class="line none">  279 </div><div id="280" class="line none">  280 /* Abstraction of ECDSA_SIG struct */</div><div id="281" class="line none">  281 struct <a href="../../include/openssl/ec.h.html#45">ECDSA_SIG_st</a> {</div><div id="282" class="line none">  282     <a href="../../include/openssl/ossl_typ.h.html#31">BIGNUM</a> *<a href="ec_override.c.html#282">r</a>;</div><div id="283" class="line none">  283     <a href="../../include/openssl/ossl_typ.h.html#31">BIGNUM</a> *<a href="ec_override.c.html#283">s</a>;</div><div id="284" class="line none">  284 };</div><div id="285" class="line none">  285 </div><div id="286" class="line none">  286 /*</div><div id="287" class="line none">  287  * Description: ECDSA_SIG_get0() returns internal pointers the r and s values contained in sig and stores them in *pr</div><div id="288" class="line none">  288  * and *ps, respectively. The pointer pr or ps can be NULL, in which case the corresponding value is not returned.</div><div id="289" class="line none">  289  */</div><div id="290" class="line none">  290 void <a href="ec_override.c.html#290">ECDSA_SIG_get0</a>(const <a href="../../include/openssl/ec.h.html#45">ECDSA_SIG</a> *sig, const <a href="../../include/openssl/ossl_typ.h.html#31">BIGNUM</a> **pr, const <a href="../../include/openssl/ossl_typ.h.html#31">BIGNUM</a> **ps) {</div><div id="291" class="line none">  291     assert(<a href="ec_override.c.html#426">ecdsa_sig_is_valid</a>(sig));</div><div id="292" class="line none">  292     assert(pr);</div><div id="293" class="line none">  293     assert(ps);</div><div id="294" class="line none">  294 </div><div id="295" class="line none">  295     *pr = sig-&gt;<a href="ec_override.c.html#282">r</a>;</div><div id="296" class="line none">  296     *ps = sig-&gt;<a href="ec_override.c.html#283">s</a>;</div><div id="297" class="line none">  297 }</div><div id="298" class="line none">  298 </div><div id="299" class="line none">  299 /*</div><div id="300" class="line none">  300  * Description: The r and s values can be set by calling ECDSA_SIG_set0() and passing the new values for r and s as</div><div id="301" class="line none">  301  * parameters to the function. Calling this function transfers the memory management of the values to the ECDSA_SIG</div><div id="302" class="line none">  302  * object, and therefore the values that have been passed in should not be freed directly after this function has been</div><div id="303" class="line none">  303  * called. Return values: ECDSA_SIG_set0() returns 1 on success or 0 on failure.</div><div id="304" class="line none">  304  */</div><div id="305" class="line none">  305 int <a href="ec_override.c.html#305">ECDSA_SIG_set0</a>(<a href="../../include/openssl/ec.h.html#45">ECDSA_SIG</a> *sig, <a href="../../include/openssl/ossl_typ.h.html#31">BIGNUM</a> *<a href="ec_override.c.html#282">r</a>, <a href="../../include/openssl/ossl_typ.h.html#31">BIGNUM</a> *<a href="ec_override.c.html#283">s</a>) {</div><div id="306" class="line none">  306     assert(sig);</div><div id="307" class="line none">  307     assert(<a href="bn_override.c.html#92">bignum_is_valid</a>(<a href="ec_override.c.html#282">r</a>));</div><div id="308" class="line none">  308     assert(<a href="bn_override.c.html#92">bignum_is_valid</a>(<a href="ec_override.c.html#283">s</a>));</div><div id="309" class="line none">  309 </div><div id="310" class="line none">  310     <a href="bn_override.c.html#85">BN_clear_free</a>(sig-&gt;<a href="ec_override.c.html#282">r</a>);</div><div id="311" class="line none">  311     <a href="bn_override.c.html#85">BN_clear_free</a>(sig-&gt;<a href="ec_override.c.html#283">s</a>);</div><div id="312" class="line none">  312     sig-&gt;<a href="ec_override.c.html#282">r</a> = <a href="ec_override.c.html#282">r</a>;</div><div id="313" class="line none">  313     sig-&gt;<a href="ec_override.c.html#283">s</a> = <a href="ec_override.c.html#283">s</a>;</div><div id="314" class="line none">  314     return 1;  // Assuming that should never fail as long as r and s are not NULL</div><div id="315" class="line none">  315 }</div><div id="316" class="line none">  316 </div><div id="317" class="line none">  317 /*</div><div id="318" class="line none">  318  * Description: ECDSA_SIG_free() frees the ECDSA_SIG structure sig.</div><div id="319" class="line none">  319  */</div><div id="320" class="line none">  320 void <a href="ec_override.c.html#320">ECDSA_SIG_free</a>(<a href="../../include/openssl/ec.h.html#45">ECDSA_SIG</a> *sig) {</div><div id="321" class="line none">  321     if (sig) {</div><div id="322" class="line none">  322         <a href="bn_override.c.html#85">BN_clear_free</a>(sig-&gt;<a href="ec_override.c.html#282">r</a>);</div><div id="323" class="line none">  323         <a href="bn_override.c.html#85">BN_clear_free</a>(sig-&gt;<a href="ec_override.c.html#283">s</a>);</div><div id="324" class="line none">  324         free(sig);</div><div id="325" class="line none">  325     }</div><div id="326" class="line none">  326 }</div><div id="327" class="line none">  327 </div><div id="328" class="line none">  328 /*</div><div id="329" class="line none">  329  * Description: d2i_ECDSA_SIG() decodes a DER encoded ECDSA signature and returns the decoded signature in a newly</div><div id="330" class="line none">  330  * allocated ECDSA_SIG structure. *sig points to the buffer containing the DER encoded signature of size len.</div><div id="331" class="line none">  331  */</div><div id="332" class="line none">  332 <a href="../../include/openssl/ec.h.html#45">ECDSA_SIG</a> *<a href="ec_override.c.html#332">d2i_ECDSA_SIG</a>(<a href="../../include/openssl/ec.h.html#45">ECDSA_SIG</a> **sig, const unsigned char **pp, long <a href="../../aws-c-common/include/aws/common/byte_buf.h.html#27">len</a>) {</div><div id="333" class="line none">  333     assert(sig);</div><div id="334" class="line none">  334     assert(!*sig);</div><div id="335" class="line none">  335     assert(pp);</div><div id="336" class="line none">  336     assert(*pp);</div><div id="337" class="line none">  337     assert(0 &lt;= <a href="../../aws-c-common/include/aws/common/byte_buf.h.html#27">len</a>);</div><div id="338" class="line none">  338     assert(AWS_MEM_IS_READABLE(*pp, <a href="../../aws-c-common/include/aws/common/byte_buf.h.html#27">len</a>));</div><div id="339" class="line none">  339 </div><div id="340" class="line none">  340     *sig = <a href="../../aws-c-common/verification/cbmc/sources/proof_allocators.c.html#76">can_fail_malloc</a>(sizeof(<a href="../../include/openssl/ec.h.html#45">ECDSA_SIG</a>));</div><div id="341" class="line none">  341 </div><div id="342" class="line none">  342     if (*sig) {</div><div id="343" class="line none">  343         (*sig)-&gt;<a href="ec_override.c.html#282">r</a> = <a href="bn_override.c.html#96">bignum_nondet_alloc</a>();</div><div id="344" class="line none">  344         (*sig)-&gt;<a href="ec_override.c.html#283">s</a> = <a href="bn_override.c.html#96">bignum_nondet_alloc</a>();</div><div id="345" class="line none">  345         __CPROVER_assume(<a href="ec_override.c.html#426">ecdsa_sig_is_valid</a>(*sig));  // Assuming that on a success both r and s are initialized</div><div id="346" class="line none">  346     }</div><div id="347" class="line none">  347 </div><div id="348" class="line none">  348     return *sig;</div><div id="349" class="line none">  349 }</div><div id="350" class="line none">  350 </div><div id="351" class="line none">  351 /*</div><div id="352" class="line none">  352  * Description: i2d_ECDSA_SIG() creates the DER encoding of the ECDSA signature sig and writes the encoded signature to</div><div id="353" class="line none">  353  * *pp (note: if pp is NULL i2d_ECDSA_SIG() returns the expected length in bytes of the DER encoded signature).</div><div id="354" class="line none">  354  * i2d_ECDSA_SIG() returns the length of the DER encoded signature (or 0 on error).</div><div id="355" class="line none">  355  */</div><div id="356" class="line none">  356 int <a href="ec_override.c.html#356">i2d_ECDSA_SIG</a>(const <a href="../../include/openssl/ec.h.html#45">ECDSA_SIG</a> *sig, unsigned char **pp) {</div><div id="357" class="line none">  357     assert(<a href="ec_override.c.html#426">ecdsa_sig_is_valid</a>(sig));</div><div id="358" class="line none">  358     assert(pp);</div><div id="359" class="line none">  359     assert(*pp);                                             // Assuming is never called with *pp == NULL</div><div id="360" class="line none">  360     assert(AWS_MEM_IS_WRITABLE(*pp, <a href="ec_override.c.html#442">max_signature_size</a>()));  // *pp has enough space for the signature</div><div id="361" class="line none">  361 </div><div id="362" class="line none">  362     // Documentation says 0 is returned on error, but OpenSSL implementation returns -1</div><div id="363" class="line none">  363     // To be safe, we return a number &lt;= 0</div><div id="364" class="line none">  364     if (<a href="../../aws-c-common/verification/cbmc/include/proof_helpers/nondet.h.html#15">nondet_bool</a>()) {</div><div id="365" class="line none">  365         int <a href="../../aws-c-common/include/aws/common/error.h.html#25">error_code</a>;</div><div id="366" class="line none">  366         __CPROVER_assume(<a href="../../aws-c-common/include/aws/common/error.h.html#25">error_code</a> &lt;= 0);</div><div id="367" class="line none">  367         return <a href="../../aws-c-common/include/aws/common/error.h.html#25">error_code</a>;</div><div id="368" class="line none">  368     }</div><div id="369" class="line none">  369 </div><div id="370" class="line none">  370     int sig_len;</div><div id="371" class="line none">  371     __CPROVER_assume(0 &lt; sig_len &amp;&amp; sig_len &lt;= <a href="ec_override.c.html#442">max_signature_size</a>());</div><div id="372" class="line none">  372     <a href="ec_override.c.html#486">write_unconstrained_data</a>(*pp, sig_len);</div><div id="373" class="line none">  373     *pp += sig_len;  // Unclear from the documentation if *pp should really be incremented</div><div id="374" class="line none">  374 </div><div id="375" class="line none">  375     return sig_len;</div><div id="376" class="line none">  376 }</div><div id="377" class="line none">  377 </div><div id="378" class="line none">  378 /* CBMC helper functions */</div><div id="379" class="line none">  379 </div><div id="380" class="line none">  380 /* Helper function for CBMC proofs: check validity of an EC_GROUP. */</div><div id="381" class="line none">  381 bool <a href="ec_override.c.html#381">ec_group_is_valid</a>(<a href="../../include/openssl/ec.h.html#38">EC_GROUP</a> *<a href="ec_override.c.html#83">group</a>) {</div><div id="382" class="line none">  382     return <a href="ec_override.c.html#83">group</a> &amp;&amp; (<a href="ec_override.c.html#83">group</a>-&gt;<a href="ec_override.c.html#28">curve_name</a> != <a href="../../include/openssl/objects.h.html#20">NID_undef</a>) &amp;&amp; (<a href="ec_override.c.html#83">group</a>-&gt;<a href="ec_override.c.html#29">asn1_form</a> == <a href="../../include/openssl/ec.h.html#30">POINT_CONVERSION_COMPRESSED</a>) &amp;&amp;</div><div id="383" class="line none">  383            <a href="bn_override.c.html#92">bignum_is_valid</a>(<a href="ec_override.c.html#83">group</a>-&gt;<a href="ec_override.c.html#30">order</a>);</div><div id="384" class="line none">  384 }</div><div id="385" class="line none">  385 </div><div id="386" class="line none">  386 /* Helper function for CBMC proofs: allocates an EC_GROUP nondeterministically. */</div><div id="387" class="line none">  387 <a href="../../include/openssl/ec.h.html#38">EC_GROUP</a> *<a href="ec_override.c.html#387">ec_group_nondet_alloc</a>() {</div><div id="388" class="line none">  388     <a href="../../include/openssl/ec.h.html#38">EC_GROUP</a> *<a href="ec_override.c.html#83">group</a> = <a href="../../aws-c-common/verification/cbmc/sources/proof_allocators.c.html#76">can_fail_malloc</a>(sizeof(<a href="../../include/openssl/ec.h.html#38">EC_GROUP</a>));</div><div id="389" class="line none">  389 </div><div id="390" class="line none">  390     if (<a href="ec_override.c.html#83">group</a>) <a href="ec_override.c.html#83">group</a>-&gt;<a href="ec_override.c.html#30">order</a> = <a href="bn_override.c.html#96">bignum_nondet_alloc</a>();</div><div id="391" class="line none">  391 </div><div id="392" class="line none">  392     return <a href="ec_override.c.html#83">group</a>;</div><div id="393" class="line none">  393 }</div><div id="394" class="line none">  394 </div><div id="395" class="line none">  395 /* Helper function for CBMC proofs: check validity of an EC_KEY. */</div><div id="396" class="line none">  396 bool <a href="ec_override.c.html#396">ec_key_is_valid</a>(<a href="../../include/openssl/ossl_typ.h.html#33">EC_KEY</a> *<a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>) {</div><div id="397" class="line none">  397     return <a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a> &amp;&amp; (0 &lt; <a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>-&gt;<a href="ec_override.c.html#82">references</a>) &amp;&amp; <a href="ec_override.c.html#381">ec_group_is_valid</a>(<a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>-&gt;<a href="ec_override.c.html#83">group</a>) &amp;&amp; (<a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>-&gt;<a href="ec_override.c.html#83">group</a>-&gt;<a href="ec_override.c.html#29">asn1_form</a> == <a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>-&gt;<a href="ec_override.c.html#84">conv_form</a>) &amp;&amp;</div><div id="398" class="line none">  398            <a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>-&gt;<a href="ec_override.c.html#86">pub_key_is_set</a> &amp;&amp; (!<a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>-&gt;<a href="ec_override.c.html#85">priv_key</a> || <a href="bn_override.c.html#92">bignum_is_valid</a>(<a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>-&gt;<a href="ec_override.c.html#85">priv_key</a>));</div><div id="399" class="line none">  399 }</div><div id="400" class="line none">  400 </div><div id="401" class="line none">  401 /* Helper function for CBMC proofs: allocates an EC_KEY nondeterministically. */</div><div id="402" class="line none">  402 <a href="../../include/openssl/ossl_typ.h.html#33">EC_KEY</a> *<a href="ec_override.c.html#402">ec_key_nondet_alloc</a>() {</div><div id="403" class="line none">  403     <a href="../../include/openssl/ossl_typ.h.html#33">EC_KEY</a> *<a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a> = <a href="../../aws-c-common/verification/cbmc/sources/proof_allocators.c.html#76">can_fail_malloc</a>(sizeof(<a href="../../include/openssl/ossl_typ.h.html#33">EC_KEY</a>));</div><div id="404" class="line none">  404 </div><div id="405" class="line none">  405     if (<a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>) {</div><div id="406" class="line none">  406         <a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>-&gt;<a href="ec_override.c.html#83">group</a>    = <a href="ec_override.c.html#387">ec_group_nondet_alloc</a>();</div><div id="407" class="line none">  407         <a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>-&gt;<a href="ec_override.c.html#85">priv_key</a> = <a href="bn_override.c.html#96">bignum_nondet_alloc</a>();</div><div id="408" class="line none">  408     }</div><div id="409" class="line none">  409 </div><div id="410" class="line none">  410     return <a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>;</div><div id="411" class="line none">  411 }</div><div id="412" class="line none">  412 </div><div id="413" class="line none">  413 /* Helper function for CBMC proofs: returns the reference count. */</div><div id="414" class="line none">  414 int <a href="ec_override.c.html#414">ec_key_get_reference_count</a>(<a href="../../include/openssl/ossl_typ.h.html#33">EC_KEY</a> *<a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>) {</div><div id="415" class="line none">  415     return <a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a> ? <a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>-&gt;<a href="ec_override.c.html#82">references</a> : 0;</div><div id="416" class="line none">  416 }</div><div id="417" class="line none">  417 </div><div id="418" class="line none">  418 /* Helper function for CBMC proofs: frees the memory regardless of the reference count. */</div><div id="419" class="line none">  419 void <a href="ec_override.c.html#419">ec_key_unconditional_free</a>(<a href="../../include/openssl/ossl_typ.h.html#33">EC_KEY</a> *<a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>) {</div><div id="420" class="line none">  420     <a href="ec_override.c.html#73">EC_GROUP_free</a>(<a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>-&gt;<a href="ec_override.c.html#83">group</a>);</div><div id="421" class="line none">  421     <a href="bn_override.c.html#85">BN_clear_free</a>(<a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>-&gt;<a href="ec_override.c.html#85">priv_key</a>);</div><div id="422" class="line none">  422     free(<a href="../../aws-c-common/include/aws/common/hash_table.h.html#64">key</a>);</div><div id="423" class="line none">  423 }</div><div id="424" class="line none">  424 </div><div id="425" class="line none">  425 /* Helper function for CBMC proofs: check validity of an ECDSA_SIG. */</div><div id="426" class="line none">  426 bool <a href="ec_override.c.html#426">ecdsa_sig_is_valid</a>(<a href="../../include/openssl/ec.h.html#45">ECDSA_SIG</a> *sig) {</div><div id="427" class="line none">  427     return sig &amp;&amp; <a href="bn_override.c.html#92">bignum_is_valid</a>(sig-&gt;<a href="ec_override.c.html#282">r</a>) &amp;&amp; <a href="bn_override.c.html#92">bignum_is_valid</a>(sig-&gt;<a href="ec_override.c.html#283">s</a>);</div><div id="428" class="line none">  428 }</div><div id="429" class="line none">  429 </div><div id="430" class="line none">  430 static size_t <a href="ec_override.c.html#430">signature_size</a>;</div><div id="431" class="line none">  431 </div><div id="432" class="line none">  432 void <a href="ec_override.c.html#432">initialize_max_signature_size</a>() {</div><div id="433" class="line none">  433     size_t <a href="../../aws-c-common/include/aws/common/private/hash_table_impl.h.html#35">size</a>;</div><div id="434" class="line none">  434     // At different times, this value is stored in a size_t, a long and an int</div><div id="435" class="line none">  435     __CPROVER_assume(0 &lt; <a href="../../aws-c-common/include/aws/common/private/hash_table_impl.h.html#35">size</a> &amp;&amp; <a href="../../aws-c-common/include/aws/common/private/hash_table_impl.h.html#35">size</a> &lt;= INT_MAX);</div><div id="436" class="line none">  436     <a href="ec_override.c.html#430">signature_size</a> = <a href="../../aws-c-common/include/aws/common/private/hash_table_impl.h.html#35">size</a>;</div><div id="437" class="line none">  437 }</div><div id="438" class="line none">  438 </div><div id="439" class="line none">  439 /* This function returns a fixed nondeterministic value meant to represent the maximum possible size of the DER encoding</div><div id="440" class="line none">  440  * of a signature. This value is obtained from EVP_PKEY_sign and restricts the size of the buffers in d2i_ECDSA_SIG and</div><div id="441" class="line none">  441  * i2d_ECDSA_SIG. */</div><div id="442" class="line none">  442 size_t <a href="ec_override.c.html#442">max_signature_size</a>() {</div><div id="443" class="line none">  443     return <a href="ec_override.c.html#430">signature_size</a>;</div><div id="444" class="line none">  444 }</div><div id="445" class="line none">  445 </div><div id="446" class="line none">  446 static size_t <a href="ec_override.c.html#446">derivation_size</a>;</div><div id="447" class="line none">  447 </div><div id="448" class="line none">  448 void <a href="ec_override.c.html#448">initialize_max_derivation_size</a>() {</div><div id="449" class="line none">  449     size_t <a href="../../aws-c-common/include/aws/common/private/hash_table_impl.h.html#35">size</a>;</div><div id="450" class="line none">  450     // At different times, this value is stored in a size_t, a long and an int</div><div id="451" class="line none">  451     __CPROVER_assume(0 &lt; <a href="../../aws-c-common/include/aws/common/private/hash_table_impl.h.html#35">size</a> &amp;&amp; <a href="../../aws-c-common/include/aws/common/private/hash_table_impl.h.html#35">size</a> &lt;= INT_MAX);</div><div id="452" class="line none">  452     <a href="ec_override.c.html#446">derivation_size</a> = <a href="../../aws-c-common/include/aws/common/private/hash_table_impl.h.html#35">size</a>;</div><div id="453" class="line none">  453 }</div><div id="454" class="line none">  454 </div><div id="455" class="line none">  455 size_t <a href="ec_override.c.html#455">max_derivation_size</a>() {</div><div id="456" class="line hit">  456     return <a href="ec_override.c.html#446">derivation_size</a>;</div><div id="457" class="line hit">  457 }</div><div id="458" class="line none">  458 </div><div id="459" class="line none">  459 static size_t <a href="ec_override.c.html#459">encryption_size</a>;</div><div id="460" class="line none">  460 </div><div id="461" class="line none">  461 void <a href="ec_override.c.html#461">initialize_max_encryption_size</a>() {</div><div id="462" class="line none">  462     size_t <a href="../../aws-c-common/include/aws/common/private/hash_table_impl.h.html#35">size</a>;</div><div id="463" class="line none">  463     // At different times, this value is stored in a size_t, a long and an int</div><div id="464" class="line none">  464     __CPROVER_assume(0 &lt; <a href="../../aws-c-common/include/aws/common/private/hash_table_impl.h.html#35">size</a> &amp;&amp; <a href="../../aws-c-common/include/aws/common/private/hash_table_impl.h.html#35">size</a> &lt;= INT_MAX);</div><div id="465" class="line none">  465     <a href="ec_override.c.html#459">encryption_size</a> = <a href="../../aws-c-common/include/aws/common/private/hash_table_impl.h.html#35">size</a>;</div><div id="466" class="line none">  466 }</div><div id="467" class="line none">  467 </div><div id="468" class="line none">  468 size_t <a href="ec_override.c.html#468">max_encryption_size</a>() {</div><div id="469" class="line none">  469     return <a href="ec_override.c.html#459">encryption_size</a>;</div><div id="470" class="line none">  470 }</div><div id="471" class="line none">  471 </div><div id="472" class="line none">  472 static size_t <a href="ec_override.c.html#472">decryption_size</a>;</div><div id="473" class="line none">  473 </div><div id="474" class="line none">  474 void <a href="ec_override.c.html#474">initialize_max_decryption_size</a>() {</div><div id="475" class="line none">  475     size_t <a href="../../aws-c-common/include/aws/common/private/hash_table_impl.h.html#35">size</a>;</div><div id="476" class="line none">  476     // At different times, this value is stored in a size_t, a long and an int</div><div id="477" class="line none">  477     __CPROVER_assume(0 &lt; <a href="../../aws-c-common/include/aws/common/private/hash_table_impl.h.html#35">size</a> &amp;&amp; <a href="../../aws-c-common/include/aws/common/private/hash_table_impl.h.html#35">size</a> &lt;= INT_MAX);</div><div id="478" class="line none">  478     <a href="ec_override.c.html#459">encryption_size</a> = <a href="../../aws-c-common/include/aws/common/private/hash_table_impl.h.html#35">size</a>;</div><div id="479" class="line none">  479 }</div><div id="480" class="line none">  480 </div><div id="481" class="line none">  481 size_t <a href="ec_override.c.html#481">max_decryption_size</a>() {</div><div id="482" class="line none">  482     return <a href="ec_override.c.html#459">encryption_size</a>;</div><div id="483" class="line none">  483 }</div><div id="484" class="line none">  484 </div><div id="485" class="line none">  485 /* Writes arbitrary data into the buffer out. */</div><div id="486" class="line none">  486 void <a href="ec_override.c.html#486">write_unconstrained_data</a>(unsigned char *out, size_t <a href="../../aws-c-common/include/aws/common/byte_buf.h.html#27">len</a>) {</div><div id="487" class="line hit">  487     assert(AWS_MEM_IS_WRITABLE(out, <a href="../../aws-c-common/include/aws/common/byte_buf.h.html#27">len</a>));</div><div id="488" class="line none">  488 </div><div id="489" class="line none">  489     // Currently we ignore the len parameter and just fill the entire buffer with unconstrained data.</div><div id="490" class="line none">  490     // This is fine because it is strictly more general behavior than writing only len bytes.</div><div id="491" class="line hit">  491     __CPROVER_havoc_object(out);</div><div id="492" class="line hit">  492 }</div>
</div>
</body>
</html>
