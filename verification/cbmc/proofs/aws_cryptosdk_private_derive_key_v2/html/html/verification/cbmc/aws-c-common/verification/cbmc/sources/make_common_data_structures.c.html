
<html>
<head>
<title>verification/cbmc/aws-c-common/verification/cbmc/sources/make_common_data_structures.c</title>
<link rel="stylesheet" type="text/css" href="../../../../../../viewer.css">
</head>

<body>
<div class="code">
<div id="1" class="line none">    1 /**</div><div id="2" class="line none">    2  * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.</div><div id="3" class="line none">    3  * SPDX-License-Identifier: Apache-2.0.</div><div id="4" class="line none">    4  */</div><div id="5" class="line none">    5 </div><div id="6" class="line none">    6 #include &lt;aws/common/common.h&gt;</div><div id="7" class="line none">    7 #include &lt;limits.h&gt;</div><div id="8" class="line none">    8 #include &lt;proof_helpers/make_common_data_structures.h&gt;</div><div id="9" class="line none">    9 #include &lt;proof_helpers/proof_allocators.h&gt;</div><div id="10" class="line none">   10 #include &lt;stdint.h&gt;</div><div id="11" class="line none">   11 #include &lt;stdlib.h&gt;</div><div id="12" class="line none">   12 </div><div id="13" class="line none">   13 bool <a href="make_common_data_structures.c.html#13">aws_byte_buf_is_bounded</a>(const struct <a href="../../../include/aws/common/byte_buf.h.html#25">aws_byte_buf</a> *const buf, const size_t max_size) {</div><div id="14" class="line hit">   14     return (buf-&gt;<a href="../../../include/aws/common/byte_buf.h.html#29">capacity</a> &lt;= max_size);</div><div id="15" class="line hit">   15 }</div><div id="16" class="line none">   16 </div><div id="17" class="line none">   17 bool <a href="make_common_data_structures.c.html#17">aws_byte_buf_has_allocator</a>(const struct <a href="../../../include/aws/common/byte_buf.h.html#25">aws_byte_buf</a> *const buf) {</div><div id="18" class="line none">   18     return (buf-&gt;<a href="../../../include/aws/common/ring_buffer.h.html#19">allocator</a> == <a href="proof_allocators.c.html#68">can_fail_allocator</a>());</div><div id="19" class="line none">   19 }</div><div id="20" class="line none">   20 </div><div id="21" class="line none">   21 void <a href="make_common_data_structures.c.html#21">ensure_byte_buf_has_allocated_buffer_member</a>(struct <a href="../../../include/aws/common/byte_buf.h.html#25">aws_byte_buf</a> *const buf) {</div><div id="22" class="line hit">   22     if (buf) {</div><div id="23" class="line hit">   23         buf-&gt;<a href="../../../include/aws/common/ring_buffer.h.html#19">allocator</a> = (<a href="../include/proof_helpers/nondet.h.html#15">nondet_bool</a>()) ? NULL : <a href="proof_allocators.c.html#68">can_fail_allocator</a>();</div><div id="24" class="line hit">   24         buf-&gt;<a href="../../../include/aws/common/byte_buf.h.html#28">buffer</a> = <a href="proof_allocators.c.html#76">can_fail_malloc</a>(sizeof(*(buf-&gt;<a href="../../../include/aws/common/byte_buf.h.html#28">buffer</a>)) * buf-&gt;<a href="../../../include/aws/common/byte_buf.h.html#29">capacity</a>);</div><div id="25" class="line hit">   25     }</div><div id="26" class="line hit">   26 }</div><div id="27" class="line none">   27 </div><div id="28" class="line none">   28 void <a href="make_common_data_structures.c.html#28">ensure_ring_buffer_has_allocated_members</a>(struct <a href="../../../include/aws/common/ring_buffer.h.html#18">aws_ring_buffer</a> *ring_buf, const size_t <a href="../../../include/aws/common/private/hash_table_impl.h.html#35">size</a>) {</div><div id="29" class="line none">   29     ring_buf-&gt;<a href="../../../include/aws/common/ring_buffer.h.html#19">allocator</a> = <a href="proof_allocators.c.html#68">can_fail_allocator</a>();</div><div id="30" class="line none">   30     /* The `aws_ring_buffer_init` function requires size &gt; 0. */</div><div id="31" class="line none">   31     __CPROVER_assume(0 &lt; <a href="../../../include/aws/common/private/hash_table_impl.h.html#35">size</a>);</div><div id="32" class="line none">   32     ring_buf-&gt;<a href="../../../include/aws/common/ring_buffer.h.html#20">allocation</a> = <a href="proof_allocators.c.html#62">bounded_malloc</a>(sizeof(*(ring_buf-&gt;<a href="../../../include/aws/common/ring_buffer.h.html#20">allocation</a>)) * <a href="../../../include/aws/common/private/hash_table_impl.h.html#35">size</a>);</div><div id="33" class="line none">   33     size_t position_head;</div><div id="34" class="line none">   34     size_t position_tail;</div><div id="35" class="line none">   35     __CPROVER_assume(position_head &lt; <a href="../../../include/aws/common/private/hash_table_impl.h.html#35">size</a>);</div><div id="36" class="line none">   36     __CPROVER_assume(position_tail &lt; <a href="../../../include/aws/common/private/hash_table_impl.h.html#35">size</a>);</div><div id="37" class="line none">   37     <a href="../../../include/aws/common/atomics.inl.html#42">aws_atomic_store_ptr</a>(&amp;ring_buf-&gt;<a href="../../../include/aws/common/linked_list.h.html#19">head</a>, (ring_buf-&gt;<a href="../../../include/aws/common/ring_buffer.h.html#20">allocation</a> + position_head));</div><div id="38" class="line none">   38     <a href="../../../include/aws/common/atomics.inl.html#42">aws_atomic_store_ptr</a>(&amp;ring_buf-&gt;<a href="../../../include/aws/common/linked_list.h.html#20">tail</a>, (ring_buf-&gt;<a href="../../../include/aws/common/ring_buffer.h.html#20">allocation</a> + position_tail));</div><div id="39" class="line none">   39     ring_buf-&gt;<a href="../../../include/aws/common/ring_buffer.h.html#23">allocation_end</a> = ring_buf-&gt;<a href="../../../include/aws/common/ring_buffer.h.html#20">allocation</a> + <a href="../../../include/aws/common/private/hash_table_impl.h.html#35">size</a>;</div><div id="40" class="line none">   40 }</div><div id="41" class="line none">   41 </div><div id="42" class="line none">   42 /**</div><div id="43" class="line none">   43  * Constrain a buffer to point-into and be contained within a range [lo,hi]</div><div id="44" class="line none">   44  */</div><div id="45" class="line none">   45 void <a href="make_common_data_structures.c.html#45">ensure_byte_buf_has_allocated_buffer_member_in_range</a>(struct <a href="../../../include/aws/common/byte_buf.h.html#25">aws_byte_buf</a> *buf, uint8_t *lo, uint8_t *hi) {</div><div id="46" class="line none">   46     assert(lo &lt; hi);</div><div id="47" class="line none">   47     size_t space = hi - lo;</div><div id="48" class="line none">   48     size_t pos;</div><div id="49" class="line none">   49     __CPROVER_assume(pos &lt; space);</div><div id="50" class="line none">   50     buf-&gt;<a href="../../../include/aws/common/byte_buf.h.html#28">buffer</a> = lo + pos;</div><div id="51" class="line none">   51     size_t max_capacity = hi - buf-&gt;<a href="../../../include/aws/common/byte_buf.h.html#28">buffer</a>;</div><div id="52" class="line none">   52     assert(0 &lt; max_capacity);</div><div id="53" class="line none">   53     __CPROVER_assume(0 &lt; buf-&gt;<a href="../../../include/aws/common/byte_buf.h.html#29">capacity</a> &amp;&amp; buf-&gt;<a href="../../../include/aws/common/byte_buf.h.html#29">capacity</a> &lt;= max_capacity);</div><div id="54" class="line none">   54 }</div><div id="55" class="line none">   55 </div><div id="56" class="line none">   56 /**</div><div id="57" class="line none">   57  * Constrain a buffer to point-into the valid elements of a ring_buffer</div><div id="58" class="line none">   58  */</div><div id="59" class="line none">   59 void <a href="make_common_data_structures.c.html#59">ensure_byte_buf_has_allocated_buffer_member_in_ring_buf</a>(</div><div id="60" class="line none">   60     struct <a href="../../../include/aws/common/byte_buf.h.html#25">aws_byte_buf</a> *buf,</div><div id="61" class="line none">   61     struct <a href="../../../include/aws/common/ring_buffer.h.html#18">aws_ring_buffer</a> *ring_buf) {</div><div id="62" class="line none">   62     buf-&gt;<a href="../../../include/aws/common/ring_buffer.h.html#19">allocator</a> = (<a href="../include/proof_helpers/nondet.h.html#15">nondet_bool</a>()) ? NULL : <a href="proof_allocators.c.html#68">can_fail_allocator</a>();</div><div id="63" class="line none">   63     uint8_t *<a href="../../../include/aws/common/linked_list.h.html#19">head</a> = <a href="../../../include/aws/common/atomics.inl.html#26">aws_atomic_load_ptr</a>(&amp;ring_buf-&gt;<a href="../../../include/aws/common/linked_list.h.html#19">head</a>);</div><div id="64" class="line none">   64     uint8_t *<a href="../../../include/aws/common/linked_list.h.html#20">tail</a> = <a href="../../../include/aws/common/atomics.inl.html#26">aws_atomic_load_ptr</a>(&amp;ring_buf-&gt;<a href="../../../include/aws/common/linked_list.h.html#20">tail</a>);</div><div id="65" class="line none">   65     if (<a href="../../../include/aws/common/linked_list.h.html#19">head</a> &lt; <a href="../../../include/aws/common/linked_list.h.html#20">tail</a>) { /* [....H    T....] */</div><div id="66" class="line none">   66         if (<a href="../include/proof_helpers/nondet.h.html#15">nondet_bool</a>()) {</div><div id="67" class="line none">   67             __CPROVER_assume(<a href="../../../include/aws/common/linked_list.h.html#20">tail</a> &lt; ring_buf-&gt;<a href="../../../include/aws/common/ring_buffer.h.html#23">allocation_end</a>);</div><div id="68" class="line none">   68             <a href="make_common_data_structures.c.html#45">ensure_byte_buf_has_allocated_buffer_member_in_range</a>(buf, <a href="../../../include/aws/common/linked_list.h.html#20">tail</a>, ring_buf-&gt;<a href="../../../include/aws/common/ring_buffer.h.html#23">allocation_end</a>);</div><div id="69" class="line none">   69         } else {</div><div id="70" class="line none">   70             __CPROVER_assume(ring_buf-&gt;<a href="../../../include/aws/common/ring_buffer.h.html#20">allocation</a> &lt; <a href="../../../include/aws/common/linked_list.h.html#19">head</a>);</div><div id="71" class="line none">   71             <a href="make_common_data_structures.c.html#45">ensure_byte_buf_has_allocated_buffer_member_in_range</a>(buf, ring_buf-&gt;<a href="../../../include/aws/common/ring_buffer.h.html#20">allocation</a>, <a href="../../../include/aws/common/linked_list.h.html#19">head</a>);</div><div id="72" class="line none">   72         }</div><div id="73" class="line none">   73     } else { /* [    T....H    ] */</div><div id="74" class="line none">   74         <a href="make_common_data_structures.c.html#45">ensure_byte_buf_has_allocated_buffer_member_in_range</a>(buf, <a href="../../../include/aws/common/linked_list.h.html#20">tail</a>, <a href="../../../include/aws/common/linked_list.h.html#19">head</a>);</div><div id="75" class="line none">   75     }</div><div id="76" class="line none">   76 }</div><div id="77" class="line none">   77 </div><div id="78" class="line none">   78 bool <a href="make_common_data_structures.c.html#78">aws_byte_cursor_is_bounded</a>(const struct <a href="../../../include/aws/common/byte_buf.h.html#38">aws_byte_cursor</a> *const cursor, const size_t max_size) {</div><div id="79" class="line none">   79     return cursor-&gt;<a href="../../../include/aws/common/byte_buf.h.html#27">len</a> &lt;= max_size;</div><div id="80" class="line none">   80 }</div><div id="81" class="line none">   81 </div><div id="82" class="line none">   82 void <a href="make_common_data_structures.c.html#82">ensure_byte_cursor_has_allocated_buffer_member</a>(struct <a href="../../../include/aws/common/byte_buf.h.html#38">aws_byte_cursor</a> *const cursor) {</div><div id="83" class="line none">   83     if (cursor != NULL) {</div><div id="84" class="line none">   84         cursor-&gt;<a href="../../../include/aws/common/byte_buf.h.html#41">ptr</a> = <a href="proof_allocators.c.html#62">bounded_malloc</a>(cursor-&gt;<a href="../../../include/aws/common/byte_buf.h.html#27">len</a>);</div><div id="85" class="line none">   85     }</div><div id="86" class="line none">   86 }</div><div id="87" class="line none">   87 </div><div id="88" class="line none">   88 bool <a href="make_common_data_structures.c.html#88">aws_array_list_is_bounded</a>(</div><div id="89" class="line none">   89     const struct <a href="../../../include/aws/common/array_list.h.html#15">aws_array_list</a> *const list,</div><div id="90" class="line none">   90     const size_t max_initial_item_allocation,</div><div id="91" class="line none">   91     const size_t max_item_size) {</div><div id="92" class="line none">   92     bool item_size_is_bounded = list-&gt;<a href="../../../include/aws/common/array_list.h.html#19">item_size</a> &lt;= max_item_size;</div><div id="93" class="line none">   93     bool length_is_bounded = list-&gt;<a href="../../../include/aws/common/array_list.h.html#18">length</a> &lt;= max_initial_item_allocation;</div><div id="94" class="line none">   94     return item_size_is_bounded &amp;&amp; length_is_bounded;</div><div id="95" class="line none">   95 }</div><div id="96" class="line none">   96 </div><div id="97" class="line none">   97 void <a href="make_common_data_structures.c.html#97">ensure_array_list_has_allocated_data_member</a>(struct <a href="../../../include/aws/common/array_list.h.html#15">aws_array_list</a> *const list) {</div><div id="98" class="line none">   98     list-&gt;<a href="../../../include/aws/common/array_list.h.html#20">data</a> = <a href="proof_allocators.c.html#76">can_fail_malloc</a>(list-&gt;<a href="../../../include/aws/common/array_list.h.html#17">current_size</a>);</div><div id="99" class="line none">   99     list-&gt;<a href="../../../include/aws/common/array_list.h.html#16">alloc</a> = <a href="../include/proof_helpers/nondet.h.html#15">nondet_bool</a>() ? NULL : <a href="proof_allocators.c.html#68">can_fail_allocator</a>();</div><div id="100" class="line none">  100 }</div><div id="101" class="line none">  101 </div><div id="102" class="line none">  102 void <a href="make_common_data_structures.c.html#102">ensure_linked_list_is_allocated</a>(struct <a href="../../../include/aws/common/linked_list.h.html#18">aws_linked_list</a> *const list, size_t max_length) {</div><div id="103" class="line none">  103     list-&gt;<a href="../../../include/aws/common/linked_list.h.html#19">head</a>.<a href="../../../include/aws/common/linked_list.h.html#15">prev</a> = NULL;</div><div id="104" class="line none">  104     list-&gt;<a href="../../../include/aws/common/linked_list.h.html#20">tail</a>.<a href="../../../include/aws/common/linked_list.h.html#14">next</a> = NULL;</div><div id="105" class="line none">  105 </div><div id="106" class="line none">  106     struct <a href="../../../include/aws/common/linked_list.h.html#13">aws_linked_list_node</a> *curr = &amp;list-&gt;<a href="../../../include/aws/common/linked_list.h.html#19">head</a>;</div><div id="107" class="line none">  107 </div><div id="108" class="line none">  108     for (size_t i = 0; i &lt; max_length; i++) {</div><div id="109" class="line none">  109         struct <a href="../../../include/aws/common/linked_list.h.html#13">aws_linked_list_node</a> *node = malloc(sizeof(struct <a href="../../../include/aws/common/linked_list.h.html#13">aws_linked_list_node</a>));</div><div id="110" class="line none">  110         if (!node)</div><div id="111" class="line none">  111             break;</div><div id="112" class="line none">  112 </div><div id="113" class="line none">  113         curr-&gt;<a href="../../../include/aws/common/linked_list.h.html#14">next</a> = node;</div><div id="114" class="line none">  114         node-&gt;<a href="../../../include/aws/common/linked_list.h.html#15">prev</a> = curr;</div><div id="115" class="line none">  115         curr = node;</div><div id="116" class="line none">  116     }</div><div id="117" class="line none">  117 </div><div id="118" class="line none">  118     curr-&gt;<a href="../../../include/aws/common/linked_list.h.html#14">next</a> = &amp;list-&gt;<a href="../../../include/aws/common/linked_list.h.html#20">tail</a>;</div><div id="119" class="line none">  119     list-&gt;<a href="../../../include/aws/common/linked_list.h.html#20">tail</a>.<a href="../../../include/aws/common/linked_list.h.html#15">prev</a> = curr;</div><div id="120" class="line none">  120 }</div><div id="121" class="line none">  121 </div><div id="122" class="line none">  122 bool <a href="make_common_data_structures.c.html#122">aws_priority_queue_is_bounded</a>(</div><div id="123" class="line none">  123     const struct <a href="../../../include/aws/common/priority_queue.h.html#20">aws_priority_queue</a> *const queue,</div><div id="124" class="line none">  124     const size_t max_initial_item_allocation,</div><div id="125" class="line none">  125     const size_t max_item_size) {</div><div id="126" class="line none">  126     bool container_is_bounded =</div><div id="127" class="line none">  127         <a href="make_common_data_structures.c.html#88">aws_array_list_is_bounded</a>(&amp;queue-&gt;<a href="../../../include/aws/common/priority_queue.h.html#29">container</a>, max_initial_item_allocation, max_item_size);</div><div id="128" class="line none">  128 </div><div id="129" class="line none">  129     /* The backpointer list holds pointers to [struct</div><div id="130" class="line none">  130      * aws_priority_queue_node] and so the max_item_size should be</div><div id="131" class="line none">  131      * larger than the pointer size. */</div><div id="132" class="line none">  132     bool backpointers_list_is_bounded = <a href="make_common_data_structures.c.html#88">aws_array_list_is_bounded</a>(</div><div id="133" class="line none">  133         &amp;queue-&gt;<a href="../../../include/aws/common/priority_queue.h.html#40">backpointers</a>, max_initial_item_allocation, sizeof(struct <a href="../../../include/aws/common/priority_queue.h.html#43">aws_priority_queue_node</a> *));</div><div id="134" class="line none">  134     return container_is_bounded &amp;&amp; backpointers_list_is_bounded;</div><div id="135" class="line none">  135 }</div><div id="136" class="line none">  136 </div><div id="137" class="line none">  137 void <a href="make_common_data_structures.c.html#137">ensure_priority_queue_has_allocated_members</a>(struct <a href="../../../include/aws/common/priority_queue.h.html#20">aws_priority_queue</a> *const queue) {</div><div id="138" class="line none">  138     <a href="make_common_data_structures.c.html#97">ensure_array_list_has_allocated_data_member</a>(&amp;queue-&gt;<a href="../../../include/aws/common/priority_queue.h.html#29">container</a>);</div><div id="139" class="line none">  139     <a href="make_common_data_structures.c.html#97">ensure_array_list_has_allocated_data_member</a>(&amp;queue-&gt;<a href="../../../include/aws/common/priority_queue.h.html#40">backpointers</a>);</div><div id="140" class="line none">  140     queue-&gt;<a href="../../../include/aws/common/priority_queue.h.html#24">pred</a> = <a href="utils.c.html#107">nondet_compare</a>;</div><div id="141" class="line none">  141 }</div><div id="142" class="line none">  142 </div><div id="143" class="line none">  143 void <a href="make_common_data_structures.c.html#143">ensure_allocated_hash_table</a>(struct <a href="../../../include/aws/common/hash_table.h.html#48">aws_hash_table</a> *<a href="../../../include/aws/common/hash_table.h.html#75">map</a>, size_t max_table_entries) {</div><div id="144" class="line none">  144     if (<a href="../../../include/aws/common/hash_table.h.html#75">map</a> == NULL) {</div><div id="145" class="line none">  145         return;</div><div id="146" class="line none">  146     }</div><div id="147" class="line none">  147     size_t num_entries;</div><div id="148" class="line none">  148     __CPROVER_assume(num_entries &lt;= max_table_entries);</div><div id="149" class="line none">  149     __CPROVER_assume(<a href="../../../include/aws/common/math.inl.html#159">aws_is_power_of_two</a>(num_entries));</div><div id="150" class="line none">  150 </div><div id="151" class="line none">  151     size_t required_bytes;</div><div id="152" class="line none">  152     __CPROVER_assume(!<a href="../../../include/aws/common/private/hash_table_impl.h.html#60">hash_table_state_required_bytes</a>(num_entries, &amp;required_bytes));</div><div id="153" class="line none">  153     struct <a href="../../../include/aws/common/hash_table.h.html#47">hash_table_state</a> *<a href="../../../include/aws/common/allocator.h.html#22">impl</a> = <a href="proof_allocators.c.html#62">bounded_malloc</a>(required_bytes);</div><div id="154" class="line none">  154     if (<a href="../../../include/aws/common/allocator.h.html#22">impl</a>) {</div><div id="155" class="line none">  155         <a href="../../../include/aws/common/allocator.h.html#22">impl</a>-&gt;<a href="../../../include/aws/common/private/hash_table_impl.h.html#35">size</a> = num_entries;</div><div id="156" class="line none">  156         <a href="../../../include/aws/common/hash_table.h.html#75">map</a>-&gt;<a href="../../../include/aws/common/hash_table.h.html#49">p_impl</a> = <a href="../../../include/aws/common/allocator.h.html#22">impl</a>;</div><div id="157" class="line none">  157     } else {</div><div id="158" class="line none">  158         <a href="../../../include/aws/common/hash_table.h.html#75">map</a>-&gt;<a href="../../../include/aws/common/hash_table.h.html#49">p_impl</a> = NULL;</div><div id="159" class="line none">  159     }</div><div id="160" class="line none">  160 }</div><div id="161" class="line none">  161 </div><div id="162" class="line none">  162 void <a href="make_common_data_structures.c.html#162">ensure_hash_table_has_valid_destroy_functions</a>(struct <a href="../../../include/aws/common/hash_table.h.html#48">aws_hash_table</a> *<a href="../../../include/aws/common/hash_table.h.html#75">map</a>) {</div><div id="163" class="line none">  163     <a href="../../../include/aws/common/hash_table.h.html#75">map</a>-&gt;<a href="../../../include/aws/common/hash_table.h.html#49">p_impl</a>-&gt;<a href="../../../include/aws/common/private/hash_table_impl.h.html#31">destroy_key_fn</a> = <a href="../include/proof_helpers/nondet.h.html#15">nondet_bool</a>() ? NULL : <a href="make_common_data_structures.c.html#185">hash_proof_destroy_noop</a>;</div><div id="164" class="line none">  164     <a href="../../../include/aws/common/hash_table.h.html#75">map</a>-&gt;<a href="../../../include/aws/common/hash_table.h.html#49">p_impl</a>-&gt;<a href="../../../include/aws/common/private/hash_table_impl.h.html#32">destroy_value_fn</a> = <a href="../include/proof_helpers/nondet.h.html#15">nondet_bool</a>() ? NULL : <a href="make_common_data_structures.c.html#185">hash_proof_destroy_noop</a>;</div><div id="165" class="line none">  165 }</div><div id="166" class="line none">  166 </div><div id="167" class="line none">  167 bool <a href="make_common_data_structures.c.html#167">aws_hash_table_has_an_empty_slot</a>(const struct <a href="../../../include/aws/common/hash_table.h.html#48">aws_hash_table</a> *const <a href="../../../include/aws/common/hash_table.h.html#75">map</a>, size_t *const rval) {</div><div id="168" class="line none">  168     return <a href="make_common_data_structures.c.html#171">hash_table_state_has_an_empty_slot</a>(<a href="../../../include/aws/common/hash_table.h.html#75">map</a>-&gt;<a href="../../../include/aws/common/hash_table.h.html#49">p_impl</a>, rval);</div><div id="169" class="line none">  169 }</div><div id="170" class="line none">  170 </div><div id="171" class="line none">  171 bool <a href="make_common_data_structures.c.html#171">hash_table_state_has_an_empty_slot</a>(const struct <a href="../../../include/aws/common/hash_table.h.html#47">hash_table_state</a> *const state, size_t *const rval) {</div><div id="172" class="line none">  172     __CPROVER_assume(state-&gt;<a href="../../../include/aws/common/private/hash_table_impl.h.html#35">entry_count</a> &gt; 0);</div><div id="173" class="line none">  173     size_t empty_slot_idx;</div><div id="174" class="line none">  174     __CPROVER_assume(empty_slot_idx &lt; state-&gt;<a href="../../../include/aws/common/private/hash_table_impl.h.html#35">size</a>);</div><div id="175" class="line none">  175     *rval = empty_slot_idx;</div><div id="176" class="line none">  176     return state-&gt;<a href="../../../include/aws/common/private/hash_table_impl.h.html#41">slots</a>[empty_slot_idx].<a href="../../../include/aws/common/private/hash_table_impl.h.html#15">hash_code</a> == 0;</div><div id="177" class="line none">  177 }</div><div id="178" class="line none">  178 </div><div id="179" class="line none">  179 /**</div><div id="180" class="line none">  180  * A correct implementation of the hash_destroy function should never have a memory</div><div id="181" class="line none">  181  * error on valid input. There is the question of whether the destroy functions themselves</div><div id="182" class="line none">  182  * are correctly called (i.e. only on valid input, no double free, etc.).  This will be tested in</div><div id="183" class="line none">  183  * future proofs.</div><div id="184" class="line none">  184  */</div><div id="185" class="line none">  185 void <a href="make_common_data_structures.c.html#185">hash_proof_destroy_noop</a>(void *p) {}</div><div id="186" class="line none">  186 </div><div id="187" class="line none">  187 struct <a href="../../../include/aws/common/string.h.html#41">aws_string</a> *<a href="make_common_data_structures.c.html#187">ensure_string_is_allocated_nondet_length</a>() {</div><div id="188" class="line none">  188     /* Considers any size up to the maximum possible size for the array [bytes] in aws_string */</div><div id="189" class="line none">  189     return <a href="make_common_data_structures.c.html#192">nondet_allocate_string_bounded_length</a>(SIZE_MAX - 1 - sizeof(struct <a href="../../../include/aws/common/string.h.html#41">aws_string</a>));</div><div id="190" class="line none">  190 }</div><div id="191" class="line none">  191 </div><div id="192" class="line none">  192 struct <a href="../../../include/aws/common/string.h.html#41">aws_string</a> *<a href="make_common_data_structures.c.html#192">nondet_allocate_string_bounded_length</a>(size_t max_size) {</div><div id="193" class="line none">  193     size_t <a href="../../../include/aws/common/byte_buf.h.html#27">len</a>;</div><div id="194" class="line none">  194     __CPROVER_assume(<a href="../../../include/aws/common/byte_buf.h.html#27">len</a> &lt; max_size);</div><div id="195" class="line none">  195     return <a href="make_common_data_structures.c.html#198">ensure_string_is_allocated</a>(<a href="../../../include/aws/common/byte_buf.h.html#27">len</a>);</div><div id="196" class="line none">  196 }</div><div id="197" class="line none">  197 </div><div id="198" class="line none">  198 struct <a href="../../../include/aws/common/string.h.html#41">aws_string</a> *<a href="make_common_data_structures.c.html#198">ensure_string_is_allocated</a>(size_t <a href="../../../include/aws/common/byte_buf.h.html#27">len</a>) {</div><div id="199" class="line none">  199     struct <a href="../../../include/aws/common/string.h.html#41">aws_string</a> *str = <a href="proof_allocators.c.html#62">bounded_malloc</a>(sizeof(struct <a href="../../../include/aws/common/string.h.html#41">aws_string</a>) + <a href="../../../include/aws/common/byte_buf.h.html#27">len</a> + 1);</div><div id="200" class="line none">  200     if (str == NULL) {</div><div id="201" class="line none">  201         return NULL;</div><div id="202" class="line none">  202     }</div><div id="203" class="line none">  203 </div><div id="204" class="line none">  204     /* Fields are declared const, so we need to copy them in like this */</div><div id="205" class="line none">  205     if (str != NULL) {</div><div id="206" class="line none">  206         *(struct <a href="../../../include/aws/common/allocator.h.html#15">aws_allocator</a> **)(&amp;str-&gt;<a href="../../../include/aws/common/ring_buffer.h.html#19">allocator</a>) = <a href="../include/proof_helpers/nondet.h.html#15">nondet_bool</a>() ? <a href="proof_allocators.c.html#68">can_fail_allocator</a>() : NULL;</div><div id="207" class="line none">  207         *(size_t *)(&amp;str-&gt;<a href="../../../include/aws/common/byte_buf.h.html#27">len</a>) = <a href="../../../include/aws/common/byte_buf.h.html#27">len</a>;</div><div id="208" class="line none">  208         *(uint8_t *)&amp;str-&gt;<a href="../../../include/aws/common/string.h.html#45">bytes</a>[<a href="../../../include/aws/common/byte_buf.h.html#27">len</a>] = '\0';</div><div id="209" class="line none">  209     }</div><div id="210" class="line none">  210     return str;</div><div id="211" class="line none">  211 }</div><div id="212" class="line none">  212 </div><div id="213" class="line none">  213 const char *<a href="make_common_data_structures.c.html#213">ensure_c_str_is_allocated</a>(size_t max_size) {</div><div id="214" class="line hit">  214     size_t cap;</div><div id="215" class="line hit">  215     __CPROVER_assume(cap &gt; 0 &amp;&amp; cap &lt;= max_size);</div><div id="216" class="line hit">  216     const char *str = <a href="proof_allocators.c.html#62">bounded_malloc</a>(cap);</div><div id="217" class="line none">  217     /* Ensure that its a valid c string. Since all bytes are nondeterminstic, the actual</div><div id="218" class="line none">  218      * string length is 0..str_cap</div><div id="219" class="line none">  219      */</div><div id="220" class="line hit">  220     __CPROVER_assume(<a href="../include/proof_helpers/utils.h.html#19">IMPLIES</a>(str != NULL, str[cap - 1] == '\0'));</div><div id="221" class="line hit">  221     return str;</div><div id="222" class="line hit">  222 }</div>
</div>
</body>
</html>
