
<html>
<head>
<title>verification/cbmc/sources/cbmc_invariants.c</title>
<link rel="stylesheet" type="text/css" href="../../../viewer.css">
</head>

<body>
<div class="code">
<div id="1" class="line none">    1 /*</div><div id="2" class="line none">    2  * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.</div><div id="3" class="line none">    3  *</div><div id="4" class="line none">    4  * Licensed under the Apache License, Version 2.0 (the "License"). You may not use</div><div id="5" class="line none">    5  * this file except in compliance with the License. A copy of the License is</div><div id="6" class="line none">    6  * located at</div><div id="7" class="line none">    7  *</div><div id="8" class="line none">    8  *     http://aws.amazon.com/apache2.0/</div><div id="9" class="line none">    9  *</div><div id="10" class="line none">   10  * or in the "license" file accompanying this file. This file is distributed on an</div><div id="11" class="line none">   11  * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or</div><div id="12" class="line none">   12  * implied. See the License for the specific language governing permissions and</div><div id="13" class="line none">   13  * limitations under the License.</div><div id="14" class="line none">   14  */</div><div id="15" class="line none">   15 </div><div id="16" class="line none">   16 #include &lt;cbmc_invariants.h&gt;</div><div id="17" class="line none">   17 </div><div id="18" class="line none">   18 #include &lt;ec_utils.h&gt;</div><div id="19" class="line none">   19 #include &lt;evp_utils.h&gt;</div><div id="20" class="line none">   20 </div><div id="21" class="line none">   21 #include &lt;cipher_openssl.h&gt;</div><div id="22" class="line none">   22 </div><div id="23" class="line none">   23 bool <a href="cbmc_invariants.c.html#23">aws_cryptosdk_md_context_is_valid_cbmc</a>(struct <a href="../../../include/aws/cryptosdk/private/cipher.h.html#47">aws_cryptosdk_md_context</a> *md_context) {</div><div id="24" class="line none">   24     return <a href="../../../source/cipher_openssl.c.html#96">aws_cryptosdk_md_context_is_valid</a>(md_context) &amp;&amp; <a href="openssl/evp_override.c.html#1035">evp_md_ctx_is_valid</a>(md_context-&gt;<a href="../../../source/cipher_openssl.c.html#93">evp_md_ctx</a>);</div><div id="25" class="line none">   25 }</div><div id="26" class="line none">   26 </div><div id="27" class="line none">   27 bool <a href="cbmc_invariants.c.html#27">aws_cryptosdk_sig_ctx_is_valid_cbmc</a>(struct <a href="../../../include/aws/cryptosdk/cipher.h.html#132">aws_cryptosdk_sig_ctx</a> *sig_ctx) {</div><div id="28" class="line none">   28     return <a href="../../../source/cipher_openssl.c.html#82">aws_cryptosdk_sig_ctx_is_valid</a>(sig_ctx) &amp;&amp; <a href="openssl/ec_override.c.html#396">ec_key_is_valid</a>(sig_ctx-&gt;<a href="../../../source/cipher_openssl.c.html#76">keypair</a>) &amp;&amp;</div><div id="29" class="line none">   29            <a href="openssl/evp_override.c.html#994">evp_pkey_is_valid</a>(sig_ctx-&gt;<a href="../../../source/cipher_openssl.c.html#77">pkey</a>) &amp;&amp; <a href="openssl/evp_override.c.html#1035">evp_md_ctx_is_valid</a>(sig_ctx-&gt;<a href="../../../source/cipher_openssl.c.html#78">ctx</a>) &amp;&amp;</div><div id="30" class="line none">   30            // The EVP_PKEY has a reference to the EC_KEY</div><div id="31" class="line none">   31            (<a href="openssl/ec_override.c.html#414">ec_key_get_reference_count</a>(sig_ctx-&gt;<a href="../../../source/cipher_openssl.c.html#76">keypair</a>) &gt;= 2) &amp;&amp;</div><div id="32" class="line none">   32            // If the context is in verify mode, the EVP_MD_CTX holds an extra reference to the EVP_PKEY</div><div id="33" class="line none">   33            (<a href="openssl/evp_override.c.html#1005">evp_pkey_get_reference_count</a>(sig_ctx-&gt;<a href="../../../source/cipher_openssl.c.html#77">pkey</a>) &gt;= (sig_ctx-&gt;<a href="../../../source/cipher_openssl.c.html#79">is_sign</a> ? 1 : 2)) &amp;&amp;</div><div id="34" class="line none">   34            (<a href="openssl/evp_override.c.html#1056">evp_md_ctx_get0_evp_pkey</a>(sig_ctx-&gt;<a href="../../../source/cipher_openssl.c.html#78">ctx</a>) == (sig_ctx-&gt;<a href="../../../source/cipher_openssl.c.html#79">is_sign</a> ? NULL : sig_ctx-&gt;<a href="../../../source/cipher_openssl.c.html#77">pkey</a>));</div><div id="35" class="line none">   35 }</div>
</div>
</body>
</html>
