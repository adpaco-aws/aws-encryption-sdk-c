
<html>
<head>
<title>verification/cbmc/aws-c-common/include/aws/common/array_list.inl</title>
<link rel="stylesheet" type="text/css" href="../../../../../../viewer.css">
</head>

<body>
<div class="code">
<div id="1" class="line none">    1 #ifndef AWS_COMMON_ARRAY_LIST_INL</div><div id="2" class="line none">    2 #define AWS_COMMON_ARRAY_LIST_INL</div><div id="3" class="line none">    3 </div><div id="4" class="line none">    4 /**</div><div id="5" class="line none">    5  * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.</div><div id="6" class="line none">    6  * SPDX-License-Identifier: Apache-2.0.</div><div id="7" class="line none">    7  */</div><div id="8" class="line none">    8 </div><div id="9" class="line none">    9 /* This is implicitly included, but helps with editor highlighting */</div><div id="10" class="line none">   10 #include &lt;aws/common/array_list.h&gt;</div><div id="11" class="line none">   11 /*</div><div id="12" class="line none">   12  * Do not add system headers here; add them to array_list.h. This file is included under extern "C" guards,</div><div id="13" class="line none">   13  * which might break system headers.</div><div id="14" class="line none">   14  */</div><div id="15" class="line none">   15 AWS_EXTERN_C_BEGIN</div><div id="16" class="line none">   16 </div><div id="17" class="line none">   17 AWS_STATIC_IMPL</div><div id="18" class="line none">   18 int <a href="array_list.inl.html#18">aws_array_list_init_dynamic</a>(</div><div id="19" class="line none">   19     struct <a href="array_list.h.html#15">aws_array_list</a> *AWS_RESTRICT list,</div><div id="20" class="line none">   20     struct <a href="allocator.h.html#15">aws_allocator</a> *<a href="array_list.h.html#16">alloc</a>,</div><div id="21" class="line none">   21     size_t initial_item_allocation,</div><div id="22" class="line none">   22     size_t <a href="array_list.h.html#19">item_size</a>) {</div><div id="23" class="line none">   23 </div><div id="24" class="line none">   24     AWS_FATAL_PRECONDITION(list != NULL);</div><div id="25" class="line none">   25     AWS_FATAL_PRECONDITION(<a href="array_list.h.html#16">alloc</a> != NULL);</div><div id="26" class="line none">   26     AWS_FATAL_PRECONDITION(<a href="array_list.h.html#19">item_size</a> &gt; 0);</div><div id="27" class="line none">   27 </div><div id="28" class="line none">   28     AWS_ZERO_STRUCT(*list);</div><div id="29" class="line none">   29 </div><div id="30" class="line none">   30     size_t allocation_size;</div><div id="31" class="line none">   31     if (<a href="math.inl.html#99">aws_mul_size_checked</a>(initial_item_allocation, <a href="array_list.h.html#19">item_size</a>, &amp;allocation_size)) {</div><div id="32" class="line none">   32         goto error;</div><div id="33" class="line none">   33     }</div><div id="34" class="line none">   34 </div><div id="35" class="line none">   35     if (allocation_size &gt; 0) {</div><div id="36" class="line none">   36         list-&gt;<a href="array_list.h.html#20">data</a> = <a href="../../../verification/cbmc/sources/proof_allocators.c.html#116">aws_mem_acquire</a>(<a href="array_list.h.html#16">alloc</a>, allocation_size);</div><div id="37" class="line none">   37         if (!list-&gt;<a href="array_list.h.html#20">data</a>) {</div><div id="38" class="line none">   38             goto error;</div><div id="39" class="line none">   39         }</div><div id="40" class="line none">   40 #ifdef DEBUG_BUILD</div><div id="41" class="line none">   41         memset(list-&gt;<a href="array_list.h.html#20">data</a>, <a href="array_list.h.html#13">AWS_ARRAY_LIST_DEBUG_FILL</a>, allocation_size);</div><div id="42" class="line none">   42 </div><div id="43" class="line none">   43 #endif</div><div id="44" class="line none">   44         list-&gt;<a href="array_list.h.html#17">current_size</a> = allocation_size;</div><div id="45" class="line none">   45     }</div><div id="46" class="line none">   46     list-&gt;<a href="array_list.h.html#19">item_size</a> = <a href="array_list.h.html#19">item_size</a>;</div><div id="47" class="line none">   47     list-&gt;<a href="array_list.h.html#16">alloc</a> = <a href="array_list.h.html#16">alloc</a>;</div><div id="48" class="line none">   48 </div><div id="49" class="line none">   49     AWS_FATAL_POSTCONDITION(list-&gt;<a href="array_list.h.html#17">current_size</a> == 0 || list-&gt;<a href="array_list.h.html#20">data</a>);</div><div id="50" class="line none">   50     AWS_POSTCONDITION(<a href="array_list.inl.html#82">aws_array_list_is_valid</a>(list));</div><div id="51" class="line none">   51     return <a href="error.h.html#15">AWS_OP_SUCCESS</a>;</div><div id="52" class="line none">   52 </div><div id="53" class="line none">   53 error:</div><div id="54" class="line none">   54     AWS_POSTCONDITION(AWS_IS_ZEROED(*list));</div><div id="55" class="line none">   55     return <a href="error.h.html#16">AWS_OP_ERR</a>;</div><div id="56" class="line none">   56 }</div><div id="57" class="line none">   57 </div><div id="58" class="line none">   58 AWS_STATIC_IMPL</div><div id="59" class="line none">   59 void <a href="array_list.inl.html#59">aws_array_list_init_static</a>(</div><div id="60" class="line none">   60     struct <a href="array_list.h.html#15">aws_array_list</a> *AWS_RESTRICT list,</div><div id="61" class="line none">   61     void *raw_array,</div><div id="62" class="line none">   62     size_t item_count,</div><div id="63" class="line none">   63     size_t <a href="array_list.h.html#19">item_size</a>) {</div><div id="64" class="line none">   64 </div><div id="65" class="line none">   65     AWS_FATAL_PRECONDITION(list != NULL);</div><div id="66" class="line none">   66     AWS_FATAL_PRECONDITION(raw_array != NULL);</div><div id="67" class="line none">   67     AWS_FATAL_PRECONDITION(item_count &gt; 0);</div><div id="68" class="line none">   68     AWS_FATAL_PRECONDITION(<a href="array_list.h.html#19">item_size</a> &gt; 0);</div><div id="69" class="line none">   69 </div><div id="70" class="line none">   70     list-&gt;<a href="array_list.h.html#16">alloc</a> = NULL;</div><div id="71" class="line none">   71 </div><div id="72" class="line none">   72     int no_overflow = !<a href="math.inl.html#99">aws_mul_size_checked</a>(item_count, <a href="array_list.h.html#19">item_size</a>, &amp;list-&gt;<a href="array_list.h.html#17">current_size</a>);</div><div id="73" class="line none">   73     AWS_FATAL_PRECONDITION(no_overflow);</div><div id="74" class="line none">   74 </div><div id="75" class="line none">   75     list-&gt;<a href="array_list.h.html#19">item_size</a> = <a href="array_list.h.html#19">item_size</a>;</div><div id="76" class="line none">   76     list-&gt;<a href="array_list.h.html#18">length</a> = 0;</div><div id="77" class="line none">   77     list-&gt;<a href="array_list.h.html#20">data</a> = raw_array;</div><div id="78" class="line none">   78     AWS_POSTCONDITION(<a href="array_list.inl.html#82">aws_array_list_is_valid</a>(list));</div><div id="79" class="line none">   79 }</div><div id="80" class="line none">   80 </div><div id="81" class="line none">   81 AWS_STATIC_IMPL</div><div id="82" class="line none">   82 bool <a href="array_list.inl.html#82">aws_array_list_is_valid</a>(const struct <a href="array_list.h.html#15">aws_array_list</a> *AWS_RESTRICT list) {</div><div id="83" class="line none">   83     if (!list) {</div><div id="84" class="line none">   84         return false;</div><div id="85" class="line none">   85     }</div><div id="86" class="line none">   86     size_t required_size = 0;</div><div id="87" class="line none">   87     bool required_size_is_valid =</div><div id="88" class="line none">   88         (<a href="math.inl.html#99">aws_mul_size_checked</a>(list-&gt;<a href="array_list.h.html#18">length</a>, list-&gt;<a href="array_list.h.html#19">item_size</a>, &amp;required_size) == <a href="error.h.html#15">AWS_OP_SUCCESS</a>);</div><div id="89" class="line none">   89     bool current_size_is_valid = (list-&gt;<a href="array_list.h.html#17">current_size</a> &gt;= required_size);</div><div id="90" class="line none">   90     bool data_is_valid = AWS_IMPLIES(list-&gt;<a href="array_list.h.html#17">current_size</a> == 0, list-&gt;<a href="array_list.h.html#20">data</a> == NULL) &amp;&amp;</div><div id="91" class="line none">   91                          AWS_IMPLIES(list-&gt;<a href="array_list.h.html#17">current_size</a> != 0, AWS_MEM_IS_WRITABLE(list-&gt;<a href="array_list.h.html#20">data</a>, list-&gt;<a href="array_list.h.html#17">current_size</a>));</div><div id="92" class="line none">   92     bool item_size_is_valid = (list-&gt;<a href="array_list.h.html#19">item_size</a> != 0);</div><div id="93" class="line none">   93     return required_size_is_valid &amp;&amp; current_size_is_valid &amp;&amp; data_is_valid &amp;&amp; item_size_is_valid;</div><div id="94" class="line none">   94 }</div><div id="95" class="line none">   95 </div><div id="96" class="line none">   96 AWS_STATIC_IMPL</div><div id="97" class="line none">   97 void <a href="array_list.inl.html#97">aws_array_list_debug_print</a>(const struct <a href="array_list.h.html#15">aws_array_list</a> *list) {</div><div id="98" class="line none">   98     printf(</div><div id="99" class="line none">   99         "arraylist %p. Alloc %p. current_size %zu. length %zu. item_size %zu. data %p\n",</div><div id="100" class="line none">  100         (void *)list,</div><div id="101" class="line none">  101         (void *)list-&gt;<a href="array_list.h.html#16">alloc</a>,</div><div id="102" class="line none">  102         list-&gt;<a href="array_list.h.html#17">current_size</a>,</div><div id="103" class="line none">  103         list-&gt;<a href="array_list.h.html#18">length</a>,</div><div id="104" class="line none">  104         list-&gt;<a href="array_list.h.html#19">item_size</a>,</div><div id="105" class="line none">  105         (void *)list-&gt;<a href="array_list.h.html#20">data</a>);</div><div id="106" class="line none">  106 }</div><div id="107" class="line none">  107 </div><div id="108" class="line none">  108 AWS_STATIC_IMPL</div><div id="109" class="line none">  109 void <a href="array_list.inl.html#109">aws_array_list_clean_up</a>(struct <a href="array_list.h.html#15">aws_array_list</a> *AWS_RESTRICT list) {</div><div id="110" class="line none">  110     AWS_PRECONDITION(AWS_IS_ZEROED(*list) || <a href="array_list.inl.html#82">aws_array_list_is_valid</a>(list));</div><div id="111" class="line none">  111     if (list-&gt;<a href="array_list.h.html#16">alloc</a> &amp;&amp; list-&gt;<a href="array_list.h.html#20">data</a>) {</div><div id="112" class="line none">  112         <a href="../../../verification/cbmc/sources/proof_allocators.c.html#201">aws_mem_release</a>(list-&gt;<a href="array_list.h.html#16">alloc</a>, list-&gt;<a href="array_list.h.html#20">data</a>);</div><div id="113" class="line none">  113     }</div><div id="114" class="line none">  114 </div><div id="115" class="line none">  115     AWS_ZERO_STRUCT(*list);</div><div id="116" class="line none">  116 }</div><div id="117" class="line none">  117 </div><div id="118" class="line none">  118 AWS_STATIC_IMPL</div><div id="119" class="line none">  119 void <a href="array_list.inl.html#119">aws_array_list_clean_up_secure</a>(struct <a href="array_list.h.html#15">aws_array_list</a> *AWS_RESTRICT list) {</div><div id="120" class="line none">  120     AWS_PRECONDITION(AWS_IS_ZEROED(*list) || <a href="array_list.inl.html#82">aws_array_list_is_valid</a>(list));</div><div id="121" class="line none">  121     if (list-&gt;<a href="array_list.h.html#16">alloc</a> &amp;&amp; list-&gt;<a href="array_list.h.html#20">data</a>) {</div><div id="122" class="line none">  122         <a href="../../../source/common.c.html#27">aws_secure_zero</a>((void *)list-&gt;<a href="array_list.h.html#20">data</a>, list-&gt;<a href="array_list.h.html#17">current_size</a>);</div><div id="123" class="line none">  123         <a href="../../../verification/cbmc/sources/proof_allocators.c.html#201">aws_mem_release</a>(list-&gt;<a href="array_list.h.html#16">alloc</a>, list-&gt;<a href="array_list.h.html#20">data</a>);</div><div id="124" class="line none">  124     }</div><div id="125" class="line none">  125 </div><div id="126" class="line none">  126     AWS_ZERO_STRUCT(*list);</div><div id="127" class="line none">  127 }</div><div id="128" class="line none">  128 </div><div id="129" class="line none">  129 AWS_STATIC_IMPL</div><div id="130" class="line none">  130 int <a href="array_list.inl.html#130">aws_array_list_push_back</a>(struct <a href="array_list.h.html#15">aws_array_list</a> *AWS_RESTRICT list, const void *val) {</div><div id="131" class="line none">  131     AWS_PRECONDITION(<a href="array_list.inl.html#82">aws_array_list_is_valid</a>(list));</div><div id="132" class="line none">  132     AWS_PRECONDITION(</div><div id="133" class="line none">  133         val &amp;&amp; AWS_MEM_IS_READABLE(val, list-&gt;<a href="array_list.h.html#19">item_size</a>),</div><div id="134" class="line none">  134         "Input pointer [val] must point writable memory of [list-&gt;item_size] bytes.");</div><div id="135" class="line none">  135 </div><div id="136" class="line none">  136     int err_code = <a href="array_list.inl.html#348">aws_array_list_set_at</a>(list, val, <a href="array_list.inl.html#307">aws_array_list_length</a>(list));</div><div id="137" class="line none">  137 </div><div id="138" class="line none">  138     if (err_code &amp;&amp; <a href="../../../source/error.c.html#32">aws_last_error</a>() == <a href="error.h.html#153">AWS_ERROR_INVALID_INDEX</a> &amp;&amp; !list-&gt;<a href="array_list.h.html#16">alloc</a>) {</div><div id="139" class="line none">  139         AWS_POSTCONDITION(<a href="array_list.inl.html#82">aws_array_list_is_valid</a>(list));</div><div id="140" class="line none">  140         return <a href="error.inl.html#17">aws_raise_error</a>(<a href="error.h.html#170">AWS_ERROR_LIST_EXCEEDS_MAX_SIZE</a>);</div><div id="141" class="line none">  141     }</div><div id="142" class="line none">  142 </div><div id="143" class="line none">  143     AWS_POSTCONDITION(<a href="array_list.inl.html#82">aws_array_list_is_valid</a>(list));</div><div id="144" class="line none">  144     return err_code;</div><div id="145" class="line none">  145 }</div><div id="146" class="line none">  146 </div><div id="147" class="line none">  147 AWS_STATIC_IMPL</div><div id="148" class="line none">  148 int <a href="array_list.inl.html#148">aws_array_list_front</a>(const struct <a href="array_list.h.html#15">aws_array_list</a> *AWS_RESTRICT list, void *val) {</div><div id="149" class="line none">  149     AWS_PRECONDITION(<a href="array_list.inl.html#82">aws_array_list_is_valid</a>(list));</div><div id="150" class="line none">  150     AWS_PRECONDITION(</div><div id="151" class="line none">  151         val &amp;&amp; AWS_MEM_IS_WRITABLE(val, list-&gt;<a href="array_list.h.html#19">item_size</a>),</div><div id="152" class="line none">  152         "Input pointer [val] must point writable memory of [list-&gt;item_size] bytes.");</div><div id="153" class="line none">  153     if (<a href="array_list.inl.html#307">aws_array_list_length</a>(list) &gt; 0) {</div><div id="154" class="line none">  154         memcpy(val, list-&gt;<a href="array_list.h.html#20">data</a>, list-&gt;<a href="array_list.h.html#19">item_size</a>);</div><div id="155" class="line none">  155         AWS_POSTCONDITION(AWS_BYTES_EQ(val, list-&gt;<a href="array_list.h.html#20">data</a>, list-&gt;<a href="array_list.h.html#19">item_size</a>));</div><div id="156" class="line none">  156         AWS_POSTCONDITION(<a href="array_list.inl.html#82">aws_array_list_is_valid</a>(list));</div><div id="157" class="line none">  157         return <a href="error.h.html#15">AWS_OP_SUCCESS</a>;</div><div id="158" class="line none">  158     }</div><div id="159" class="line none">  159 </div><div id="160" class="line none">  160     AWS_POSTCONDITION(<a href="array_list.inl.html#82">aws_array_list_is_valid</a>(list));</div><div id="161" class="line none">  161     return <a href="error.inl.html#17">aws_raise_error</a>(<a href="error.h.html#168">AWS_ERROR_LIST_EMPTY</a>);</div><div id="162" class="line none">  162 }</div><div id="163" class="line none">  163 </div><div id="164" class="line none">  164 AWS_STATIC_IMPL</div><div id="165" class="line none">  165 int <a href="array_list.inl.html#165">aws_array_list_pop_front</a>(struct <a href="array_list.h.html#15">aws_array_list</a> *AWS_RESTRICT list) {</div><div id="166" class="line none">  166     AWS_PRECONDITION(<a href="array_list.inl.html#82">aws_array_list_is_valid</a>(list));</div><div id="167" class="line none">  167     if (<a href="array_list.inl.html#307">aws_array_list_length</a>(list) &gt; 0) {</div><div id="168" class="line none">  168         <a href="array_list.inl.html#178">aws_array_list_pop_front_n</a>(list, 1);</div><div id="169" class="line none">  169         AWS_POSTCONDITION(<a href="array_list.inl.html#82">aws_array_list_is_valid</a>(list));</div><div id="170" class="line none">  170         return <a href="error.h.html#15">AWS_OP_SUCCESS</a>;</div><div id="171" class="line none">  171     }</div><div id="172" class="line none">  172 </div><div id="173" class="line none">  173     AWS_POSTCONDITION(<a href="array_list.inl.html#82">aws_array_list_is_valid</a>(list));</div><div id="174" class="line none">  174     return <a href="error.inl.html#17">aws_raise_error</a>(<a href="error.h.html#168">AWS_ERROR_LIST_EMPTY</a>);</div><div id="175" class="line none">  175 }</div><div id="176" class="line none">  176 </div><div id="177" class="line none">  177 AWS_STATIC_IMPL</div><div id="178" class="line none">  178 void <a href="array_list.inl.html#178">aws_array_list_pop_front_n</a>(struct <a href="array_list.h.html#15">aws_array_list</a> *AWS_RESTRICT list, size_t n) {</div><div id="179" class="line none">  179     AWS_PRECONDITION(<a href="array_list.inl.html#82">aws_array_list_is_valid</a>(list));</div><div id="180" class="line none">  180     if (n &gt;= <a href="array_list.inl.html#307">aws_array_list_length</a>(list)) {</div><div id="181" class="line none">  181         <a href="array_list.inl.html#268">aws_array_list_clear</a>(list);</div><div id="182" class="line none">  182         AWS_POSTCONDITION(<a href="array_list.inl.html#82">aws_array_list_is_valid</a>(list));</div><div id="183" class="line none">  183         return;</div><div id="184" class="line none">  184     }</div><div id="185" class="line none">  185 </div><div id="186" class="line none">  186     if (n &gt; 0) {</div><div id="187" class="line none">  187         size_t popping_bytes = list-&gt;<a href="array_list.h.html#19">item_size</a> * n;</div><div id="188" class="line none">  188         size_t remaining_items = <a href="array_list.inl.html#307">aws_array_list_length</a>(list) - n;</div><div id="189" class="line none">  189         size_t remaining_bytes = remaining_items * list-&gt;<a href="array_list.h.html#19">item_size</a>;</div><div id="190" class="line none">  190         memmove(list-&gt;<a href="array_list.h.html#20">data</a>, (uint8_t *)list-&gt;<a href="array_list.h.html#20">data</a> + popping_bytes, remaining_bytes);</div><div id="191" class="line none">  191         list-&gt;<a href="array_list.h.html#18">length</a> = remaining_items;</div><div id="192" class="line none">  192 #ifdef DEBUG_BUILD</div><div id="193" class="line none">  193         memset((uint8_t *)list-&gt;<a href="array_list.h.html#20">data</a> + remaining_bytes, <a href="array_list.h.html#13">AWS_ARRAY_LIST_DEBUG_FILL</a>, popping_bytes);</div><div id="194" class="line none">  194 #endif</div><div id="195" class="line none">  195     }</div><div id="196" class="line none">  196     AWS_POSTCONDITION(<a href="array_list.inl.html#82">aws_array_list_is_valid</a>(list));</div><div id="197" class="line none">  197 }</div><div id="198" class="line none">  198 </div><div id="199" class="line none">  199 int <a href="array_list.inl.html#199">aws_array_list_erase</a>(struct <a href="array_list.h.html#15">aws_array_list</a> *AWS_RESTRICT list, size_t <a href="../../../verification/cbmc/include/proof_helpers/utils.h.html#22">index</a>) {</div><div id="200" class="line none">  200     AWS_PRECONDITION(<a href="array_list.inl.html#82">aws_array_list_is_valid</a>(list));</div><div id="201" class="line none">  201 </div><div id="202" class="line none">  202     const size_t <a href="array_list.h.html#18">length</a> = <a href="array_list.inl.html#307">aws_array_list_length</a>(list);</div><div id="203" class="line none">  203 </div><div id="204" class="line none">  204     if (<a href="../../../verification/cbmc/include/proof_helpers/utils.h.html#22">index</a> &gt;= <a href="array_list.h.html#18">length</a>) {</div><div id="205" class="line none">  205         AWS_POSTCONDITION(<a href="array_list.inl.html#82">aws_array_list_is_valid</a>(list));</div><div id="206" class="line none">  206         return <a href="error.inl.html#17">aws_raise_error</a>(<a href="error.h.html#153">AWS_ERROR_INVALID_INDEX</a>);</div><div id="207" class="line none">  207     }</div><div id="208" class="line none">  208 </div><div id="209" class="line none">  209     if (<a href="../../../verification/cbmc/include/proof_helpers/utils.h.html#22">index</a> == 0) {</div><div id="210" class="line none">  210         /* Removing front element */</div><div id="211" class="line none">  211         <a href="array_list.inl.html#165">aws_array_list_pop_front</a>(list);</div><div id="212" class="line none">  212     } else if (<a href="../../../verification/cbmc/include/proof_helpers/utils.h.html#22">index</a> == (<a href="array_list.h.html#18">length</a> - 1)) {</div><div id="213" class="line none">  213         /* Removing back element */</div><div id="214" class="line none">  214         <a href="array_list.inl.html#249">aws_array_list_pop_back</a>(list);</div><div id="215" class="line none">  215     } else {</div><div id="216" class="line none">  216         /* Removing middle element */</div><div id="217" class="line none">  217         uint8_t *item_ptr = (uint8_t *)list-&gt;<a href="array_list.h.html#20">data</a> + (<a href="../../../verification/cbmc/include/proof_helpers/utils.h.html#22">index</a> * list-&gt;<a href="array_list.h.html#19">item_size</a>);</div><div id="218" class="line none">  218         uint8_t *next_item_ptr = item_ptr + list-&gt;<a href="array_list.h.html#19">item_size</a>;</div><div id="219" class="line none">  219         size_t trailing_items = (<a href="array_list.h.html#18">length</a> - <a href="../../../verification/cbmc/include/proof_helpers/utils.h.html#22">index</a>) - 1;</div><div id="220" class="line none">  220         size_t trailing_bytes = trailing_items * list-&gt;<a href="array_list.h.html#19">item_size</a>;</div><div id="221" class="line none">  221         memmove(item_ptr, next_item_ptr, trailing_bytes);</div><div id="222" class="line none">  222 </div><div id="223" class="line none">  223         <a href="array_list.inl.html#249">aws_array_list_pop_back</a>(list);</div><div id="224" class="line none">  224     }</div><div id="225" class="line none">  225 </div><div id="226" class="line none">  226     AWS_POSTCONDITION(<a href="array_list.inl.html#82">aws_array_list_is_valid</a>(list));</div><div id="227" class="line none">  227     return <a href="error.h.html#15">AWS_OP_SUCCESS</a>;</div><div id="228" class="line none">  228 }</div><div id="229" class="line none">  229 </div><div id="230" class="line none">  230 AWS_STATIC_IMPL</div><div id="231" class="line none">  231 int <a href="array_list.inl.html#231">aws_array_list_back</a>(const struct <a href="array_list.h.html#15">aws_array_list</a> *AWS_RESTRICT list, void *val) {</div><div id="232" class="line none">  232     AWS_PRECONDITION(<a href="array_list.inl.html#82">aws_array_list_is_valid</a>(list));</div><div id="233" class="line none">  233     AWS_PRECONDITION(</div><div id="234" class="line none">  234         val &amp;&amp; AWS_MEM_IS_WRITABLE(val, list-&gt;<a href="array_list.h.html#19">item_size</a>),</div><div id="235" class="line none">  235         "Input pointer [val] must point writable memory of [list-&gt;item_size] bytes.");</div><div id="236" class="line none">  236     if (<a href="array_list.inl.html#307">aws_array_list_length</a>(list) &gt; 0) {</div><div id="237" class="line none">  237         size_t last_item_offset = list-&gt;<a href="array_list.h.html#19">item_size</a> * (<a href="array_list.inl.html#307">aws_array_list_length</a>(list) - 1);</div><div id="238" class="line none">  238 </div><div id="239" class="line none">  239         memcpy(val, (void *)((uint8_t *)list-&gt;<a href="array_list.h.html#20">data</a> + last_item_offset), list-&gt;<a href="array_list.h.html#19">item_size</a>);</div><div id="240" class="line none">  240         AWS_POSTCONDITION(<a href="array_list.inl.html#82">aws_array_list_is_valid</a>(list));</div><div id="241" class="line none">  241         return <a href="error.h.html#15">AWS_OP_SUCCESS</a>;</div><div id="242" class="line none">  242     }</div><div id="243" class="line none">  243 </div><div id="244" class="line none">  244     AWS_POSTCONDITION(<a href="array_list.inl.html#82">aws_array_list_is_valid</a>(list));</div><div id="245" class="line none">  245     return <a href="error.inl.html#17">aws_raise_error</a>(<a href="error.h.html#168">AWS_ERROR_LIST_EMPTY</a>);</div><div id="246" class="line none">  246 }</div><div id="247" class="line none">  247 </div><div id="248" class="line none">  248 AWS_STATIC_IMPL</div><div id="249" class="line none">  249 int <a href="array_list.inl.html#249">aws_array_list_pop_back</a>(struct <a href="array_list.h.html#15">aws_array_list</a> *AWS_RESTRICT list) {</div><div id="250" class="line none">  250     AWS_PRECONDITION(<a href="array_list.inl.html#82">aws_array_list_is_valid</a>(list));</div><div id="251" class="line none">  251     if (<a href="array_list.inl.html#307">aws_array_list_length</a>(list) &gt; 0) {</div><div id="252" class="line none">  252 </div><div id="253" class="line none">  253         AWS_FATAL_PRECONDITION(list-&gt;<a href="array_list.h.html#20">data</a>);</div><div id="254" class="line none">  254 </div><div id="255" class="line none">  255         size_t last_item_offset = list-&gt;<a href="array_list.h.html#19">item_size</a> * (<a href="array_list.inl.html#307">aws_array_list_length</a>(list) - 1);</div><div id="256" class="line none">  256 </div><div id="257" class="line none">  257         memset((void *)((uint8_t *)list-&gt;<a href="array_list.h.html#20">data</a> + last_item_offset), 0, list-&gt;<a href="array_list.h.html#19">item_size</a>);</div><div id="258" class="line none">  258         list-&gt;<a href="array_list.h.html#18">length</a>--;</div><div id="259" class="line none">  259         AWS_POSTCONDITION(<a href="array_list.inl.html#82">aws_array_list_is_valid</a>(list));</div><div id="260" class="line none">  260         return <a href="error.h.html#15">AWS_OP_SUCCESS</a>;</div><div id="261" class="line none">  261     }</div><div id="262" class="line none">  262 </div><div id="263" class="line none">  263     AWS_POSTCONDITION(<a href="array_list.inl.html#82">aws_array_list_is_valid</a>(list));</div><div id="264" class="line none">  264     return <a href="error.inl.html#17">aws_raise_error</a>(<a href="error.h.html#168">AWS_ERROR_LIST_EMPTY</a>);</div><div id="265" class="line none">  265 }</div><div id="266" class="line none">  266 </div><div id="267" class="line none">  267 AWS_STATIC_IMPL</div><div id="268" class="line none">  268 void <a href="array_list.inl.html#268">aws_array_list_clear</a>(struct <a href="array_list.h.html#15">aws_array_list</a> *AWS_RESTRICT list) {</div><div id="269" class="line none">  269     AWS_PRECONDITION(<a href="array_list.inl.html#82">aws_array_list_is_valid</a>(list));</div><div id="270" class="line none">  270     if (list-&gt;<a href="array_list.h.html#20">data</a>) {</div><div id="271" class="line none">  271 #ifdef DEBUG_BUILD</div><div id="272" class="line none">  272         memset(list-&gt;<a href="array_list.h.html#20">data</a>, <a href="array_list.h.html#13">AWS_ARRAY_LIST_DEBUG_FILL</a>, list-&gt;<a href="array_list.h.html#17">current_size</a>);</div><div id="273" class="line none">  273 #endif</div><div id="274" class="line none">  274         list-&gt;<a href="array_list.h.html#18">length</a> = 0;</div><div id="275" class="line none">  275     }</div><div id="276" class="line none">  276     AWS_POSTCONDITION(<a href="array_list.inl.html#82">aws_array_list_is_valid</a>(list));</div><div id="277" class="line none">  277 }</div><div id="278" class="line none">  278 </div><div id="279" class="line none">  279 AWS_STATIC_IMPL</div><div id="280" class="line none">  280 void <a href="array_list.inl.html#280">aws_array_list_swap_contents</a>(</div><div id="281" class="line none">  281     struct <a href="array_list.h.html#15">aws_array_list</a> *AWS_RESTRICT list_a,</div><div id="282" class="line none">  282     struct <a href="array_list.h.html#15">aws_array_list</a> *AWS_RESTRICT list_b) {</div><div id="283" class="line none">  283     AWS_FATAL_PRECONDITION(list_a-&gt;<a href="array_list.h.html#16">alloc</a>);</div><div id="284" class="line none">  284     AWS_FATAL_PRECONDITION(list_a-&gt;<a href="array_list.h.html#16">alloc</a> == list_b-&gt;<a href="array_list.h.html#16">alloc</a>);</div><div id="285" class="line none">  285     AWS_FATAL_PRECONDITION(list_a-&gt;<a href="array_list.h.html#19">item_size</a> == list_b-&gt;<a href="array_list.h.html#19">item_size</a>);</div><div id="286" class="line none">  286     AWS_FATAL_PRECONDITION(list_a != list_b);</div><div id="287" class="line none">  287     AWS_PRECONDITION(<a href="array_list.inl.html#82">aws_array_list_is_valid</a>(list_a));</div><div id="288" class="line none">  288     AWS_PRECONDITION(<a href="array_list.inl.html#82">aws_array_list_is_valid</a>(list_b));</div><div id="289" class="line none">  289 </div><div id="290" class="line none">  290     struct <a href="array_list.h.html#15">aws_array_list</a> tmp = *list_a;</div><div id="291" class="line none">  291     *list_a = *list_b;</div><div id="292" class="line none">  292     *list_b = tmp;</div><div id="293" class="line none">  293     AWS_POSTCONDITION(<a href="array_list.inl.html#82">aws_array_list_is_valid</a>(list_a));</div><div id="294" class="line none">  294     AWS_POSTCONDITION(<a href="array_list.inl.html#82">aws_array_list_is_valid</a>(list_b));</div><div id="295" class="line none">  295 }</div><div id="296" class="line none">  296 </div><div id="297" class="line none">  297 AWS_STATIC_IMPL</div><div id="298" class="line none">  298 size_t <a href="array_list.inl.html#298">aws_array_list_capacity</a>(const struct <a href="array_list.h.html#15">aws_array_list</a> *AWS_RESTRICT list) {</div><div id="299" class="line none">  299     AWS_FATAL_PRECONDITION(list-&gt;<a href="array_list.h.html#19">item_size</a>);</div><div id="300" class="line none">  300     AWS_PRECONDITION(<a href="array_list.inl.html#82">aws_array_list_is_valid</a>(list));</div><div id="301" class="line none">  301     size_t <a href="byte_buf.h.html#29">capacity</a> = list-&gt;<a href="array_list.h.html#17">current_size</a> / list-&gt;<a href="array_list.h.html#19">item_size</a>;</div><div id="302" class="line none">  302     AWS_POSTCONDITION(<a href="array_list.inl.html#82">aws_array_list_is_valid</a>(list));</div><div id="303" class="line none">  303     return <a href="byte_buf.h.html#29">capacity</a>;</div><div id="304" class="line none">  304 }</div><div id="305" class="line none">  305 </div><div id="306" class="line none">  306 AWS_STATIC_IMPL</div><div id="307" class="line none">  307 size_t <a href="array_list.inl.html#307">aws_array_list_length</a>(const struct <a href="array_list.h.html#15">aws_array_list</a> *AWS_RESTRICT list) {</div><div id="308" class="line none">  308     /*</div><div id="309" class="line none">  309      * This assert teaches clang-tidy and friends that list-&gt;data cannot be null in a non-empty</div><div id="310" class="line none">  310      * list.</div><div id="311" class="line none">  311      */</div><div id="312" class="line none">  312     AWS_FATAL_PRECONDITION(!list-&gt;<a href="array_list.h.html#18">length</a> || list-&gt;<a href="array_list.h.html#20">data</a>);</div><div id="313" class="line none">  313     AWS_PRECONDITION(<a href="array_list.inl.html#82">aws_array_list_is_valid</a>(list));</div><div id="314" class="line none">  314     size_t <a href="byte_buf.h.html#27">len</a> = list-&gt;<a href="array_list.h.html#18">length</a>;</div><div id="315" class="line none">  315     AWS_POSTCONDITION(<a href="array_list.inl.html#82">aws_array_list_is_valid</a>(list));</div><div id="316" class="line none">  316     return <a href="byte_buf.h.html#27">len</a>;</div><div id="317" class="line none">  317 }</div><div id="318" class="line none">  318 </div><div id="319" class="line none">  319 AWS_STATIC_IMPL</div><div id="320" class="line none">  320 int <a href="array_list.inl.html#320">aws_array_list_get_at</a>(const struct <a href="array_list.h.html#15">aws_array_list</a> *AWS_RESTRICT list, void *val, size_t <a href="../../../verification/cbmc/include/proof_helpers/utils.h.html#22">index</a>) {</div><div id="321" class="line none">  321     AWS_PRECONDITION(<a href="array_list.inl.html#82">aws_array_list_is_valid</a>(list));</div><div id="322" class="line none">  322     AWS_PRECONDITION(</div><div id="323" class="line none">  323         val &amp;&amp; AWS_MEM_IS_WRITABLE(val, list-&gt;<a href="array_list.h.html#19">item_size</a>),</div><div id="324" class="line none">  324         "Input pointer [val] must point writable memory of [list-&gt;item_size] bytes.");</div><div id="325" class="line none">  325     if (<a href="array_list.inl.html#307">aws_array_list_length</a>(list) &gt; <a href="../../../verification/cbmc/include/proof_helpers/utils.h.html#22">index</a>) {</div><div id="326" class="line none">  326         memcpy(val, (void *)((uint8_t *)list-&gt;<a href="array_list.h.html#20">data</a> + (list-&gt;<a href="array_list.h.html#19">item_size</a> * <a href="../../../verification/cbmc/include/proof_helpers/utils.h.html#22">index</a>)), list-&gt;<a href="array_list.h.html#19">item_size</a>);</div><div id="327" class="line none">  327         AWS_POSTCONDITION(<a href="array_list.inl.html#82">aws_array_list_is_valid</a>(list));</div><div id="328" class="line none">  328         return <a href="error.h.html#15">AWS_OP_SUCCESS</a>;</div><div id="329" class="line none">  329     }</div><div id="330" class="line none">  330     AWS_POSTCONDITION(<a href="array_list.inl.html#82">aws_array_list_is_valid</a>(list));</div><div id="331" class="line none">  331     return <a href="error.inl.html#17">aws_raise_error</a>(<a href="error.h.html#153">AWS_ERROR_INVALID_INDEX</a>);</div><div id="332" class="line none">  332 }</div><div id="333" class="line none">  333 </div><div id="334" class="line none">  334 AWS_STATIC_IMPL</div><div id="335" class="line none">  335 int <a href="array_list.inl.html#335">aws_array_list_get_at_ptr</a>(const struct <a href="array_list.h.html#15">aws_array_list</a> *AWS_RESTRICT list, void **val, size_t <a href="../../../verification/cbmc/include/proof_helpers/utils.h.html#22">index</a>) {</div><div id="336" class="line none">  336     AWS_PRECONDITION(<a href="array_list.inl.html#82">aws_array_list_is_valid</a>(list));</div><div id="337" class="line none">  337     AWS_PRECONDITION(val != NULL);</div><div id="338" class="line none">  338     if (<a href="array_list.inl.html#307">aws_array_list_length</a>(list) &gt; <a href="../../../verification/cbmc/include/proof_helpers/utils.h.html#22">index</a>) {</div><div id="339" class="line none">  339         *val = (void *)((uint8_t *)list-&gt;<a href="array_list.h.html#20">data</a> + (list-&gt;<a href="array_list.h.html#19">item_size</a> * <a href="../../../verification/cbmc/include/proof_helpers/utils.h.html#22">index</a>));</div><div id="340" class="line none">  340         AWS_POSTCONDITION(<a href="array_list.inl.html#82">aws_array_list_is_valid</a>(list));</div><div id="341" class="line none">  341         return <a href="error.h.html#15">AWS_OP_SUCCESS</a>;</div><div id="342" class="line none">  342     }</div><div id="343" class="line none">  343     AWS_POSTCONDITION(<a href="array_list.inl.html#82">aws_array_list_is_valid</a>(list));</div><div id="344" class="line none">  344     return <a href="error.inl.html#17">aws_raise_error</a>(<a href="error.h.html#153">AWS_ERROR_INVALID_INDEX</a>);</div><div id="345" class="line none">  345 }</div><div id="346" class="line none">  346 </div><div id="347" class="line none">  347 AWS_STATIC_IMPL</div><div id="348" class="line none">  348 int <a href="array_list.inl.html#348">aws_array_list_set_at</a>(struct <a href="array_list.h.html#15">aws_array_list</a> *AWS_RESTRICT list, const void *val, size_t <a href="../../../verification/cbmc/include/proof_helpers/utils.h.html#22">index</a>) {</div><div id="349" class="line none">  349     AWS_PRECONDITION(<a href="array_list.inl.html#82">aws_array_list_is_valid</a>(list));</div><div id="350" class="line none">  350     AWS_PRECONDITION(</div><div id="351" class="line none">  351         val &amp;&amp; AWS_MEM_IS_READABLE(val, list-&gt;<a href="array_list.h.html#19">item_size</a>),</div><div id="352" class="line none">  352         "Input pointer [val] must point readable memory of [list-&gt;item_size] bytes.");</div><div id="353" class="line none">  353 </div><div id="354" class="line none">  354     if (<a href="array_list.h.html#187">aws_array_list_ensure_capacity</a>(list, <a href="../../../verification/cbmc/include/proof_helpers/utils.h.html#22">index</a>)) {</div><div id="355" class="line none">  355         AWS_POSTCONDITION(<a href="array_list.inl.html#82">aws_array_list_is_valid</a>(list));</div><div id="356" class="line none">  356         return <a href="error.h.html#16">AWS_OP_ERR</a>;</div><div id="357" class="line none">  357     }</div><div id="358" class="line none">  358 </div><div id="359" class="line none">  359     AWS_FATAL_PRECONDITION(list-&gt;<a href="array_list.h.html#20">data</a>);</div><div id="360" class="line none">  360 </div><div id="361" class="line none">  361     memcpy((void *)((uint8_t *)list-&gt;<a href="array_list.h.html#20">data</a> + (list-&gt;<a href="array_list.h.html#19">item_size</a> * <a href="../../../verification/cbmc/include/proof_helpers/utils.h.html#22">index</a>)), val, list-&gt;<a href="array_list.h.html#19">item_size</a>);</div><div id="362" class="line none">  362 </div><div id="363" class="line none">  363     /*</div><div id="364" class="line none">  364      * This isn't perfect, but its the best I can come up with for detecting</div><div id="365" class="line none">  365      * length changes.</div><div id="366" class="line none">  366      */</div><div id="367" class="line none">  367     if (<a href="../../../verification/cbmc/include/proof_helpers/utils.h.html#22">index</a> &gt;= <a href="array_list.inl.html#307">aws_array_list_length</a>(list)) {</div><div id="368" class="line none">  368         if (<a href="math.inl.html#126">aws_add_size_checked</a>(<a href="../../../verification/cbmc/include/proof_helpers/utils.h.html#22">index</a>, 1, &amp;list-&gt;<a href="array_list.h.html#18">length</a>)) {</div><div id="369" class="line none">  369             AWS_POSTCONDITION(<a href="array_list.inl.html#82">aws_array_list_is_valid</a>(list));</div><div id="370" class="line none">  370             return <a href="error.h.html#16">AWS_OP_ERR</a>;</div><div id="371" class="line none">  371         }</div><div id="372" class="line none">  372     }</div><div id="373" class="line none">  373 </div><div id="374" class="line none">  374     AWS_POSTCONDITION(<a href="array_list.inl.html#82">aws_array_list_is_valid</a>(list));</div><div id="375" class="line none">  375     return <a href="error.h.html#15">AWS_OP_SUCCESS</a>;</div><div id="376" class="line none">  376 }</div><div id="377" class="line none">  377 </div><div id="378" class="line none">  378 AWS_STATIC_IMPL</div><div id="379" class="line none">  379 void <a href="array_list.inl.html#379">aws_array_list_sort</a>(struct <a href="array_list.h.html#15">aws_array_list</a> *AWS_RESTRICT list, <a href="array_list.h.html#31">aws_array_list_comparator_fn</a> *compare_fn) {</div><div id="380" class="line none">  380     AWS_PRECONDITION(<a href="array_list.inl.html#82">aws_array_list_is_valid</a>(list));</div><div id="381" class="line none">  381     if (list-&gt;<a href="array_list.h.html#20">data</a>) {</div><div id="382" class="line none">  382         qsort(list-&gt;<a href="array_list.h.html#20">data</a>, <a href="array_list.inl.html#307">aws_array_list_length</a>(list), list-&gt;<a href="array_list.h.html#19">item_size</a>, compare_fn);</div><div id="383" class="line none">  383     }</div><div id="384" class="line none">  384     AWS_POSTCONDITION(<a href="array_list.inl.html#82">aws_array_list_is_valid</a>(list));</div><div id="385" class="line none">  385 }</div><div id="386" class="line none">  386 </div><div id="387" class="line none">  387 AWS_EXTERN_C_END</div><div id="388" class="line none">  388 </div><div id="389" class="line none">  389 #endif /*  AWS_COMMON_ARRAY_LIST_INL */</div>
</div>
</body>
</html>
