
<html>
<head>
<title>verification/cbmc/aws-c-common/include/aws/common/ring_buffer.inl</title>
<link rel="stylesheet" type="text/css" href="../../../../../../viewer.css">
</head>

<body>
<div class="code">
<div id="1" class="line none">    1 #ifndef AWS_COMMON_RING_BUFFER_INL</div><div id="2" class="line none">    2 #define AWS_COMMON_RING_BUFFER_INL</div><div id="3" class="line none">    3 /**</div><div id="4" class="line none">    4  * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.</div><div id="5" class="line none">    5  * SPDX-License-Identifier: Apache-2.0.</div><div id="6" class="line none">    6  */</div><div id="7" class="line none">    7 </div><div id="8" class="line none">    8 #include &lt;aws/common/ring_buffer.h&gt;</div><div id="9" class="line none">    9 </div><div id="10" class="line none">   10 AWS_EXTERN_C_BEGIN</div><div id="11" class="line none">   11 /*</div><div id="12" class="line none">   12  * Checks whether atomic_ptr correctly points to a memory location within the bounds of the aws_ring_buffer</div><div id="13" class="line none">   13  */</div><div id="14" class="line none">   14 AWS_STATIC_IMPL bool <a href="ring_buffer.inl.html#14">aws_ring_buffer_check_atomic_ptr</a>(</div><div id="15" class="line none">   15     const struct <a href="ring_buffer.h.html#18">aws_ring_buffer</a> *ring_buf,</div><div id="16" class="line none">   16     const uint8_t *atomic_ptr) {</div><div id="17" class="line none">   17     return (atomic_ptr &gt;= ring_buf-&gt;<a href="ring_buffer.h.html#20">allocation</a> &amp;&amp; atomic_ptr &lt;= ring_buf-&gt;<a href="ring_buffer.h.html#23">allocation_end</a>);</div><div id="18" class="line none">   18 }</div><div id="19" class="line none">   19 </div><div id="20" class="line none">   20 /**</div><div id="21" class="line none">   21  * Checks whether the ring buffer is empty</div><div id="22" class="line none">   22  */</div><div id="23" class="line none">   23 AWS_STATIC_IMPL bool <a href="ring_buffer.inl.html#23">aws_ring_buffer_is_empty</a>(const struct <a href="ring_buffer.h.html#18">aws_ring_buffer</a> *ring_buf) {</div><div id="24" class="line none">   24     uint8_t *<a href="linked_list.h.html#19">head</a> = (uint8_t *)<a href="atomics.inl.html#26">aws_atomic_load_ptr</a>(&amp;ring_buf-&gt;<a href="linked_list.h.html#19">head</a>);</div><div id="25" class="line none">   25     uint8_t *<a href="linked_list.h.html#20">tail</a> = (uint8_t *)<a href="atomics.inl.html#26">aws_atomic_load_ptr</a>(&amp;ring_buf-&gt;<a href="linked_list.h.html#20">tail</a>);</div><div id="26" class="line none">   26     return <a href="linked_list.h.html#19">head</a> == <a href="linked_list.h.html#20">tail</a>;</div><div id="27" class="line none">   27 }</div><div id="28" class="line none">   28 </div><div id="29" class="line none">   29 /**</div><div id="30" class="line none">   30  * Evaluates the set of properties that define the shape of all valid aws_ring_buffer structures.</div><div id="31" class="line none">   31  * It is also a cheap check, in the sense it run in constant time (i.e., no loops or recursion).</div><div id="32" class="line none">   32  */</div><div id="33" class="line none">   33 AWS_STATIC_IMPL bool <a href="ring_buffer.inl.html#33">aws_ring_buffer_is_valid</a>(const struct <a href="ring_buffer.h.html#18">aws_ring_buffer</a> *ring_buf) {</div><div id="34" class="line none">   34     uint8_t *<a href="linked_list.h.html#19">head</a> = (uint8_t *)<a href="atomics.inl.html#26">aws_atomic_load_ptr</a>(&amp;ring_buf-&gt;<a href="linked_list.h.html#19">head</a>);</div><div id="35" class="line none">   35     uint8_t *<a href="linked_list.h.html#20">tail</a> = (uint8_t *)<a href="atomics.inl.html#26">aws_atomic_load_ptr</a>(&amp;ring_buf-&gt;<a href="linked_list.h.html#20">tail</a>);</div><div id="36" class="line none">   36     bool head_in_range = <a href="ring_buffer.inl.html#14">aws_ring_buffer_check_atomic_ptr</a>(ring_buf, <a href="linked_list.h.html#19">head</a>);</div><div id="37" class="line none">   37     bool tail_in_range = <a href="ring_buffer.inl.html#14">aws_ring_buffer_check_atomic_ptr</a>(ring_buf, <a href="linked_list.h.html#20">tail</a>);</div><div id="38" class="line none">   38     /* if head points-to the first element of the buffer then tail must too */</div><div id="39" class="line none">   39     bool valid_head_tail = (<a href="linked_list.h.html#19">head</a> != ring_buf-&gt;<a href="ring_buffer.h.html#20">allocation</a>) || (<a href="linked_list.h.html#20">tail</a> == ring_buf-&gt;<a href="ring_buffer.h.html#20">allocation</a>);</div><div id="40" class="line none">   40     return ring_buf &amp;&amp; AWS_MEM_IS_READABLE(ring_buf-&gt;<a href="ring_buffer.h.html#20">allocation</a>, ring_buf-&gt;<a href="ring_buffer.h.html#23">allocation_end</a> - ring_buf-&gt;<a href="ring_buffer.h.html#20">allocation</a>) &amp;&amp;</div><div id="41" class="line none">   41            head_in_range &amp;&amp; tail_in_range &amp;&amp; valid_head_tail &amp;&amp; (ring_buf-&gt;<a href="ring_buffer.h.html#19">allocator</a> != NULL);</div><div id="42" class="line none">   42 }</div><div id="43" class="line none">   43 AWS_EXTERN_C_END</div><div id="44" class="line none">   44 #endif /* AWS_COMMON_RING_BUFFER_INL */</div>
</div>
</body>
</html>
