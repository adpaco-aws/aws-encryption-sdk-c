
<html>
<head>
<title>verification/cbmc/sources/openssl/bn_override.c</title>
<link rel="stylesheet" type="text/css" href="../../../../viewer.css">
</head>

<body>
<div class="code">
<div id="1" class="line none">    1 /*</div><div id="2" class="line none">    2  * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.</div><div id="3" class="line none">    3  *</div><div id="4" class="line none">    4  * Licensed under the Apache License, Version 2.0 (the "License").</div><div id="5" class="line none">    5  * You may not use this file except in compliance with the License.</div><div id="6" class="line none">    6  * A copy of the License is located at</div><div id="7" class="line none">    7  *</div><div id="8" class="line none">    8  *  http://aws.amazon.com/apache2.0</div><div id="9" class="line none">    9  *</div><div id="10" class="line none">   10  * or in the "license" file accompanying this file. This file is distributed</div><div id="11" class="line none">   11  * on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either</div><div id="12" class="line none">   12  * express or implied. See the License for the specific language governing</div><div id="13" class="line none">   13  * permissions and limitations under the License.</div><div id="14" class="line none">   14  */</div><div id="15" class="line none">   15 </div><div id="16" class="line none">   16 #include &lt;openssl/bn.h&gt;</div><div id="17" class="line none">   17 </div><div id="18" class="line none">   18 #include &lt;stdbool.h&gt;</div><div id="19" class="line none">   19 </div><div id="20" class="line none">   20 #include &lt;proof_helpers/proof_allocators.h&gt;</div><div id="21" class="line none">   21 </div><div id="22" class="line none">   22 #include &lt;bn_utils.h&gt;</div><div id="23" class="line none">   23 </div><div id="24" class="line none">   24 /* Abstraction of the BIGNUM struct */</div><div id="25" class="line none">   25 struct <a href="../../include/openssl/ossl_typ.h.html#31">bignum_st</a> {</div><div id="26" class="line none">   26     bool <a href="bn_override.c.html#26">is_initialized</a>;</div><div id="27" class="line none">   27 };</div><div id="28" class="line none">   28 </div><div id="29" class="line none">   29 /*</div><div id="30" class="line none">   30  * Description: BN_new() allocates and initializes a BIGNUM structure.</div><div id="31" class="line none">   31  * Return values: BN_new() and BN_secure_new() return a pointer to the BIGNUM initialised to the value 0. If the</div><div id="32" class="line none">   32  * allocation fails, they return NULL and set an error code that can be obtained by ERR_get_error(3).</div><div id="33" class="line none">   33  */</div><div id="34" class="line none">   34 <a href="../../include/openssl/ossl_typ.h.html#31">BIGNUM</a> *<a href="bn_override.c.html#34">BN_new</a>(void) {</div><div id="35" class="line none">   35     <a href="../../include/openssl/ossl_typ.h.html#31">BIGNUM</a> *rv = <a href="../../aws-c-common/verification/cbmc/sources/proof_allocators.c.html#76">can_fail_malloc</a>(sizeof(<a href="../../include/openssl/ossl_typ.h.html#31">BIGNUM</a>));</div><div id="36" class="line none">   36     if (rv) {</div><div id="37" class="line none">   37         rv-&gt;<a href="bn_override.c.html#26">is_initialized</a> = true;</div><div id="38" class="line none">   38     }</div><div id="39" class="line none">   39 </div><div id="40" class="line none">   40     // Assuming error codes can be safely ignored</div><div id="41" class="line none">   41 </div><div id="42" class="line none">   42     return rv;</div><div id="43" class="line none">   43 }</div><div id="44" class="line none">   44 </div><div id="45" class="line none">   45 /*</div><div id="46" class="line none">   46  * Description: BN_dup() creates a new BIGNUM containing the value from.</div><div id="47" class="line none">   47  * Return values: BN_dup() returns the new BIGNUM, and NULL on error.</div><div id="48" class="line none">   48  */</div><div id="49" class="line none">   49 <a href="../../include/openssl/ossl_typ.h.html#31">BIGNUM</a> *<a href="bn_override.c.html#49">BN_dup</a>(const <a href="../../include/openssl/ossl_typ.h.html#31">BIGNUM</a> *<a href="evp_override.c.html#412">from</a>) {</div><div id="50" class="line none">   50     assert(<a href="bn_override.c.html#92">bignum_is_valid</a>(<a href="evp_override.c.html#412">from</a>));</div><div id="51" class="line none">   51 </div><div id="52" class="line none">   52     // WARNING: somehow CBMC doesn't catch the NULL-ptr deref?</div><div id="53" class="line none">   53     // *dup = *from;</div><div id="54" class="line none">   54 </div><div id="55" class="line none">   55     return <a href="bn_override.c.html#34">BN_new</a>();  // Guarantees that return value will be either NULL or initialized</div><div id="56" class="line none">   56 }</div><div id="57" class="line none">   57 </div><div id="58" class="line none">   58 /*</div><div id="59" class="line none">   59  * Description: BN_sub() subtracts b from a and places the result in r (r=a-b). r may be the same BIGNUM as a or b.</div><div id="60" class="line none">   60  * Return values: For all functions, 1 is returned for success, 0 on error. The return value should always be checked</div><div id="61" class="line none">   61  * (e.g., if (!BN_add(r,a,b)) goto err;).</div><div id="62" class="line none">   62  */</div><div id="63" class="line none">   63 int <a href="bn_override.c.html#63">BN_sub</a>(<a href="../../include/openssl/ossl_typ.h.html#31">BIGNUM</a> *<a href="ec_override.c.html#282">r</a>, const <a href="../../include/openssl/ossl_typ.h.html#31">BIGNUM</a> *a, const <a href="../../include/openssl/ossl_typ.h.html#31">BIGNUM</a> *b) {</div><div id="64" class="line none">   64     assert(<a href="bn_override.c.html#92">bignum_is_valid</a>(<a href="ec_override.c.html#282">r</a>));</div><div id="65" class="line none">   65     assert(<a href="bn_override.c.html#92">bignum_is_valid</a>(a));</div><div id="66" class="line none">   66     assert(<a href="bn_override.c.html#92">bignum_is_valid</a>(b));</div><div id="67" class="line none">   67 </div><div id="68" class="line none">   68     <a href="ec_override.c.html#282">r</a>-&gt;<a href="bn_override.c.html#26">is_initialized</a> = <a href="../../aws-c-common/verification/cbmc/include/proof_helpers/nondet.h.html#15">nondet_bool</a>();</div><div id="69" class="line none">   69 </div><div id="70" class="line none">   70     return <a href="ec_override.c.html#282">r</a>-&gt;<a href="bn_override.c.html#26">is_initialized</a>;</div><div id="71" class="line none">   71 }</div><div id="72" class="line none">   72 </div><div id="73" class="line none">   73 /*</div><div id="74" class="line none">   74  * Description: BN_free() frees the components of the BIGNUM, and if it was created by BN_new(), also the structure</div><div id="75" class="line none">   75  * itself.</div><div id="76" class="line none">   76  */</div><div id="77" class="line none">   77 void <a href="bn_override.c.html#77">BN_free</a>(<a href="../../include/openssl/ossl_typ.h.html#31">BIGNUM</a> *a) {</div><div id="78" class="line none">   78     free(a);  // Assuming BIGNUMs are always allocated dynamically</div><div id="79" class="line none">   79 }</div><div id="80" class="line none">   80 </div><div id="81" class="line none">   81 /*</div><div id="82" class="line none">   82  * Description: BN_clear_free() additionally overwrites the data before the memory is returned to the system. If a is</div><div id="83" class="line none">   83  * NULL, nothing is done.</div><div id="84" class="line none">   84  */</div><div id="85" class="line none">   85 void <a href="bn_override.c.html#85">BN_clear_free</a>(<a href="../../include/openssl/ossl_typ.h.html#31">BIGNUM</a> *a) {</div><div id="86" class="line none">   86     // No way currently to model or check that the data is cleared</div><div id="87" class="line none">   87     free(a);</div><div id="88" class="line none">   88 }</div><div id="89" class="line none">   89 </div><div id="90" class="line none">   90 /* CBMC helper functions */</div><div id="91" class="line none">   91 </div><div id="92" class="line none">   92 bool <a href="bn_override.c.html#92">bignum_is_valid</a>(<a href="../../include/openssl/ossl_typ.h.html#31">BIGNUM</a> *a) {</div><div id="93" class="line none">   93     return a &amp;&amp; a-&gt;<a href="bn_override.c.html#26">is_initialized</a>;</div><div id="94" class="line none">   94 }</div><div id="95" class="line none">   95 </div><div id="96" class="line none">   96 <a href="../../include/openssl/ossl_typ.h.html#31">BIGNUM</a> *<a href="bn_override.c.html#96">bignum_nondet_alloc</a>() {</div><div id="97" class="line none">   97     return <a href="../../aws-c-common/verification/cbmc/sources/proof_allocators.c.html#76">can_fail_malloc</a>(sizeof(<a href="../../include/openssl/ossl_typ.h.html#31">BIGNUM</a>));</div><div id="98" class="line none">   98 }</div>
</div>
</body>
</html>
