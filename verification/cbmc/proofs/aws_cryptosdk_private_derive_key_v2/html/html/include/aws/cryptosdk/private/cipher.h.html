
<html>
<head>
<title>include/aws/cryptosdk/private/cipher.h</title>
<link rel="stylesheet" type="text/css" href="../../../../viewer.css">
</head>

<body>
<div class="code">
<div id="1" class="line none">    1 /*</div><div id="2" class="line none">    2  * Copyright 2018 Amazon.com, Inc. or its affiliates. All Rights Reserved.</div><div id="3" class="line none">    3  *</div><div id="4" class="line none">    4  * Licensed under the Apache License, Version 2.0 (the "License"). You may not use</div><div id="5" class="line none">    5  * this file except in compliance with the License. A copy of the License is</div><div id="6" class="line none">    6  * located at</div><div id="7" class="line none">    7  *</div><div id="8" class="line none">    8  *     http://aws.amazon.com/apache2.0/</div><div id="9" class="line none">    9  *</div><div id="10" class="line none">   10  * or in the "license" file accompanying this file. This file is distributed on an</div><div id="11" class="line none">   11  * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or</div><div id="12" class="line none">   12  * implied. See the License for the specific language governing permissions and</div><div id="13" class="line none">   13  * limitations under the License.</div><div id="14" class="line none">   14  */</div><div id="15" class="line none">   15 </div><div id="16" class="line none">   16 #ifndef <a href="cipher.h.html#17">AWS_CRYPTOSDK_PRIVATE_CIPHER_H</a></div><div id="17" class="line none">   17 #define <a href="cipher.h.html#17">AWS_CRYPTOSDK_PRIVATE_CIPHER_H</a></div><div id="18" class="line none">   18 </div><div id="19" class="line none">   19 #include &lt;aws/cryptosdk/<a href="../../../../verification/cbmc/sources/openssl/evp_override.c.html#437">cipher</a>.h&gt;</div><div id="20" class="line none">   20 #include &lt;openssl/evp.h&gt;</div><div id="21" class="line none">   21 </div><div id="22" class="line none">   22 /*</div><div id="23" class="line none">   23  * TODO - Finish splitting cipher.c into common code and backend, and move this into the backends.</div><div id="24" class="line none">   24  */</div><div id="25" class="line none">   25 struct <a href="../cipher.h.html#67">aws_cryptosdk_alg_impl</a> {</div><div id="26" class="line none">   26     const <a href="../../../../verification/cbmc/include/openssl/ossl_typ.h.html#40">EVP_MD</a> *(*<a href="cipher.h.html#26">md_ctor</a>)(void);</div><div id="27" class="line none">   27     const <a href="../../../../verification/cbmc/include/openssl/ossl_typ.h.html#40">EVP_MD</a> *(*<a href="cipher.h.html#27">sig_md_ctor</a>)(void);</div><div id="28" class="line none">   28     const <a href="../../../../verification/cbmc/include/openssl/ossl_typ.h.html#38">EVP_CIPHER</a> *(*<a href="cipher.h.html#28">cipher_ctor</a>)(void);</div><div id="29" class="line none">   29     const char *<a href="../../../../verification/cbmc/sources/openssl/ec_override.c.html#28">curve_name</a>;</div><div id="30" class="line none">   30 };</div><div id="31" class="line none">   31 </div><div id="32" class="line none">   32 /**</div><div id="33" class="line none">   33  * Internal cryptographic helpers.</div><div id="34" class="line none">   34  * This header is not installed and is not a stable API.</div><div id="35" class="line none">   35  */</div><div id="36" class="line none">   36 </div><div id="37" class="line none">   37 #define <a href="cipher.h.html#37">MAX_DATA_KEY_SIZE</a> 32</div><div id="38" class="line none">   38 </div><div id="39" class="line none">   39 struct <a href="cipher.h.html#39">data_key</a> {</div><div id="40" class="line none">   40     uint8_t <a href="cipher.h.html#40">keybuf</a>[<a href="cipher.h.html#37">MAX_DATA_KEY_SIZE</a>];</div><div id="41" class="line none">   41 };</div><div id="42" class="line none">   42 </div><div id="43" class="line none">   43 struct <a href="cipher.h.html#43">content_key</a> {</div><div id="44" class="line none">   44     uint8_t <a href="cipher.h.html#40">keybuf</a>[<a href="cipher.h.html#37">MAX_DATA_KEY_SIZE</a>];</div><div id="45" class="line none">   45 };</div><div id="46" class="line none">   46 </div><div id="47" class="line none">   47 struct <a href="cipher.h.html#47">aws_cryptosdk_md_context</a>;</div><div id="48" class="line none">   48 </div><div id="49" class="line none">   49 #define <a href="cipher.h.html#49">AWS_CRYPTOSDK_MD_MAX_SIZE</a> (512 / 8)</div><div id="50" class="line none">   50 </div><div id="51" class="line none">   51 enum <a href="cipher.h.html#51">aws_cryptosdk_md_alg</a> { <a href="cipher.h.html#51">AWS_CRYPTOSDK_MD_SHA512</a> };</div><div id="52" class="line none">   52 </div><div id="53" class="line none">   53 static inline size_t <a href="cipher.h.html#53">aws_cryptosdk_private_authtag_len</a>(const struct <a href="../cipher.h.html#54">aws_cryptosdk_alg_properties</a> *alg_props) {</div><div id="54" class="line none">   54     if (alg_props-&gt;<a href="../cipher.h.html#98">msg_format_version</a> == <a href="../header.h.html#40">AWS_CRYPTOSDK_HEADER_VERSION_1_0</a>) {</div><div id="55" class="line none">   55         return alg_props-&gt;<a href="../cipher.h.html#77">iv_len</a> + alg_props-&gt;<a href="../cipher.h.html#83">tag_len</a>;</div><div id="56" class="line none">   56     } else {</div><div id="57" class="line none">   57         return alg_props-&gt;<a href="../cipher.h.html#83">tag_len</a>;</div><div id="58" class="line none">   58     }</div><div id="59" class="line none">   59 }</div><div id="60" class="line none">   60 </div><div id="61" class="line none">   61 /**</div><div id="62" class="line none">   62  * Performs basic validity checks for the message-digest context (e.g. that member pointers are not NULL).</div><div id="63" class="line none">   63  */</div><div id="64" class="line none">   64 bool <a href="../../../../source/cipher_openssl.c.html#96">aws_cryptosdk_md_context_is_valid</a>(const struct <a href="cipher.h.html#47">aws_cryptosdk_md_context</a> *md_context);</div><div id="65" class="line none">   65 </div><div id="66" class="line none">   66 int <a href="../../../../source/cipher_openssl.c.html#100">aws_cryptosdk_md_init</a>(</div><div id="67" class="line none">   67     struct <a href="../../../../verification/cbmc/aws-c-common/include/aws/common/allocator.h.html#15">aws_allocator</a> *<a href="../../../../verification/cbmc/aws-c-common/include/aws/common/array_list.h.html#16">alloc</a>, struct <a href="cipher.h.html#47">aws_cryptosdk_md_context</a> **md_context, enum <a href="cipher.h.html#51">aws_cryptosdk_md_alg</a> md_alg);</div><div id="68" class="line none">   68 </div><div id="69" class="line none">   69 size_t <a href="../../../../source/cipher_openssl.c.html#136">aws_cryptosdk_md_size</a>(enum <a href="cipher.h.html#51">aws_cryptosdk_md_alg</a> <a href="../materials.h.html#182">alg</a>);</div><div id="70" class="line none">   70 </div><div id="71" class="line none">   71 int <a href="../../../../source/cipher_openssl.c.html#143">aws_cryptosdk_md_update</a>(struct <a href="cipher.h.html#47">aws_cryptosdk_md_context</a> *md_context, const void *buf, size_t <a href="../../../../verification/cbmc/aws-c-common/include/aws/common/array_list.h.html#18">length</a>);</div><div id="72" class="line none">   72 </div><div id="73" class="line none">   73 int <a href="../../../../source/cipher_openssl.c.html#156">aws_cryptosdk_md_finish</a>(struct <a href="cipher.h.html#47">aws_cryptosdk_md_context</a> *md_context, void *output_buf, size_t *<a href="../../../../verification/cbmc/aws-c-common/include/aws/common/array_list.h.html#18">length</a>);</div><div id="74" class="line none">   74 </div><div id="75" class="line none">   75 void <a href="../../../../source/cipher_openssl.c.html#178">aws_cryptosdk_md_abort</a>(struct <a href="cipher.h.html#47">aws_cryptosdk_md_context</a> *md_context);</div><div id="76" class="line none">   76 </div><div id="77" class="line none">   77 size_t <a href="../../../../source/cipher.c.html#226">aws_cryptosdk_private_algorithm_message_id_len</a>(const struct <a href="../cipher.h.html#54">aws_cryptosdk_alg_properties</a> *alg_props);</div><div id="78" class="line none">   78 </div><div id="79" class="line none">   79 /**</div><div id="80" class="line none">   80  * Performs a constant-time comparison of two commitment buffers.</div><div id="81" class="line none">   81  * Returns true if they are equal.</div><div id="82" class="line none">   82  */</div><div id="83" class="line none">   83 bool <a href="../../../../source/cipher.c.html#282">aws_cryptosdk_private_commitment_eq</a>(struct <a href="../../../../verification/cbmc/aws-c-common/include/aws/common/byte_buf.h.html#25">aws_byte_buf</a> *a, struct <a href="../../../../verification/cbmc/aws-c-common/include/aws/common/byte_buf.h.html#25">aws_byte_buf</a> *b);</div><div id="84" class="line none">   84 </div><div id="85" class="line none">   85 /**</div><div id="86" class="line none">   86  * Derive the decryption key from the data key.</div><div id="87" class="line none">   87  * Depending on the algorithm ID, this either does a HKDF,</div><div id="88" class="line none">   88  * or a no-op copy of the key.</div><div id="89" class="line none">   89  */</div><div id="90" class="line none">   90 int <a href="../../../../source/cipher.c.html#408">aws_cryptosdk_private_derive_key</a>(</div><div id="91" class="line none">   91     const struct <a href="../cipher.h.html#54">aws_cryptosdk_alg_properties</a> *alg_props,</div><div id="92" class="line none">   92     struct <a href="cipher.h.html#43">content_key</a> *<a href="cipher.h.html#43">content_key</a>,</div><div id="93" class="line none">   93     const struct <a href="cipher.h.html#39">data_key</a> *<a href="cipher.h.html#39">data_key</a>,</div><div id="94" class="line none">   94     struct <a href="../../../../verification/cbmc/aws-c-common/include/aws/common/byte_buf.h.html#25">aws_byte_buf</a> *commitment,</div><div id="95" class="line none">   95     const struct <a href="../../../../verification/cbmc/aws-c-common/include/aws/common/byte_buf.h.html#25">aws_byte_buf</a> *<a href="header.h.html#31">message_id</a>);</div><div id="96" class="line none">   96 </div><div id="97" class="line none">   97 /**</div><div id="98" class="line none">   98  * Verifies the header authentication tag.</div><div id="99" class="line none">   99  * Returns AWS_OP_SUCCESS if the tag is valid, raises AWS_CRYPTOSDK_ERR_BAD_CIPHERTEXT</div><div id="100" class="line none">  100  * if invalid.</div><div id="101" class="line none">  101  */</div><div id="102" class="line none">  102 int <a href="../../../../source/cipher.c.html#563">aws_cryptosdk_verify_header</a>(</div><div id="103" class="line none">  103     const struct <a href="../cipher.h.html#54">aws_cryptosdk_alg_properties</a> *alg_props,</div><div id="104" class="line none">  104     const struct <a href="cipher.h.html#43">content_key</a> *<a href="cipher.h.html#43">content_key</a>,</div><div id="105" class="line none">  105     const struct <a href="../../../../verification/cbmc/aws-c-common/include/aws/common/byte_buf.h.html#25">aws_byte_buf</a> *authtag,</div><div id="106" class="line none">  106     const struct <a href="../../../../verification/cbmc/aws-c-common/include/aws/common/byte_buf.h.html#25">aws_byte_buf</a> *header);</div><div id="107" class="line none">  107 </div><div id="108" class="line none">  108 /**</div><div id="109" class="line none">  109  * Computes the header authentication tag. The tag (and IV) is written to the authtag buffer.</div><div id="110" class="line none">  110  */</div><div id="111" class="line none">  111 int <a href="../../../../source/cipher.c.html#504">aws_cryptosdk_sign_header</a>(</div><div id="112" class="line none">  112     const struct <a href="../cipher.h.html#54">aws_cryptosdk_alg_properties</a> *alg_props,</div><div id="113" class="line none">  113     const struct <a href="cipher.h.html#43">content_key</a> *<a href="cipher.h.html#43">content_key</a>,</div><div id="114" class="line none">  114     const struct <a href="../../../../verification/cbmc/aws-c-common/include/aws/common/byte_buf.h.html#25">aws_byte_buf</a> *authtag,</div><div id="115" class="line none">  115     const struct <a href="../../../../verification/cbmc/aws-c-common/include/aws/common/byte_buf.h.html#25">aws_byte_buf</a> *header);</div><div id="116" class="line none">  116 </div><div id="117" class="line none">  117 enum <a href="cipher.h.html#117">aws_cryptosdk_frame_type</a> { <a href="cipher.h.html#117">FRAME_TYPE_SINGLE</a>, <a href="cipher.h.html#117">FRAME_TYPE_FRAME</a>, <a href="cipher.h.html#117">FRAME_TYPE_FINAL</a> };</div><div id="118" class="line none">  118 </div><div id="119" class="line none">  119 // TODO: Initialize the cipher once and reuse it</div><div id="120" class="line none">  120 /**</div><div id="121" class="line none">  121  * Decrypts either the body of the message (for non-framed messages) or a single frame of the message.</div><div id="122" class="line none">  122  * Returns AWS_OP_SUCCESS if successful.</div><div id="123" class="line none">  123  */</div><div id="124" class="line none">  124 int <a href="../../../../source/cipher.c.html#746">aws_cryptosdk_decrypt_body</a>(</div><div id="125" class="line none">  125     const struct <a href="../cipher.h.html#54">aws_cryptosdk_alg_properties</a> *alg_props,</div><div id="126" class="line none">  126     struct <a href="../../../../verification/cbmc/aws-c-common/include/aws/common/byte_buf.h.html#25">aws_byte_buf</a> *out,</div><div id="127" class="line none">  127     const struct <a href="../../../../verification/cbmc/aws-c-common/include/aws/common/byte_buf.h.html#38">aws_byte_cursor</a> *in,</div><div id="128" class="line none">  128     const struct <a href="../../../../verification/cbmc/aws-c-common/include/aws/common/byte_buf.h.html#25">aws_byte_buf</a> *<a href="header.h.html#31">message_id</a>,</div><div id="129" class="line none">  129     uint32_t seqno,</div><div id="130" class="line none">  130     const uint8_t *<a href="header.h.html#31">iv</a>,</div><div id="131" class="line none">  131     const struct <a href="cipher.h.html#43">content_key</a> *<a href="../../../../verification/cbmc/aws-c-common/include/aws/common/hash_table.h.html#64">key</a>,</div><div id="132" class="line none">  132     const uint8_t *tag,</div><div id="133" class="line none">  133     int body_frame_type);</div><div id="134" class="line none">  134 </div><div id="135" class="line none">  135 /**</div><div id="136" class="line none">  136  * Encrypts either the body of the message (for non-framed messages) or a single frame of the message.</div><div id="137" class="line none">  137  * Returns AWS_OP_SUCCESS if successful.</div><div id="138" class="line none">  138  */</div><div id="139" class="line none">  139 int <a href="../../../../source/cipher.c.html#646">aws_cryptosdk_encrypt_body</a>(</div><div id="140" class="line none">  140     const struct <a href="../cipher.h.html#54">aws_cryptosdk_alg_properties</a> *alg_props,</div><div id="141" class="line none">  141     struct <a href="../../../../verification/cbmc/aws-c-common/include/aws/common/byte_buf.h.html#25">aws_byte_buf</a> *out,</div><div id="142" class="line none">  142     const struct <a href="../../../../verification/cbmc/aws-c-common/include/aws/common/byte_buf.h.html#38">aws_byte_cursor</a> *in,</div><div id="143" class="line none">  143     const struct <a href="../../../../verification/cbmc/aws-c-common/include/aws/common/byte_buf.h.html#25">aws_byte_buf</a> *<a href="header.h.html#31">message_id</a>,</div><div id="144" class="line none">  144     uint32_t seqno,</div><div id="145" class="line none">  145     uint8_t *<a href="header.h.html#31">iv</a>, /* out */</div><div id="146" class="line none">  146     const struct <a href="cipher.h.html#43">content_key</a> *<a href="../../../../verification/cbmc/aws-c-common/include/aws/common/hash_table.h.html#64">key</a>,</div><div id="147" class="line none">  147     uint8_t *tag, /* out */</div><div id="148" class="line none">  148     int body_frame_type);</div><div id="149" class="line none">  149 </div><div id="150" class="line none">  150 int <a href="../../../../source/cipher.c.html#808">aws_cryptosdk_genrandom</a>(uint8_t *buf, size_t <a href="../../../../verification/cbmc/aws-c-common/include/aws/common/byte_buf.h.html#27">len</a>);</div><div id="151" class="line none">  151 </div><div id="152" class="line none">  152 // TODO: Footer</div><div id="153" class="line none">  153 </div><div id="154" class="line none">  154 /**</div><div id="155" class="line none">  155  * Does AES-GCM encryption using AES-256/192/128 with 12 byte IVs and 16 byte tags only.</div><div id="156" class="line none">  156  * Determines which AES algorithm to use based on length of key.</div><div id="157" class="line none">  157  *</div><div id="158" class="line none">  158  * Assumes cipher and tag are already allocated byte buffers. Does NOT assume that lengths</div><div id="159" class="line none">  159  * of buffers are already set, and will set them on successful encrypt.</div><div id="160" class="line none">  160  *</div><div id="161" class="line none">  161  * Returns AWS_OP_SUCCESS on a successful encrypt. On failure, returns AWS_OP_ERR and sets</div><div id="162" class="line none">  162  * one of the following error codes:</div><div id="163" class="line none">  163  *</div><div id="164" class="line none">  164  * AWS_INVALID_BUFFER_SIZE : bad key or IV length, or not enough capacity in output buffers</div><div id="165" class="line none">  165  * AWS_CRYPTOSDK_ERR_CRYPTO_UNKNOWN : OpenSSL error</div><div id="166" class="line none">  166  *</div><div id="167" class="line none">  167  * On last error, output buffers will be set to all zero bytes, and their lengths will be</div><div id="168" class="line none">  168  * set to zero.</div><div id="169" class="line none">  169  */</div><div id="170" class="line none">  170 int <a href="../../../../source/cipher.c.html#837">aws_cryptosdk_aes_gcm_encrypt</a>(</div><div id="171" class="line none">  171     struct <a href="../../../../verification/cbmc/aws-c-common/include/aws/common/byte_buf.h.html#25">aws_byte_buf</a> *<a href="../../../../verification/cbmc/sources/openssl/evp_override.c.html#437">cipher</a>,</div><div id="172" class="line none">  172     struct <a href="../../../../verification/cbmc/aws-c-common/include/aws/common/byte_buf.h.html#25">aws_byte_buf</a> *tag,</div><div id="173" class="line none">  173     const struct <a href="../../../../verification/cbmc/aws-c-common/include/aws/common/byte_buf.h.html#38">aws_byte_cursor</a> plain,</div><div id="174" class="line none">  174     const struct <a href="../../../../verification/cbmc/aws-c-common/include/aws/common/byte_buf.h.html#38">aws_byte_cursor</a> <a href="header.h.html#31">iv</a>,</div><div id="175" class="line none">  175     const struct <a href="../../../../verification/cbmc/aws-c-common/include/aws/common/byte_buf.h.html#38">aws_byte_cursor</a> aad,</div><div id="176" class="line none">  176     const struct <a href="../../../../verification/cbmc/aws-c-common/include/aws/common/string.h.html#41">aws_string</a> *<a href="../../../../verification/cbmc/aws-c-common/include/aws/common/hash_table.h.html#64">key</a>);</div><div id="177" class="line none">  177 </div><div id="178" class="line none">  178 /**</div><div id="179" class="line none">  179  * Does AES-GCM decryption using AES-256/192/128 with 12 byte IVs and 16 byte tags only.</div><div id="180" class="line none">  180  * Determines which AES algorithm to use based on length of key.</div><div id="181" class="line none">  181  *</div><div id="182" class="line none">  182  * Assumes plain is an already allocated byte buffer. Does NOT assume that length of plain</div><div id="183" class="line none">  183  * buffer is already set, and will set it to the length of plain on a successful decrypt.</div><div id="184" class="line none">  184  *</div><div id="185" class="line none">  185  * Returns AWS_OP_SUCCESS on a successful decrypt. On failure, returns AWS_OP_ERR and sets</div><div id="186" class="line none">  186  * one of the following error codes:</div><div id="187" class="line none">  187  *</div><div id="188" class="line none">  188  * AWS_INVALID_BUFFER_SIZE : bad key, tag, or IV length, or not enough capacity in plain</div><div id="189" class="line none">  189  * AWS_CRYPTOSDK_ERR_BAD_CIPHERTEXT : unable to decrypt or authenticate ciphertext</div><div id="190" class="line none">  190  * AWS_CRYPTOSDK_ERR_CRYPTO_UNKNOWN : OpenSSL error</div><div id="191" class="line none">  191  *</div><div id="192" class="line none">  192  * On either of the last two errors, the plain buffer will be set to all zero bytes, and its</div><div id="193" class="line none">  193  * length will be set to zero.</div><div id="194" class="line none">  194  */</div><div id="195" class="line none">  195 int <a href="../../../../source/cipher.c.html#884">aws_cryptosdk_aes_gcm_decrypt</a>(</div><div id="196" class="line none">  196     struct <a href="../../../../verification/cbmc/aws-c-common/include/aws/common/byte_buf.h.html#25">aws_byte_buf</a> *plain,</div><div id="197" class="line none">  197     const struct <a href="../../../../verification/cbmc/aws-c-common/include/aws/common/byte_buf.h.html#38">aws_byte_cursor</a> <a href="../../../../verification/cbmc/sources/openssl/evp_override.c.html#437">cipher</a>,</div><div id="198" class="line none">  198     const struct <a href="../../../../verification/cbmc/aws-c-common/include/aws/common/byte_buf.h.html#38">aws_byte_cursor</a> tag,</div><div id="199" class="line none">  199     const struct <a href="../../../../verification/cbmc/aws-c-common/include/aws/common/byte_buf.h.html#38">aws_byte_cursor</a> <a href="header.h.html#31">iv</a>,</div><div id="200" class="line none">  200     const struct <a href="../../../../verification/cbmc/aws-c-common/include/aws/common/byte_buf.h.html#38">aws_byte_cursor</a> aad,</div><div id="201" class="line none">  201     const struct <a href="../../../../verification/cbmc/aws-c-common/include/aws/common/string.h.html#41">aws_string</a> *<a href="../../../../verification/cbmc/aws-c-common/include/aws/common/hash_table.h.html#64">key</a>);</div><div id="202" class="line none">  202 </div><div id="203" class="line none">  203 /**</div><div id="204" class="line none">  204  * Does RSA decryption of an encrypted data key to an unecrypted data key.</div><div id="205" class="line none">  205  * RSA with PKCS1, OAEP_SHA1_MGF1 and OAEP_SHA256_MGF1 padding modes is supported.</div><div id="206" class="line none">  206  *</div><div id="207" class="line none">  207  * Here, 'plain' refers to the unencrypted AES data key obtained as a result of the RSA</div><div id="208" class="line none">  208  * decryption, 'rsa_private_key_pem' is a string that contains the RSA private key in PEM</div><div id="209" class="line none">  209  * format and 'cipher' is the encrypted AES data key.</div><div id="210" class="line none">  210  *</div><div id="211" class="line none">  211  * This function requires that plain has no memory allocated to it already, and allocates</div><div id="212" class="line none">  212  * it newly. The length of the buffer will be set to the length of plain on a successful decrypt.</div><div id="213" class="line none">  213  *</div><div id="214" class="line none">  214  * Returns AWS_OP_SUCCESS on a successful decrypt. On failure, returns AWS_OP_ERR and sets</div><div id="215" class="line none">  215  * one of the following error codes:</div><div id="216" class="line none">  216  *</div><div id="217" class="line none">  217  * AWS_CRYPTOSDK_ERR_BAD_STATE : the output buffer was not in the proper (unallocated) state</div><div id="218" class="line none">  218  * AWS_CRYPTOSDK_ERR_UNSUPPORTED_FORMAT: unsupported padding mode for RSA wrapping algorithm</div><div id="219" class="line none">  219  * AWS_CRYPTOSDK_ERR_BAD_CIPHERTEXT : unable to decrypt or authenticate cipher text</div><div id="220" class="line none">  220  * AWS_CRYPTOSDK_ERR_CRYPTO_UNKNOWN : OpenSSL error</div><div id="221" class="line none">  221  */</div><div id="222" class="line none">  222 int <a href="../../../../source/cipher.c.html#1003">aws_cryptosdk_rsa_decrypt</a>(</div><div id="223" class="line none">  223     struct <a href="../../../../verification/cbmc/aws-c-common/include/aws/common/byte_buf.h.html#25">aws_byte_buf</a> *plain,</div><div id="224" class="line none">  224     struct <a href="../../../../verification/cbmc/aws-c-common/include/aws/common/allocator.h.html#15">aws_allocator</a> *<a href="../../../../verification/cbmc/aws-c-common/include/aws/common/array_list.h.html#16">alloc</a>,</div><div id="225" class="line none">  225     const struct <a href="../../../../verification/cbmc/aws-c-common/include/aws/common/byte_buf.h.html#38">aws_byte_cursor</a> <a href="../../../../verification/cbmc/sources/openssl/evp_override.c.html#437">cipher</a>,</div><div id="226" class="line none">  226     const struct <a href="../../../../verification/cbmc/aws-c-common/include/aws/common/string.h.html#41">aws_string</a> *rsa_private_key_pem,</div><div id="227" class="line none">  227     enum <a href="../cipher.h.html#42">aws_cryptosdk_rsa_padding_mode</a> rsa_padding_mode);</div><div id="228" class="line none">  228 </div><div id="229" class="line none">  229 /**</div><div id="230" class="line none">  230  * Does RSA encryption of an unencrypted data key to an encrypted data key.</div><div id="231" class="line none">  231  * RSA with PKCS1, OAEP_SHA1_MGF1 and OAEP_SHA256_MGF1 padding modes is supported.</div><div id="232" class="line none">  232  *</div><div id="233" class="line none">  233  * Here, 'cipher' is the encrypted AES data key obtained as a result of the RSA encryption,</div><div id="234" class="line none">  234  *'rsa_public_key_pem' is a string that contains the RSA public key in PEM format and 'plain'</div><div id="235" class="line none">  235  * refers to the unencrypted AES data key.</div><div id="236" class="line none">  236  *</div><div id="237" class="line none">  237  * This function requires that cipher has no memory allocated to it already, and allocates</div><div id="238" class="line none">  238  * it newly. The length of the buffer will be set to the length of cipher on a successful encrypt.</div><div id="239" class="line none">  239  *</div><div id="240" class="line none">  240  * Returns AWS_OP_SUCCESS on a successful encrypt. On failure, returns AWS_OP_ERR and sets</div><div id="241" class="line none">  241  * one of the following error codes:</div><div id="242" class="line none">  242  *</div><div id="243" class="line none">  243  * AWS_CRYPTOSDK_ERR_BAD_STATE : the output buffer was not in the proper (unallocated) state</div><div id="244" class="line none">  244  * AWS_CRYPTOSDK_ERR_UNSUPPORTED_FORMAT: unsupported padding mode for RSA wrapping algorithm</div><div id="245" class="line none">  245  * AWS_CRYPTOSDK_ERR_CRYPTO_UNKNOWN : OpenSSL error or other unknown errors</div><div id="246" class="line none">  246  */</div><div id="247" class="line none">  247 int <a href="../../../../source/cipher.c.html#952">aws_cryptosdk_rsa_encrypt</a>(</div><div id="248" class="line none">  248     struct <a href="../../../../verification/cbmc/aws-c-common/include/aws/common/byte_buf.h.html#25">aws_byte_buf</a> *<a href="../../../../verification/cbmc/sources/openssl/evp_override.c.html#437">cipher</a>,</div><div id="249" class="line none">  249     struct <a href="../../../../verification/cbmc/aws-c-common/include/aws/common/allocator.h.html#15">aws_allocator</a> *<a href="../../../../verification/cbmc/aws-c-common/include/aws/common/array_list.h.html#16">alloc</a>,</div><div id="250" class="line none">  250     const struct <a href="../../../../verification/cbmc/aws-c-common/include/aws/common/byte_buf.h.html#38">aws_byte_cursor</a> plain,</div><div id="251" class="line none">  251     const struct <a href="../../../../verification/cbmc/aws-c-common/include/aws/common/string.h.html#41">aws_string</a> *rsa_public_key_pem,</div><div id="252" class="line none">  252     enum <a href="../cipher.h.html#42">aws_cryptosdk_rsa_padding_mode</a> rsa_padding_mode);</div><div id="253" class="line none">  253 </div><div id="254" class="line none">  254 bool <a href="../../../../source/cipher.c.html#1056">aws_cryptosdk_data_key_is_valid</a>(const struct <a href="cipher.h.html#39">data_key</a> *<a href="../../../../verification/cbmc/aws-c-common/include/aws/common/hash_table.h.html#64">key</a>);</div><div id="255" class="line none">  255 </div><div id="256" class="line none">  256 bool <a href="../../../../source/cipher.c.html#1060">aws_cryptosdk_content_key_is_valid</a>(const struct <a href="cipher.h.html#43">content_key</a> *<a href="../../../../verification/cbmc/aws-c-common/include/aws/common/hash_table.h.html#64">key</a>);</div><div id="257" class="line none">  257 </div><div id="258" class="line none">  258 #endif  // AWS_CRYPTOSDK_PRIVATE_CIPHER_H</div>
</div>
</body>
</html>
