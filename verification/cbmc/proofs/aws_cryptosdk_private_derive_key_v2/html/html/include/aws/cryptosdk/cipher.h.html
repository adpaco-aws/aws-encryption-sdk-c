
<html>
<head>
<title>include/aws/cryptosdk/cipher.h</title>
<link rel="stylesheet" type="text/css" href="../../../viewer.css">
</head>

<body>
<div class="code">
<div id="1" class="line none">    1 /*</div><div id="2" class="line none">    2  * Copyright 2018 Amazon.com, Inc. or its affiliates. All Rights Reserved.</div><div id="3" class="line none">    3  *</div><div id="4" class="line none">    4  * Licensed under the Apache License, Version 2.0 (the "License"). You may not use</div><div id="5" class="line none">    5  * this file except in compliance with the License. A copy of the License is</div><div id="6" class="line none">    6  * located at</div><div id="7" class="line none">    7  *</div><div id="8" class="line none">    8  *     http://aws.amazon.com/apache2.0/</div><div id="9" class="line none">    9  *</div><div id="10" class="line none">   10  * or in the "license" file accompanying this file. This file is distributed on an</div><div id="11" class="line none">   11  * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or</div><div id="12" class="line none">   12  * implied. See the License for the specific language governing permissions and</div><div id="13" class="line none">   13  * limitations under the License.</div><div id="14" class="line none">   14  */</div><div id="15" class="line none">   15 </div><div id="16" class="line none">   16 #ifndef <a href="cipher.h.html#17">AWS_CRYPTOSDK_CIPHER_H</a></div><div id="17" class="line none">   17 #define <a href="cipher.h.html#17">AWS_CRYPTOSDK_CIPHER_H</a></div><div id="18" class="line none">   18 </div><div id="19" class="line none">   19 #include &lt;aws/common/byte_buf.h&gt;</div><div id="20" class="line none">   20 #include &lt;aws/common/string.h&gt;</div><div id="21" class="line none">   21 #include &lt;aws/cryptosdk/exports.h&gt;</div><div id="22" class="line none">   22 #include &lt;aws/cryptosdk/header.h&gt;</div><div id="23" class="line none">   23 </div><div id="24" class="line none">   24 /**</div><div id="25" class="line none">   25  * @addtogroup hazmat Low-level cryptographic APIs</div><div id="26" class="line none">   26  * These low-level cryptographic APIs should normally only be used by developers of keyrings or CMMs.</div><div id="27" class="line none">   27  * @{</div><div id="28" class="line none">   28  */</div><div id="29" class="line none">   29 </div><div id="30" class="line none">   30 #ifdef __cplusplus</div><div id="31" class="line none">   31 extern "C" {</div><div id="32" class="line none">   32 #endif</div><div id="33" class="line none">   33 </div><div id="34" class="line none">   34 /** @ingroup raw_keyring */</div><div id="35" class="line none">   35 enum <a href="cipher.h.html#35">aws_cryptosdk_aes_key_len</a> {</div><div id="36" class="line none">   36     <a href="cipher.h.html#36">AWS_CRYPTOSDK_AES128</a> = 128 / 8,</div><div id="37" class="line none">   37     <a href="cipher.h.html#37">AWS_CRYPTOSDK_AES192</a> = 192 / 8,</div><div id="38" class="line none">   38     <a href="cipher.h.html#38">AWS_CRYPTOSDK_AES256</a> = 256 / 8</div><div id="39" class="line none">   39 };</div><div id="40" class="line none">   40 </div><div id="41" class="line none">   41 /** @ingroup raw_keyring */</div><div id="42" class="line none">   42 enum <a href="cipher.h.html#42">aws_cryptosdk_rsa_padding_mode</a> {</div><div id="43" class="line none">   43     <a href="cipher.h.html#43">AWS_CRYPTOSDK_RSA_PKCS1</a>,</div><div id="44" class="line none">   44     <a href="cipher.h.html#44">AWS_CRYPTOSDK_RSA_OAEP_SHA1_MGF1</a>,</div><div id="45" class="line none">   45     <a href="cipher.h.html#45">AWS_CRYPTOSDK_RSA_OAEP_SHA256_MGF1</a>,</div><div id="46" class="line none">   46 };</div><div id="47" class="line none">   47 </div><div id="48" class="line none">   48 /**</div><div id="49" class="line none">   49  * This structure contains information about a particular algorithm suite used</div><div id="50" class="line none">   50  * within the encryption SDK.  In most cases, end-users don't need to</div><div id="51" class="line none">   51  * manipulate this structure, but it can occasionally be needed for more</div><div id="52" class="line none">   52  * advanced use cases, such as writing keyrings.</div><div id="53" class="line none">   53  */</div><div id="54" class="line none">   54 struct <a href="cipher.h.html#54">aws_cryptosdk_alg_properties</a> {</div><div id="55" class="line none">   55     /** The name of the digest algorithm used for the KDF, or NULL if no KDF is used. */</div><div id="56" class="line none">   56     const char *<a href="cipher.h.html#56">md_name</a>;</div><div id="57" class="line none">   57     /** The name of the symmetric cipher in use. */</div><div id="58" class="line none">   58     const char *<a href="cipher.h.html#58">cipher_name</a>;</div><div id="59" class="line none">   59     /** The name of the overall algorithm suite in use (for debugging purposes) */</div><div id="60" class="line none">   60     const char *<a href="cipher.h.html#60">alg_name</a>;</div><div id="61" class="line none">   61 </div><div id="62" class="line none">   62     /**</div><div id="63" class="line none">   63      * Pointer to a structure containing crypto-backend-specific</div><div id="64" class="line none">   64      * information. This is a forward-declared structure to keep it</div><div id="65" class="line none">   65      * opaque to backend-independent code</div><div id="66" class="line none">   66      */</div><div id="67" class="line none">   67     const struct <a href="cipher.h.html#67">aws_cryptosdk_alg_impl</a> *<a href="../../../verification/cbmc/aws-c-common/include/aws/common/allocator.h.html#22">impl</a>;</div><div id="68" class="line none">   68 </div><div id="69" class="line none">   69     /** The length of the data key (that is, the key returned by the keyrings/CMMs) */</div><div id="70" class="line none">   70     size_t <a href="cipher.h.html#70">data_key_len</a>;</div><div id="71" class="line none">   71     /**</div><div id="72" class="line none">   72      * The length of the key used to actually encrypt/decrypt data. This may differ</div><div id="73" class="line none">   73      * if a KDF is in use.</div><div id="74" class="line none">   74      */</div><div id="75" class="line none">   75     size_t <a href="cipher.h.html#75">content_key_len</a>;</div><div id="76" class="line none">   76     /** The IV length for this algorithm suite */</div><div id="77" class="line none">   77     size_t <a href="cipher.h.html#77">iv_len</a>;</div><div id="78" class="line none">   78     /**</div><div id="79" class="line none">   79      * The AEAD tag length for this algorithm suite. Note that, currently, we only</div><div id="80" class="line none">   80      * support stream-like ciphers that do not require padding, so the ciphertext</div><div id="81" class="line none">   81      * size is equal to the plaintext size plus tag (and IV, if you pre/append IV).</div><div id="82" class="line none">   82      */</div><div id="83" class="line none">   83     size_t <a href="cipher.h.html#83">tag_len</a>;</div><div id="84" class="line none">   84     /**</div><div id="85" class="line none">   85      * The length of the trailing signature. Zero if there is no trailing signature</div><div id="86" class="line none">   86      * for this algorithm suite.</div><div id="87" class="line none">   87      */</div><div id="88" class="line none">   88     size_t <a href="cipher.h.html#88">signature_len</a>;</div><div id="89" class="line none">   89 </div><div id="90" class="line none">   90     /**</div><div id="91" class="line none">   91      * The algorithm ID for this algorithm suite</div><div id="92" class="line none">   92      */</div><div id="93" class="line none">   93     enum <a href="header.h.html#26">aws_cryptosdk_alg_id</a> <a href="private/header.h.html#27">alg_id</a>;</div><div id="94" class="line none">   94 </div><div id="95" class="line none">   95     /**</div><div id="96" class="line none">   96      * The message format version</div><div id="97" class="line none">   97      */</div><div id="98" class="line none">   98     enum <a href="header.h.html#40">aws_cryptosdk_hdr_version</a> <a href="cipher.h.html#98">msg_format_version</a>;</div><div id="99" class="line none">   99 </div><div id="100" class="line none">  100     /**</div><div id="101" class="line none">  101      * Length of the Algorithm Suite Data for this algorithm suite</div><div id="102" class="line none">  102      */</div><div id="103" class="line none">  103     size_t <a href="cipher.h.html#103">alg_suite_data_len</a>;</div><div id="104" class="line none">  104 </div><div id="105" class="line none">  105     /**</div><div id="106" class="line none">  106      * Length of commitment value for algorithm suite (or 0 if this algorithm</div><div id="107" class="line none">  107      * suite does not support commitment)</div><div id="108" class="line none">  108      */</div><div id="109" class="line none">  109     size_t <a href="cipher.h.html#109">commitment_len</a>;</div><div id="110" class="line none">  110 </div><div id="111" class="line none">  111     /** The name of the digest algorithm used for the signature algorithm, or NULL if no signature is used. */</div><div id="112" class="line none">  112     const char *<a href="cipher.h.html#112">sig_md_name</a>;</div><div id="113" class="line none">  113 };</div><div id="114" class="line none">  114 </div><div id="115" class="line none">  115 /**</div><div id="116" class="line none">  116  * Looks up and returns the algorithm properties for a particular algorithm ID.</div><div id="117" class="line none">  117  *</div><div id="118" class="line none">  118  * @returns the algorithm properties, or NULL if alg_id is unknown</div><div id="119" class="line none">  119  */</div><div id="120" class="line none">  120 AWS_CRYPTOSDK_API</div><div id="121" class="line none">  121 const struct <a href="cipher.h.html#54">aws_cryptosdk_alg_properties</a> *<a href="../../../source/cipher.c.html#33">aws_cryptosdk_alg_props</a>(enum <a href="header.h.html#26">aws_cryptosdk_alg_id</a> <a href="private/header.h.html#27">alg_id</a>);</div><div id="122" class="line none">  122 </div><div id="123" class="line none">  123 /**</div><div id="124" class="line none">  124  * Checks whether an aws_cryptosdk_alg_properties is valid and supported by the SDK.</div><div id="125" class="line none">  125  */</div><div id="126" class="line none">  126 AWS_CRYPTOSDK_API</div><div id="127" class="line none">  127 bool <a href="../../../source/cipher.c.html#269">aws_cryptosdk_alg_properties_is_valid</a>(const struct <a href="cipher.h.html#54">aws_cryptosdk_alg_properties</a> *const alg_props);</div><div id="128" class="line none">  128 </div><div id="129" class="line none">  129 /**</div><div id="130" class="line none">  130  * An opaque structure representing an ongoing sign or verify operation</div><div id="131" class="line none">  131  */</div><div id="132" class="line none">  132 struct <a href="cipher.h.html#132">aws_cryptosdk_sig_ctx</a>;</div><div id="133" class="line none">  133 </div><div id="134" class="line none">  134 /**</div><div id="135" class="line none">  135  * Performs basic validity checks for the signing context (e.g. that member pointers are not NULL).</div><div id="136" class="line none">  136  */</div><div id="137" class="line none">  137 AWS_CRYPTOSDK_API</div><div id="138" class="line none">  138 bool <a href="../../../source/cipher_openssl.c.html#82">aws_cryptosdk_sig_ctx_is_valid</a>(const struct <a href="cipher.h.html#132">aws_cryptosdk_sig_ctx</a> *sig_ctx);</div><div id="139" class="line none">  139 </div><div id="140" class="line none">  140 /**</div><div id="141" class="line none">  141  * Obtains the private key from a signing context, and serializes it to a byte buffer.</div><div id="142" class="line none">  142  * The serialization format is not currently guaranteed to remain unchanged.</div><div id="143" class="line none">  143  *</div><div id="144" class="line none">  144  * This method is intended to be used with caching mechanisms to clone the signing context.</div><div id="145" class="line none">  145  */</div><div id="146" class="line none">  146 AWS_CRYPTOSDK_API</div><div id="147" class="line none">  147 int <a href="../../../source/cipher_openssl.c.html#321">aws_cryptosdk_sig_get_privkey</a>(</div><div id="148" class="line none">  148     const struct <a href="cipher.h.html#132">aws_cryptosdk_sig_ctx</a> *<a href="../../../source/cipher_openssl.c.html#78">ctx</a>, struct <a href="../../../verification/cbmc/aws-c-common/include/aws/common/allocator.h.html#15">aws_allocator</a> *<a href="../../../verification/cbmc/aws-c-common/include/aws/common/array_list.h.html#16">alloc</a>, struct <a href="../../../verification/cbmc/aws-c-common/include/aws/common/string.h.html#41">aws_string</a> **priv_key_buf);</div><div id="149" class="line none">  149 </div><div id="150" class="line none">  150 /**</div><div id="151" class="line none">  151  * Obtains the public key from a signing context, which may be in either sign or verify</div><div id="152" class="line none">  152  * mode, and serializes it to a byte buffer.</div><div id="153" class="line none">  153  *</div><div id="154" class="line none">  154  * This method is intended to be used with caching mechanisms to clone a verification context.</div><div id="155" class="line none">  155  */</div><div id="156" class="line none">  156 AWS_CRYPTOSDK_API</div><div id="157" class="line none">  157 int <a href="../../../source/cipher_openssl.c.html#311">aws_cryptosdk_sig_get_pubkey</a>(</div><div id="158" class="line none">  158     const struct <a href="cipher.h.html#132">aws_cryptosdk_sig_ctx</a> *<a href="../../../source/cipher_openssl.c.html#78">ctx</a>, struct <a href="../../../verification/cbmc/aws-c-common/include/aws/common/allocator.h.html#15">aws_allocator</a> *<a href="../../../verification/cbmc/aws-c-common/include/aws/common/array_list.h.html#16">alloc</a>, struct <a href="../../../verification/cbmc/aws-c-common/include/aws/common/string.h.html#41">aws_string</a> **pub_key_buf);</div><div id="159" class="line none">  159 </div><div id="160" class="line none">  160 /**</div><div id="161" class="line none">  161  * Generates a new signature keypair, initializes a signing context, and serializes the public key.</div><div id="162" class="line none">  162  * If a non-signing algorithm is used, this function returns successfully, sets *ctx to NULL,</div><div id="163" class="line none">  163  * and zeroes pub_key_buf.</div><div id="164" class="line none">  164  *</div><div id="165" class="line none">  165  * @param ctx - a pointer to a variable to receive the context pointer</div><div id="166" class="line none">  166  * @param alloc - the allocator to use</div><div id="167" class="line none">  167  * @param pub_key_buf - A buffer that will receive the public key (in base64 format).</div><div id="168" class="line none">  168  *   This buffer will be allocated as part of this call, and does not need to be pre-initialized.</div><div id="169" class="line none">  169  * @param props - The algorithm properties for the algorithm to use</div><div id="170" class="line none">  170  */</div><div id="171" class="line none">  171 AWS_CRYPTOSDK_API</div><div id="172" class="line none">  172 int <a href="../../../source/cipher_openssl.c.html#431">aws_cryptosdk_sig_sign_start_keygen</a>(</div><div id="173" class="line none">  173     struct <a href="cipher.h.html#132">aws_cryptosdk_sig_ctx</a> **<a href="../../../source/cipher_openssl.c.html#78">ctx</a>,</div><div id="174" class="line none">  174     struct <a href="../../../verification/cbmc/aws-c-common/include/aws/common/allocator.h.html#15">aws_allocator</a> *<a href="../../../verification/cbmc/aws-c-common/include/aws/common/array_list.h.html#16">alloc</a>,</div><div id="175" class="line none">  175     struct <a href="../../../verification/cbmc/aws-c-common/include/aws/common/string.h.html#41">aws_string</a> **pub_key_buf,</div><div id="176" class="line none">  176     const struct <a href="cipher.h.html#54">aws_cryptosdk_alg_properties</a> *<a href="../../../source/cipher_openssl.c.html#75">props</a>);</div><div id="177" class="line none">  177 </div><div id="178" class="line none">  178 /**</div><div id="179" class="line none">  179  * Initializes a new signature context based on a private key serialized using</div><div id="180" class="line none">  180  * aws_cryptosdk_sig_get_privkey.</div><div id="181" class="line none">  181  *</div><div id="182" class="line none">  182  * @param ctx a pointer to a variable to receive the signing context</div><div id="183" class="line none">  183  * @param alloc the allocator to use</div><div id="184" class="line none">  184  * @param pub_key_buf a pointer to a buffer that will receive the base-64 public key,</div><div id="185" class="line none">  185  *     or NULL if not required</div><div id="186" class="line none">  186  * @param props algorithm properties for the algorithm suite in use</div><div id="187" class="line none">  187  * @param priv_key the previously serialized private key</div><div id="188" class="line none">  188  */</div><div id="189" class="line none">  189 AWS_CRYPTOSDK_API</div><div id="190" class="line none">  190 int <a href="../../../source/cipher_openssl.c.html#524">aws_cryptosdk_sig_sign_start</a>(</div><div id="191" class="line none">  191     struct <a href="cipher.h.html#132">aws_cryptosdk_sig_ctx</a> **<a href="../../../source/cipher_openssl.c.html#78">ctx</a>,</div><div id="192" class="line none">  192     struct <a href="../../../verification/cbmc/aws-c-common/include/aws/common/allocator.h.html#15">aws_allocator</a> *<a href="../../../verification/cbmc/aws-c-common/include/aws/common/array_list.h.html#16">alloc</a>,</div><div id="193" class="line none">  193     struct <a href="../../../verification/cbmc/aws-c-common/include/aws/common/string.h.html#41">aws_string</a> **pub_key_buf,</div><div id="194" class="line none">  194     const struct <a href="cipher.h.html#54">aws_cryptosdk_alg_properties</a> *<a href="../../../source/cipher_openssl.c.html#75">props</a>,</div><div id="195" class="line none">  195     const struct <a href="../../../verification/cbmc/aws-c-common/include/aws/common/string.h.html#41">aws_string</a> *<a href="../../../verification/cbmc/sources/openssl/ec_override.c.html#85">priv_key</a>);</div><div id="196" class="line none">  196 </div><div id="197" class="line none">  197 /**</div><div id="198" class="line none">  198  * Prepares to validate a signature.</div><div id="199" class="line none">  199  * If a non-signing algorithm is used, this function returns successfully, and sets *ctx to NULL.</div><div id="200" class="line none">  200  *</div><div id="201" class="line none">  201  * @param ctx a pointer to a variable to receive the context pointer</div><div id="202" class="line none">  202  * @param alloc the allocator to use</div><div id="203" class="line none">  203  * @param pub_key A buffer containing the (base64) public key</div><div id="204" class="line none">  204  * @param props The algorithm properties for the algorithm to use</div><div id="205" class="line none">  205  */</div><div id="206" class="line none">  206 AWS_CRYPTOSDK_API</div><div id="207" class="line none">  207 int <a href="../../../source/cipher_openssl.c.html#723">aws_cryptosdk_sig_verify_start</a>(</div><div id="208" class="line none">  208     struct <a href="cipher.h.html#132">aws_cryptosdk_sig_ctx</a> **<a href="../../../source/cipher_openssl.c.html#78">ctx</a>,</div><div id="209" class="line none">  209     struct <a href="../../../verification/cbmc/aws-c-common/include/aws/common/allocator.h.html#15">aws_allocator</a> *<a href="../../../verification/cbmc/aws-c-common/include/aws/common/array_list.h.html#16">alloc</a>,</div><div id="210" class="line none">  210     const struct <a href="../../../verification/cbmc/aws-c-common/include/aws/common/string.h.html#41">aws_string</a> *pub_key,</div><div id="211" class="line none">  211     const struct <a href="cipher.h.html#54">aws_cryptosdk_alg_properties</a> *<a href="../../../source/cipher_openssl.c.html#75">props</a>);</div><div id="212" class="line none">  212 </div><div id="213" class="line none">  213 /**</div><div id="214" class="line none">  214  * Supplies some data to an ongoing sign or verify operation.</div><div id="215" class="line none">  215  */</div><div id="216" class="line none">  216 AWS_CRYPTOSDK_API</div><div id="217" class="line none">  217 int <a href="../../../source/cipher_openssl.c.html#789">aws_cryptosdk_sig_update</a>(struct <a href="cipher.h.html#132">aws_cryptosdk_sig_ctx</a> *<a href="../../../source/cipher_openssl.c.html#78">ctx</a>, const struct <a href="../../../verification/cbmc/aws-c-common/include/aws/common/byte_buf.h.html#38">aws_byte_cursor</a> buf);</div><div id="218" class="line none">  218 </div><div id="219" class="line none">  219 /**</div><div id="220" class="line none">  220  * Verifies a signature against the data previously passed to aws_cryptosdk_sig_update.</div><div id="221" class="line none">  221  * If successful, this function returns AWS_OP_SUCCESS; if the signature was invalid,</div><div id="222" class="line none">  222  * raises AWS_CRYPTOSDK_ERR_BAD_CIPHERTEXT and returns AWS_OP_ERR.</div><div id="223" class="line none">  223  *</div><div id="224" class="line none">  224  * The context must have been created in verify mode, using aws_cryptosdk_sig_verify_start;</div><div id="225" class="line none">  225  * failing to do so results in undefined behavior.</div><div id="226" class="line none">  226  *</div><div id="227" class="line none">  227  * The context is always freed, regardless of success or failure.</div><div id="228" class="line none">  228  */</div><div id="229" class="line none">  229 AWS_CRYPTOSDK_API</div><div id="230" class="line none">  230 int <a href="../../../source/cipher_openssl.c.html#809">aws_cryptosdk_sig_verify_finish</a>(struct <a href="cipher.h.html#132">aws_cryptosdk_sig_ctx</a> *<a href="../../../source/cipher_openssl.c.html#78">ctx</a>, const struct <a href="../../../verification/cbmc/aws-c-common/include/aws/common/string.h.html#41">aws_string</a> *signature);</div><div id="231" class="line none">  231 </div><div id="232" class="line none">  232 /**</div><div id="233" class="line none">  233  * Generates the final signature based on data previously passed to aws_cryptosdk_sig_update.</div><div id="234" class="line none">  234  * The signature buffer will be allocated using 'alloc'.</div><div id="235" class="line none">  235  *</div><div id="236" class="line none">  236  * The context must have been created in verify mode, using aws_cryptosdk_sig_sign_start[_keygen];</div><div id="237" class="line none">  237  * failing to do so results in undefined behavior.</div><div id="238" class="line none">  238  *</div><div id="239" class="line none">  239  * The context is always freed, regardless of success or failure.</div><div id="240" class="line none">  240  */</div><div id="241" class="line none">  241 AWS_CRYPTOSDK_API</div><div id="242" class="line none">  242 int <a href="../../../source/cipher_openssl.c.html#819">aws_cryptosdk_sig_sign_finish</a>(</div><div id="243" class="line none">  243     struct <a href="cipher.h.html#132">aws_cryptosdk_sig_ctx</a> *<a href="../../../source/cipher_openssl.c.html#78">ctx</a>, struct <a href="../../../verification/cbmc/aws-c-common/include/aws/common/allocator.h.html#15">aws_allocator</a> *<a href="../../../verification/cbmc/aws-c-common/include/aws/common/array_list.h.html#16">alloc</a>, struct <a href="../../../verification/cbmc/aws-c-common/include/aws/common/string.h.html#41">aws_string</a> **signature);</div><div id="244" class="line none">  244 </div><div id="245" class="line none">  245 /**</div><div id="246" class="line none">  246  * Aborts an ongoing sign or verify operation, and destroys the signature context.</div><div id="247" class="line none">  247  * If ctx is null, this operation is a no-op.</div><div id="248" class="line none">  248  */</div><div id="249" class="line none">  249 AWS_CRYPTOSDK_API</div><div id="250" class="line none">  250 void <a href="../../../source/cipher_openssl.c.html#510">aws_cryptosdk_sig_abort</a>(struct <a href="cipher.h.html#132">aws_cryptosdk_sig_ctx</a> *<a href="../../../source/cipher_openssl.c.html#78">ctx</a>);</div><div id="251" class="line none">  251 </div><div id="252" class="line none">  252 #ifdef __cplusplus</div><div id="253" class="line none">  253 }</div><div id="254" class="line none">  254 #endif</div><div id="255" class="line none">  255 </div><div id="256" class="line none">  256 /*! @} */  // doxygen group hazmat</div><div id="257" class="line none">  257 </div><div id="258" class="line none">  258 #endif  // AWS_CRYPTOSDK_CIPHER_H</div>
</div>
</body>
</html>
