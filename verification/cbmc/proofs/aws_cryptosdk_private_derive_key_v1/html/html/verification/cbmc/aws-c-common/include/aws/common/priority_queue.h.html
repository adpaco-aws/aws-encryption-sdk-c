
<html>
<head>
<title>verification/cbmc/aws-c-common/include/aws/common/priority_queue.h</title>
<link rel="stylesheet" type="text/css" href="../../../../../../viewer.css">
</head>

<body>
<div class="code">
<div id="1" class="line none">    1 #ifndef <a href="priority_queue.h.html#2">AWS_COMMON_PRIORITY_QUEUE_H</a></div><div id="2" class="line none">    2 #define <a href="priority_queue.h.html#2">AWS_COMMON_PRIORITY_QUEUE_H</a></div><div id="3" class="line none">    3 /**</div><div id="4" class="line none">    4  * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.</div><div id="5" class="line none">    5  * SPDX-License-Identifier: Apache-2.0.</div><div id="6" class="line none">    6  */</div><div id="7" class="line none">    7 </div><div id="8" class="line none">    8 #include &lt;aws/common/array_list.h&gt;</div><div id="9" class="line none">    9 #include &lt;aws/common/common.h&gt;</div><div id="10" class="line none">   10 </div><div id="11" class="line none">   11 /* The comparator should return a positive value if the second argument has a</div><div id="12" class="line none">   12  * higher priority than the first; Otherwise, it should return a negative value</div><div id="13" class="line none">   13  * or zero. NOTE: priority_queue pops its highest priority element first. For</div><div id="14" class="line none">   14  * example: int cmp(const void *a, const void *b) { return a &lt; b; } would result</div><div id="15" class="line none">   15  * in a max heap, while: int cmp(const void *a, const void *b) { return a &gt; b; }</div><div id="16" class="line none">   16  * would result in a min heap.</div><div id="17" class="line none">   17  */</div><div id="18" class="line none">   18 typedef int(<a href="priority_queue.h.html#18">aws_priority_queue_compare_fn</a>)(const void *a, const void *b);</div><div id="19" class="line none">   19 </div><div id="20" class="line none">   20 struct <a href="priority_queue.h.html#20">aws_priority_queue</a> {</div><div id="21" class="line none">   21     /**</div><div id="22" class="line none">   22      * predicate that determines the priority of the elements in the queue.</div><div id="23" class="line none">   23      */</div><div id="24" class="line none">   24     <a href="priority_queue.h.html#18">aws_priority_queue_compare_fn</a> *<a href="priority_queue.h.html#24">pred</a>;</div><div id="25" class="line none">   25 </div><div id="26" class="line none">   26     /**</div><div id="27" class="line none">   27      * The underlying container storing the queue elements.</div><div id="28" class="line none">   28      */</div><div id="29" class="line none">   29     struct <a href="array_list.h.html#15">aws_array_list</a> <a href="priority_queue.h.html#29">container</a>;</div><div id="30" class="line none">   30 </div><div id="31" class="line none">   31     /**</div><div id="32" class="line none">   32      * An array of pointers to backpointer elements. This array is initialized when</div><div id="33" class="line none">   33      * the first call to aws_priority_queue_push_bp is made, and is subsequently maintained</div><div id="34" class="line none">   34      * through any heap node manipulations.</div><div id="35" class="line none">   35      *</div><div id="36" class="line none">   36      * Each element is a struct aws_priority_queue_node *, pointing to a backpointer field</div><div id="37" class="line none">   37      * owned by the calling code, or a NULL. The backpointer field is continually updated</div><div id="38" class="line none">   38      * with information needed to locate and remove a specific node later on.</div><div id="39" class="line none">   39      */</div><div id="40" class="line none">   40     struct <a href="array_list.h.html#15">aws_array_list</a> <a href="priority_queue.h.html#40">backpointers</a>;</div><div id="41" class="line none">   41 };</div><div id="42" class="line none">   42 </div><div id="43" class="line none">   43 struct <a href="priority_queue.h.html#43">aws_priority_queue_node</a> {</div><div id="44" class="line none">   44     /** The current index of the node in queuesion, or SIZE_MAX if the node has been removed. */</div><div id="45" class="line none">   45     size_t <a href="priority_queue.h.html#45">current_index</a>;</div><div id="46" class="line none">   46 };</div><div id="47" class="line none">   47 </div><div id="48" class="line none">   48 AWS_EXTERN_C_BEGIN</div><div id="49" class="line none">   49 </div><div id="50" class="line none">   50 /**</div><div id="51" class="line none">   51  * Initializes a priority queue struct for use. This mode will grow memory automatically (exponential model)</div><div id="52" class="line none">   52  * Default size is the inital size of the queue</div><div id="53" class="line none">   53  * item_size is the size of each element in bytes. Mixing items types is not supported by this API.</div><div id="54" class="line none">   54  * pred is the function that will be used to determine priority.</div><div id="55" class="line none">   55  */</div><div id="56" class="line none">   56 AWS_COMMON_API</div><div id="57" class="line none">   57 int aws_priority_queue_init_dynamic(</div><div id="58" class="line none">   58     struct <a href="priority_queue.h.html#20">aws_priority_queue</a> *queue,</div><div id="59" class="line none">   59     struct <a href="allocator.h.html#15">aws_allocator</a> *<a href="array_list.h.html#16">alloc</a>,</div><div id="60" class="line none">   60     size_t default_size,</div><div id="61" class="line none">   61     size_t <a href="array_list.h.html#19">item_size</a>,</div><div id="62" class="line none">   62     <a href="priority_queue.h.html#18">aws_priority_queue_compare_fn</a> *<a href="priority_queue.h.html#24">pred</a>);</div><div id="63" class="line none">   63 </div><div id="64" class="line none">   64 /**</div><div id="65" class="line none">   65  * Initializes a priority queue struct for use. This mode will not allocate any additional memory. When the heap fills</div><div id="66" class="line none">   66  * new enqueue operations will fail with AWS_ERROR_PRIORITY_QUEUE_FULL.</div><div id="67" class="line none">   67  *</div><div id="68" class="line none">   68  * Heaps initialized using this call do not support the aws_priority_queue_push_ref call with a non-NULL backpointer</div><div id="69" class="line none">   69  * parameter.</div><div id="70" class="line none">   70  *</div><div id="71" class="line none">   71  * heap is the raw memory allocated for this priority_queue</div><div id="72" class="line none">   72  * item_count is the maximum number of elements the raw heap can contain</div><div id="73" class="line none">   73  * item_size is the size of each element in bytes. Mixing items types is not supported by this API.</div><div id="74" class="line none">   74  * pred is the function that will be used to determine priority.</div><div id="75" class="line none">   75  */</div><div id="76" class="line none">   76 AWS_COMMON_API</div><div id="77" class="line none">   77 void aws_priority_queue_init_static(</div><div id="78" class="line none">   78     struct <a href="priority_queue.h.html#20">aws_priority_queue</a> *queue,</div><div id="79" class="line none">   79     void *heap,</div><div id="80" class="line none">   80     size_t item_count,</div><div id="81" class="line none">   81     size_t <a href="array_list.h.html#19">item_size</a>,</div><div id="82" class="line none">   82     <a href="priority_queue.h.html#18">aws_priority_queue_compare_fn</a> *<a href="priority_queue.h.html#24">pred</a>);</div><div id="83" class="line none">   83 </div><div id="84" class="line none">   84 /**</div><div id="85" class="line none">   85  * Checks that the backpointer at a specific index of the queue is</div><div id="86" class="line none">   86  * NULL or points to a correctly allocated aws_priority_queue_node.</div><div id="87" class="line none">   87  */</div><div id="88" class="line none">   88 bool aws_priority_queue_backpointer_index_valid(const struct <a href="priority_queue.h.html#20">aws_priority_queue</a> *const queue, size_t <a href="../../../verification/cbmc/include/proof_helpers/utils.h.html#22">index</a>);</div><div id="89" class="line none">   89 </div><div id="90" class="line none">   90 /**</div><div id="91" class="line none">   91  * Checks that the backpointers of the priority queue are either NULL</div><div id="92" class="line none">   92  * or correctly allocated to point at aws_priority_queue_nodes. This</div><div id="93" class="line none">   93  * check is O(n), as it accesses every backpointer in a loop, and thus</div><div id="94" class="line none">   94  * shouldn't be used carelessly.</div><div id="95" class="line none">   95  */</div><div id="96" class="line none">   96 bool aws_priority_queue_backpointers_valid_deep(const struct <a href="priority_queue.h.html#20">aws_priority_queue</a> *const queue);</div><div id="97" class="line none">   97 </div><div id="98" class="line none">   98 /**</div><div id="99" class="line none">   99  * Checks that the backpointers of the priority queue satisfy validity</div><div id="100" class="line none">  100  * constraints.</div><div id="101" class="line none">  101  */</div><div id="102" class="line none">  102 bool aws_priority_queue_backpointers_valid(const struct <a href="priority_queue.h.html#20">aws_priority_queue</a> *const queue);</div><div id="103" class="line none">  103 </div><div id="104" class="line none">  104 /**</div><div id="105" class="line none">  105  * Set of properties of a valid aws_priority_queue.</div><div id="106" class="line none">  106  */</div><div id="107" class="line none">  107 AWS_COMMON_API</div><div id="108" class="line none">  108 bool aws_priority_queue_is_valid(const struct <a href="priority_queue.h.html#20">aws_priority_queue</a> *const queue);</div><div id="109" class="line none">  109 </div><div id="110" class="line none">  110 /**</div><div id="111" class="line none">  111  * Cleans up any internally allocated memory and resets the struct for reuse or deletion.</div><div id="112" class="line none">  112  */</div><div id="113" class="line none">  113 AWS_COMMON_API</div><div id="114" class="line none">  114 void aws_priority_queue_clean_up(struct <a href="priority_queue.h.html#20">aws_priority_queue</a> *queue);</div><div id="115" class="line none">  115 </div><div id="116" class="line none">  116 /**</div><div id="117" class="line none">  117  * Copies item into the queue and places it in the proper priority order. Complexity: O(log(n)).</div><div id="118" class="line none">  118  */</div><div id="119" class="line none">  119 AWS_COMMON_API</div><div id="120" class="line none">  120 int aws_priority_queue_push(struct <a href="priority_queue.h.html#20">aws_priority_queue</a> *queue, void *item);</div><div id="121" class="line none">  121 </div><div id="122" class="line none">  122 /**</div><div id="123" class="line none">  123  * Copies item into the queue and places it in the proper priority order. Complexity: O(log(n)).</div><div id="124" class="line none">  124  *</div><div id="125" class="line none">  125  * If the backpointer parameter is non-null, the heap will continually update the pointed-to field</div><div id="126" class="line none">  126  * with information needed to remove the node later on. *backpointer must remain valid until the node</div><div id="127" class="line none">  127  * is removed from the heap, and may be updated on any mutating operation on the priority queue.</div><div id="128" class="line none">  128  *</div><div id="129" class="line none">  129  * If the node is removed, the backpointer will be set to a sentinel value that indicates that the</div><div id="130" class="line none">  130  * node has already been removed. It is safe (and a no-op) to call aws_priority_queue_remove with</div><div id="131" class="line none">  131  * such a sentinel value.</div><div id="132" class="line none">  132  */</div><div id="133" class="line none">  133 AWS_COMMON_API</div><div id="134" class="line none">  134 int aws_priority_queue_push_ref(</div><div id="135" class="line none">  135     struct <a href="priority_queue.h.html#20">aws_priority_queue</a> *queue,</div><div id="136" class="line none">  136     void *item,</div><div id="137" class="line none">  137     struct <a href="priority_queue.h.html#43">aws_priority_queue_node</a> *backpointer);</div><div id="138" class="line none">  138 </div><div id="139" class="line none">  139 /**</div><div id="140" class="line none">  140  * Copies the element of the highest priority, and removes it from the queue.. Complexity: O(log(n)).</div><div id="141" class="line none">  141  * If queue is empty, AWS_ERROR_PRIORITY_QUEUE_EMPTY will be raised.</div><div id="142" class="line none">  142  */</div><div id="143" class="line none">  143 AWS_COMMON_API</div><div id="144" class="line none">  144 int aws_priority_queue_pop(struct <a href="priority_queue.h.html#20">aws_priority_queue</a> *queue, void *item);</div><div id="145" class="line none">  145 </div><div id="146" class="line none">  146 /**</div><div id="147" class="line none">  147  * Removes a specific node from the priority queue. Complexity: O(log(n))</div><div id="148" class="line none">  148  * After removing a node (using either _remove or _pop), the backpointer set at push_ref time is set</div><div id="149" class="line none">  149  * to a sentinel value. If this sentinel value is passed to aws_priority_queue_remove,</div><div id="150" class="line none">  150  * AWS_ERROR_PRIORITY_QUEUE_BAD_NODE will be raised. Note, however, that passing uninitialized</div><div id="151" class="line none">  151  * aws_priority_queue_nodes, or ones from different priority queues, results in undefined behavior.</div><div id="152" class="line none">  152  */</div><div id="153" class="line none">  153 AWS_COMMON_API</div><div id="154" class="line none">  154 int aws_priority_queue_remove(struct <a href="priority_queue.h.html#20">aws_priority_queue</a> *queue, void *item, const struct <a href="priority_queue.h.html#43">aws_priority_queue_node</a> *node);</div><div id="155" class="line none">  155 </div><div id="156" class="line none">  156 /**</div><div id="157" class="line none">  157  * Obtains a pointer to the element of the highest priority. Complexity: constant time.</div><div id="158" class="line none">  158  * If queue is empty, AWS_ERROR_PRIORITY_QUEUE_EMPTY will be raised.</div><div id="159" class="line none">  159  */</div><div id="160" class="line none">  160 AWS_COMMON_API</div><div id="161" class="line none">  161 int aws_priority_queue_top(const struct <a href="priority_queue.h.html#20">aws_priority_queue</a> *queue, void **item);</div><div id="162" class="line none">  162 </div><div id="163" class="line none">  163 /**</div><div id="164" class="line none">  164  * Current number of elements in the queue</div><div id="165" class="line none">  165  */</div><div id="166" class="line none">  166 AWS_COMMON_API</div><div id="167" class="line none">  167 size_t aws_priority_queue_size(const struct <a href="priority_queue.h.html#20">aws_priority_queue</a> *queue);</div><div id="168" class="line none">  168 </div><div id="169" class="line none">  169 /**</div><div id="170" class="line none">  170  * Current allocated capacity for the queue, in dynamic mode this grows over time, in static mode, this will never</div><div id="171" class="line none">  171  * change.</div><div id="172" class="line none">  172  */</div><div id="173" class="line none">  173 AWS_COMMON_API</div><div id="174" class="line none">  174 size_t aws_priority_queue_capacity(const struct <a href="priority_queue.h.html#20">aws_priority_queue</a> *queue);</div><div id="175" class="line none">  175 </div><div id="176" class="line none">  176 AWS_EXTERN_C_END</div><div id="177" class="line none">  177 </div><div id="178" class="line none">  178 #endif /* AWS_COMMON_PRIORITY_QUEUE_H */</div>
</div>
</body>
</html>
