
<html>
<head>
<title>verification/cbmc/aws-c-common/include/aws/common/byte_order.inl</title>
<link rel="stylesheet" type="text/css" href="../../../../../../viewer.css">
</head>

<body>
<div class="code">
<div id="1" class="line none">    1 #ifndef AWS_COMMON_BYTE_ORDER_INL</div><div id="2" class="line none">    2 #define AWS_COMMON_BYTE_ORDER_INL</div><div id="3" class="line none">    3 </div><div id="4" class="line none">    4 /**</div><div id="5" class="line none">    5  * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.</div><div id="6" class="line none">    6  * SPDX-License-Identifier: Apache-2.0.</div><div id="7" class="line none">    7  */</div><div id="8" class="line none">    8 </div><div id="9" class="line none">    9 #include &lt;aws/common/byte_order.h&gt;</div><div id="10" class="line none">   10 #include &lt;aws/common/common.h&gt;</div><div id="11" class="line none">   11 </div><div id="12" class="line none">   12 #ifdef _MSC_VER</div><div id="13" class="line none">   13 #    include &lt;stdlib.h&gt;</div><div id="14" class="line none">   14 #else</div><div id="15" class="line none">   15 #    include &lt;netinet/in.h&gt;</div><div id="16" class="line none">   16 #endif /* _MSC_VER */</div><div id="17" class="line none">   17 </div><div id="18" class="line none">   18 AWS_EXTERN_C_BEGIN</div><div id="19" class="line none">   19 </div><div id="20" class="line none">   20 /**</div><div id="21" class="line none">   21  * Returns 1 if machine is big endian, 0 if little endian.</div><div id="22" class="line none">   22  * If you compile with even -O1 optimization, this check is completely optimized</div><div id="23" class="line none">   23  * out at compile time and code which calls "if (aws_is_big_endian())" will do</div><div id="24" class="line none">   24  * the right thing without branching.</div><div id="25" class="line none">   25  */</div><div id="26" class="line none">   26 AWS_STATIC_IMPL int <a href="byte_order.inl.html#26">aws_is_big_endian</a>(void) {</div><div id="27" class="line none">   27     const uint16_t z = 0x100;</div><div id="28" class="line none">   28     return *(const uint8_t *)&amp;z;</div><div id="29" class="line none">   29 }</div><div id="30" class="line none">   30 </div><div id="31" class="line none">   31 /**</div><div id="32" class="line none">   32  * Convert 64 bit integer from host to network byte order.</div><div id="33" class="line none">   33  */</div><div id="34" class="line none">   34 AWS_STATIC_IMPL uint64_t <a href="byte_order.inl.html#34">aws_hton64</a>(uint64_t x) {</div><div id="35" class="line none">   35     if (<a href="byte_order.inl.html#26">aws_is_big_endian</a>()) {</div><div id="36" class="line none">   36         return x;</div><div id="37" class="line none">   37     }</div><div id="38" class="line none">   38 #if defined(__x86_64__) &amp;&amp; (defined(__GNUC__) || defined(__clang__)) &amp;&amp; !defined(CBMC)</div><div id="39" class="line none">   39     uint64_t v;</div><div id="40" class="line none">   40     __asm__("bswap %q0" : "=r"(v) : "0"(x));</div><div id="41" class="line none">   41     return v;</div><div id="42" class="line none">   42 #elif defined(_MSC_VER)</div><div id="43" class="line none">   43     return _byteswap_uint64(x);</div><div id="44" class="line none">   44 #else</div><div id="45" class="line none">   45     uint32_t low = x &amp; UINT32_MAX;</div><div id="46" class="line none">   46     uint32_t high = (uint32_t)(x &gt;&gt; 32);</div><div id="47" class="line none">   47     return ((uint64_t)htonl(low)) &lt;&lt; 32 | htonl(high);</div><div id="48" class="line none">   48 #endif</div><div id="49" class="line none">   49 }</div><div id="50" class="line none">   50 </div><div id="51" class="line none">   51 /**</div><div id="52" class="line none">   52  * Convert 64 bit integer from network to host byte order.</div><div id="53" class="line none">   53  */</div><div id="54" class="line none">   54 AWS_STATIC_IMPL uint64_t <a href="byte_order.inl.html#54">aws_ntoh64</a>(uint64_t x) {</div><div id="55" class="line none">   55     return <a href="byte_order.inl.html#34">aws_hton64</a>(x);</div><div id="56" class="line none">   56 }</div><div id="57" class="line none">   57 </div><div id="58" class="line none">   58 /**</div><div id="59" class="line none">   59  * Convert 32 bit integer from host to network byte order.</div><div id="60" class="line none">   60  */</div><div id="61" class="line none">   61 AWS_STATIC_IMPL uint32_t <a href="byte_order.inl.html#61">aws_hton32</a>(uint32_t x) {</div><div id="62" class="line none">   62 #ifdef _MSC_VER</div><div id="63" class="line none">   63     return <a href="byte_order.inl.html#26">aws_is_big_endian</a>() ? x : _byteswap_ulong(x);</div><div id="64" class="line none">   64 #else</div><div id="65" class="line none">   65     return htonl(x);</div><div id="66" class="line none">   66 #endif</div><div id="67" class="line none">   67 }</div><div id="68" class="line none">   68 </div><div id="69" class="line none">   69 /**</div><div id="70" class="line none">   70  * Convert 32 bit float from host to network byte order.</div><div id="71" class="line none">   71  */</div><div id="72" class="line none">   72 AWS_STATIC_IMPL float <a href="byte_order.inl.html#72">aws_htonf32</a>(float x) {</div><div id="73" class="line none">   73     if (<a href="byte_order.inl.html#26">aws_is_big_endian</a>()) {</div><div id="74" class="line none">   74         return x;</div><div id="75" class="line none">   75     }</div><div id="76" class="line none">   76 </div><div id="77" class="line none">   77     uint8_t *f_storage = (uint8_t *)&amp;x;</div><div id="78" class="line none">   78 </div><div id="79" class="line none">   79     float ret_value;</div><div id="80" class="line none">   80     uint8_t *ret_storage = (uint8_t *)&amp;ret_value;</div><div id="81" class="line none">   81 </div><div id="82" class="line none">   82     ret_storage[0] = f_storage[3];</div><div id="83" class="line none">   83     ret_storage[1] = f_storage[2];</div><div id="84" class="line none">   84     ret_storage[2] = f_storage[1];</div><div id="85" class="line none">   85     ret_storage[3] = f_storage[0];</div><div id="86" class="line none">   86 </div><div id="87" class="line none">   87     return ret_value;</div><div id="88" class="line none">   88 }</div><div id="89" class="line none">   89 </div><div id="90" class="line none">   90 /**</div><div id="91" class="line none">   91  * Convert 64 bit double from host to network byte order.</div><div id="92" class="line none">   92  */</div><div id="93" class="line none">   93 AWS_STATIC_IMPL double <a href="byte_order.inl.html#93">aws_htonf64</a>(double x) {</div><div id="94" class="line none">   94     if (<a href="byte_order.inl.html#26">aws_is_big_endian</a>()) {</div><div id="95" class="line none">   95         return x;</div><div id="96" class="line none">   96     }</div><div id="97" class="line none">   97 </div><div id="98" class="line none">   98     uint8_t *f_storage = (uint8_t *)&amp;x;</div><div id="99" class="line none">   99 </div><div id="100" class="line none">  100     double ret_value;</div><div id="101" class="line none">  101     uint8_t *ret_storage = (uint8_t *)&amp;ret_value;</div><div id="102" class="line none">  102 </div><div id="103" class="line none">  103     ret_storage[0] = f_storage[7];</div><div id="104" class="line none">  104     ret_storage[1] = f_storage[6];</div><div id="105" class="line none">  105     ret_storage[2] = f_storage[5];</div><div id="106" class="line none">  106     ret_storage[3] = f_storage[4];</div><div id="107" class="line none">  107     ret_storage[4] = f_storage[3];</div><div id="108" class="line none">  108     ret_storage[5] = f_storage[2];</div><div id="109" class="line none">  109     ret_storage[6] = f_storage[1];</div><div id="110" class="line none">  110     ret_storage[7] = f_storage[0];</div><div id="111" class="line none">  111 </div><div id="112" class="line none">  112     return ret_value;</div><div id="113" class="line none">  113 }</div><div id="114" class="line none">  114 </div><div id="115" class="line none">  115 /**</div><div id="116" class="line none">  116  * Convert 32 bit integer from network to host byte order.</div><div id="117" class="line none">  117  */</div><div id="118" class="line none">  118 AWS_STATIC_IMPL uint32_t <a href="byte_order.inl.html#118">aws_ntoh32</a>(uint32_t x) {</div><div id="119" class="line none">  119 #ifdef _MSC_VER</div><div id="120" class="line none">  120     return <a href="byte_order.inl.html#26">aws_is_big_endian</a>() ? x : _byteswap_ulong(x);</div><div id="121" class="line none">  121 #else</div><div id="122" class="line none">  122     return ntohl(x);</div><div id="123" class="line none">  123 #endif</div><div id="124" class="line none">  124 }</div><div id="125" class="line none">  125 </div><div id="126" class="line none">  126 /**</div><div id="127" class="line none">  127  * Convert 32 bit float from network to host byte order.</div><div id="128" class="line none">  128  */</div><div id="129" class="line none">  129 AWS_STATIC_IMPL float <a href="byte_order.inl.html#129">aws_ntohf32</a>(float x) {</div><div id="130" class="line none">  130     return <a href="byte_order.inl.html#72">aws_htonf32</a>(x);</div><div id="131" class="line none">  131 }</div><div id="132" class="line none">  132 </div><div id="133" class="line none">  133 /**</div><div id="134" class="line none">  134  * Convert 32 bit float from network to host byte order.</div><div id="135" class="line none">  135  */</div><div id="136" class="line none">  136 AWS_STATIC_IMPL double <a href="byte_order.inl.html#136">aws_ntohf64</a>(double x) {</div><div id="137" class="line none">  137     return <a href="byte_order.inl.html#93">aws_htonf64</a>(x);</div><div id="138" class="line none">  138 }</div><div id="139" class="line none">  139 </div><div id="140" class="line none">  140 /**</div><div id="141" class="line none">  141  * Convert 16 bit integer from host to network byte order.</div><div id="142" class="line none">  142  */</div><div id="143" class="line none">  143 AWS_STATIC_IMPL uint16_t <a href="byte_order.inl.html#143">aws_hton16</a>(uint16_t x) {</div><div id="144" class="line none">  144 #ifdef _MSC_VER</div><div id="145" class="line none">  145     return <a href="byte_order.inl.html#26">aws_is_big_endian</a>() ? x : _byteswap_ushort(x);</div><div id="146" class="line none">  146 #else</div><div id="147" class="line none">  147     return htons(x);</div><div id="148" class="line none">  148 #endif</div><div id="149" class="line none">  149 }</div><div id="150" class="line none">  150 </div><div id="151" class="line none">  151 /**</div><div id="152" class="line none">  152  * Convert 16 bit integer from network to host byte order.</div><div id="153" class="line none">  153  */</div><div id="154" class="line none">  154 AWS_STATIC_IMPL uint16_t <a href="byte_order.inl.html#154">aws_ntoh16</a>(uint16_t x) {</div><div id="155" class="line none">  155 #ifdef _MSC_VER</div><div id="156" class="line none">  156     return <a href="byte_order.inl.html#26">aws_is_big_endian</a>() ? x : _byteswap_ushort(x);</div><div id="157" class="line none">  157 #else</div><div id="158" class="line none">  158     return ntohs(x);</div><div id="159" class="line none">  159 #endif</div><div id="160" class="line none">  160 }</div><div id="161" class="line none">  161 </div><div id="162" class="line none">  162 AWS_EXTERN_C_END</div><div id="163" class="line none">  163 </div><div id="164" class="line none">  164 #endif /* AWS_COMMON_BYTE_ORDER_INL */</div>
</div>
</body>
</html>
