
<html>
<head>
<title>verification/cbmc/aws-c-common/include/aws/common/atomics.inl</title>
<link rel="stylesheet" type="text/css" href="../../../../../../viewer.css">
</head>

<body>
<div class="code">
<div id="1" class="line none">    1 #ifndef AWS_COMMON_ATOMICS_INL</div><div id="2" class="line none">    2 #define AWS_COMMON_ATOMICS_INL</div><div id="3" class="line none">    3 </div><div id="4" class="line none">    4 /**</div><div id="5" class="line none">    5  * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.</div><div id="6" class="line none">    6  * SPDX-License-Identifier: Apache-2.0.</div><div id="7" class="line none">    7  */</div><div id="8" class="line none">    8 </div><div id="9" class="line none">    9 #include &lt;aws/common/atomics.h&gt;</div><div id="10" class="line none">   10 #include &lt;aws/common/common.h&gt;</div><div id="11" class="line none">   11 </div><div id="12" class="line none">   12 AWS_EXTERN_C_BEGIN</div><div id="13" class="line none">   13 </div><div id="14" class="line none">   14 /**</div><div id="15" class="line none">   15  * Reads an atomic var as an integer, using sequentially consistent ordering, and returns the result.</div><div id="16" class="line none">   16  */</div><div id="17" class="line none">   17 AWS_STATIC_IMPL</div><div id="18" class="line none">   18 size_t <a href="atomics.inl.html#18">aws_atomic_load_int</a>(volatile const struct <a href="atomics.h.html#16">aws_atomic_var</a> *var) {</div><div id="19" class="line none">   19     return <a href="atomics_gnu.inl.html#67">aws_atomic_load_int_explicit</a>(var, <a href="atomics.h.html#74">aws_memory_order_seq_cst</a>);</div><div id="20" class="line none">   20 }</div><div id="21" class="line none">   21 </div><div id="22" class="line none">   22 /**</div><div id="23" class="line none">   23  * Reads an atomic var as a pointer, using sequentially consistent ordering, and returns the result.</div><div id="24" class="line none">   24  */</div><div id="25" class="line none">   25 AWS_STATIC_IMPL</div><div id="26" class="line none">   26 void *<a href="atomics.inl.html#26">aws_atomic_load_ptr</a>(volatile const struct <a href="atomics.h.html#16">aws_atomic_var</a> *var) {</div><div id="27" class="line none">   27     return <a href="atomics_gnu.inl.html#75">aws_atomic_load_ptr_explicit</a>(var, <a href="atomics.h.html#74">aws_memory_order_seq_cst</a>);</div><div id="28" class="line none">   28 }</div><div id="29" class="line none">   29 </div><div id="30" class="line none">   30 /**</div><div id="31" class="line none">   31  * Stores an integer into an atomic var, using sequentially consistent ordering.</div><div id="32" class="line none">   32  */</div><div id="33" class="line none">   33 AWS_STATIC_IMPL</div><div id="34" class="line none">   34 void <a href="atomics.inl.html#34">aws_atomic_store_int</a>(volatile struct <a href="atomics.h.html#16">aws_atomic_var</a> *var, size_t n) {</div><div id="35" class="line none">   35     <a href="atomics_gnu.inl.html#83">aws_atomic_store_int_explicit</a>(var, n, <a href="atomics.h.html#74">aws_memory_order_seq_cst</a>);</div><div id="36" class="line none">   36 }</div><div id="37" class="line none">   37 </div><div id="38" class="line none">   38 /**</div><div id="39" class="line none">   39  * Stores a pointer into an atomic var, using sequentially consistent ordering.</div><div id="40" class="line none">   40  */</div><div id="41" class="line none">   41 AWS_STATIC_IMPL</div><div id="42" class="line none">   42 void <a href="atomics.inl.html#42">aws_atomic_store_ptr</a>(volatile struct <a href="atomics.h.html#16">aws_atomic_var</a> *var, void *p) {</div><div id="43" class="line none">   43     <a href="atomics_gnu.inl.html#91">aws_atomic_store_ptr_explicit</a>(var, p, <a href="atomics.h.html#74">aws_memory_order_seq_cst</a>);</div><div id="44" class="line none">   44 }</div><div id="45" class="line none">   45 </div><div id="46" class="line none">   46 /**</div><div id="47" class="line none">   47  * Exchanges an integer with the value in an atomic_var, using sequentially consistent ordering.</div><div id="48" class="line none">   48  * Returns the value that was previously in the atomic_var.</div><div id="49" class="line none">   49  */</div><div id="50" class="line none">   50 AWS_STATIC_IMPL</div><div id="51" class="line none">   51 size_t <a href="atomics.inl.html#51">aws_atomic_exchange_int</a>(volatile struct <a href="atomics.h.html#16">aws_atomic_var</a> *var, size_t n) {</div><div id="52" class="line none">   52     return <a href="atomics_gnu.inl.html#100">aws_atomic_exchange_int_explicit</a>(var, n, <a href="atomics.h.html#74">aws_memory_order_seq_cst</a>);</div><div id="53" class="line none">   53 }</div><div id="54" class="line none">   54 </div><div id="55" class="line none">   55 /**</div><div id="56" class="line none">   56  * Exchanges an integer with the value in an atomic_var, using sequentially consistent ordering.</div><div id="57" class="line none">   57  * Returns the value that was previously in the atomic_var.</div><div id="58" class="line none">   58  */</div><div id="59" class="line none">   59 AWS_STATIC_IMPL</div><div id="60" class="line none">   60 void *<a href="atomics.inl.html#60">aws_atomic_exchange_ptr</a>(volatile struct <a href="atomics.h.html#16">aws_atomic_var</a> *var, void *p) {</div><div id="61" class="line none">   61     return <a href="atomics_gnu.inl.html#112">aws_atomic_exchange_ptr_explicit</a>(var, p, <a href="atomics.h.html#74">aws_memory_order_seq_cst</a>);</div><div id="62" class="line none">   62 }</div><div id="63" class="line none">   63 </div><div id="64" class="line none">   64 /**</div><div id="65" class="line none">   65  * Atomically compares *var to *expected; if they are equal, atomically sets *var = desired. Otherwise, *expected is set</div><div id="66" class="line none">   66  * to the value in *var. Uses sequentially consistent memory ordering, regardless of success or failure.</div><div id="67" class="line none">   67  * Returns true if the compare was successful and the variable updated to desired.</div><div id="68" class="line none">   68  */</div><div id="69" class="line none">   69 AWS_STATIC_IMPL</div><div id="70" class="line none">   70 bool <a href="atomics.inl.html#70">aws_atomic_compare_exchange_int</a>(volatile struct <a href="atomics.h.html#16">aws_atomic_var</a> *var, size_t *expected, size_t desired) {</div><div id="71" class="line none">   71     return <a href="atomics_gnu.inl.html#125">aws_atomic_compare_exchange_int_explicit</a>(</div><div id="72" class="line none">   72         var, expected, desired, <a href="atomics.h.html#74">aws_memory_order_seq_cst</a>, <a href="atomics.h.html#74">aws_memory_order_seq_cst</a>);</div><div id="73" class="line none">   73 }</div><div id="74" class="line none">   74 </div><div id="75" class="line none">   75 /**</div><div id="76" class="line none">   76  * Atomically compares *var to *expected; if they are equal, atomically sets *var = desired. Otherwise, *expected is set</div><div id="77" class="line none">   77  * to the value in *var. Uses sequentially consistent memory ordering, regardless of success or failure.</div><div id="78" class="line none">   78  * Returns true if the compare was successful and the variable updated to desired.</div><div id="79" class="line none">   79  */</div><div id="80" class="line none">   80 AWS_STATIC_IMPL</div><div id="81" class="line none">   81 bool <a href="atomics.inl.html#81">aws_atomic_compare_exchange_ptr</a>(volatile struct <a href="atomics.h.html#16">aws_atomic_var</a> *var, void **expected, void *desired) {</div><div id="82" class="line none">   82     return <a href="atomics_gnu.inl.html#146">aws_atomic_compare_exchange_ptr_explicit</a>(</div><div id="83" class="line none">   83         var, expected, desired, <a href="atomics.h.html#74">aws_memory_order_seq_cst</a>, <a href="atomics.h.html#74">aws_memory_order_seq_cst</a>);</div><div id="84" class="line none">   84 }</div><div id="85" class="line none">   85 </div><div id="86" class="line none">   86 /**</div><div id="87" class="line none">   87  * Atomically adds n to *var, and returns the previous value of *var.</div><div id="88" class="line none">   88  * Uses sequentially consistent ordering.</div><div id="89" class="line none">   89  */</div><div id="90" class="line none">   90 AWS_STATIC_IMPL</div><div id="91" class="line none">   91 size_t <a href="atomics.inl.html#91">aws_atomic_fetch_add</a>(volatile struct <a href="atomics.h.html#16">aws_atomic_var</a> *var, size_t n) {</div><div id="92" class="line none">   92     return <a href="atomics_gnu.inl.html#165">aws_atomic_fetch_add_explicit</a>(var, n, <a href="atomics.h.html#74">aws_memory_order_seq_cst</a>);</div><div id="93" class="line none">   93 }</div><div id="94" class="line none">   94 </div><div id="95" class="line none">   95 /**</div><div id="96" class="line none">   96  * Atomically subtracts n from *var, and returns the previous value of *var.</div><div id="97" class="line none">   97  * Uses sequentially consistent ordering.</div><div id="98" class="line none">   98  */</div><div id="99" class="line none">   99 AWS_STATIC_IMPL</div><div id="100" class="line none">  100 size_t <a href="atomics.inl.html#100">aws_atomic_fetch_sub</a>(volatile struct <a href="atomics.h.html#16">aws_atomic_var</a> *var, size_t n) {</div><div id="101" class="line none">  101     return <a href="atomics_gnu.inl.html#173">aws_atomic_fetch_sub_explicit</a>(var, n, <a href="atomics.h.html#74">aws_memory_order_seq_cst</a>);</div><div id="102" class="line none">  102 }</div><div id="103" class="line none">  103 </div><div id="104" class="line none">  104 /**</div><div id="105" class="line none">  105  * Atomically ands n into *var, and returns the previous value of *var.</div><div id="106" class="line none">  106  * Uses sequentially consistent ordering.</div><div id="107" class="line none">  107  */</div><div id="108" class="line none">  108 AWS_STATIC_IMPL</div><div id="109" class="line none">  109 size_t <a href="atomics.inl.html#109">aws_atomic_fetch_and</a>(volatile struct <a href="atomics.h.html#16">aws_atomic_var</a> *var, size_t n) {</div><div id="110" class="line none">  110     return <a href="atomics_gnu.inl.html#189">aws_atomic_fetch_and_explicit</a>(var, n, <a href="atomics.h.html#74">aws_memory_order_seq_cst</a>);</div><div id="111" class="line none">  111 }</div><div id="112" class="line none">  112 </div><div id="113" class="line none">  113 /**</div><div id="114" class="line none">  114  * Atomically ors n into *var, and returns the previous value of *var.</div><div id="115" class="line none">  115  * Uses sequentially consistent ordering.</div><div id="116" class="line none">  116  */</div><div id="117" class="line none">  117 AWS_STATIC_IMPL</div><div id="118" class="line none">  118 size_t <a href="atomics.inl.html#118">aws_atomic_fetch_or</a>(volatile struct <a href="atomics.h.html#16">aws_atomic_var</a> *var, size_t n) {</div><div id="119" class="line none">  119     return <a href="atomics_gnu.inl.html#181">aws_atomic_fetch_or_explicit</a>(var, n, <a href="atomics.h.html#74">aws_memory_order_seq_cst</a>);</div><div id="120" class="line none">  120 }</div><div id="121" class="line none">  121 </div><div id="122" class="line none">  122 /**</div><div id="123" class="line none">  123  * Atomically xors n into *var, and returns the previous value of *var.</div><div id="124" class="line none">  124  * Uses sequentially consistent ordering.</div><div id="125" class="line none">  125  */</div><div id="126" class="line none">  126 AWS_STATIC_IMPL</div><div id="127" class="line none">  127 size_t <a href="atomics.inl.html#127">aws_atomic_fetch_xor</a>(volatile struct <a href="atomics.h.html#16">aws_atomic_var</a> *var, size_t n) {</div><div id="128" class="line none">  128     return <a href="atomics_gnu.inl.html#197">aws_atomic_fetch_xor_explicit</a>(var, n, <a href="atomics.h.html#74">aws_memory_order_seq_cst</a>);</div><div id="129" class="line none">  129 }</div><div id="130" class="line none">  130 </div><div id="131" class="line none">  131 /* Include the backend implementation now, because we'll use its typedefs and #defines below */</div><div id="132" class="line none">  132 #if defined(__GNUC__) || defined(__clang__)</div><div id="133" class="line none">  133 #    if defined(__ATOMIC_RELAXED)</div><div id="134" class="line none">  134 #        include &lt;aws/common/atomics_gnu.inl&gt;</div><div id="135" class="line none">  135 #    else</div><div id="136" class="line none">  136 #        include &lt;aws/common/atomics_gnu_old.inl&gt;</div><div id="137" class="line none">  137 #    endif /* __ATOMIC_RELAXED */</div><div id="138" class="line none">  138 #elif defined(_MSC_VER)</div><div id="139" class="line none">  139 #    include &lt;aws/common/atomics_msvc.inl&gt;</div><div id="140" class="line none">  140 #else</div><div id="141" class="line none">  141 #    error No atomics implementation for your compiler is available</div><div id="142" class="line none">  142 #endif</div><div id="143" class="line none">  143 </div><div id="144" class="line none">  144 #include &lt;aws/common/atomics_fallback.inl&gt;</div><div id="145" class="line none">  145 </div><div id="146" class="line none">  146 AWS_EXTERN_C_END</div><div id="147" class="line none">  147 </div><div id="148" class="line none">  148 #endif /* AWS_COMMON_ATOMICS_INL */</div>
</div>
</body>
</html>
