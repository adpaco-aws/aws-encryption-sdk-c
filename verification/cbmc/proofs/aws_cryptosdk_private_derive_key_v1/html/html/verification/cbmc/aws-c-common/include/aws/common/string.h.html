
<html>
<head>
<title>verification/cbmc/aws-c-common/include/aws/common/string.h</title>
<link rel="stylesheet" type="text/css" href="../../../../../../viewer.css">
</head>

<body>
<div class="code">
<div id="1" class="line none">    1 #ifndef <a href="string.h.html#2">AWS_COMMON_STRING_H</a></div><div id="2" class="line none">    2 #define <a href="string.h.html#2">AWS_COMMON_STRING_H</a></div><div id="3" class="line none">    3 /**</div><div id="4" class="line none">    4  * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.</div><div id="5" class="line none">    5  * SPDX-License-Identifier: Apache-2.0.</div><div id="6" class="line none">    6  */</div><div id="7" class="line none">    7 #include &lt;aws/common/byte_buf.h&gt;</div><div id="8" class="line none">    8 #include &lt;aws/common/common.h&gt;</div><div id="9" class="line none">    9 </div><div id="10" class="line none">   10 /**</div><div id="11" class="line none">   11  * Represents an immutable string holding either text or binary data. If the</div><div id="12" class="line none">   12  * string is in constant memory or memory that should otherwise not be freed by</div><div id="13" class="line none">   13  * this struct, set allocator to NULL and destroy function will be a no-op.</div><div id="14" class="line none">   14  *</div><div id="15" class="line none">   15  * This is for use cases where the entire struct and the data bytes themselves</div><div id="16" class="line none">   16  * need to be held in dynamic memory, such as when held by a struct</div><div id="17" class="line none">   17  * aws_hash_table. The data bytes themselves are always held in contiguous</div><div id="18" class="line none">   18  * memory immediately after the end of the struct aws_string, and the memory for</div><div id="19" class="line none">   19  * both the header and the data bytes is allocated together.</div><div id="20" class="line none">   20  *</div><div id="21" class="line none">   21  * Use the aws_string_bytes function to access the data bytes. A null byte is</div><div id="22" class="line none">   22  * always included immediately after the data but not counted in the length, so</div><div id="23" class="line none">   23  * that the output of aws_string_bytes can be treated as a C-string in cases</div><div id="24" class="line none">   24  * where none of the the data bytes are null.</div><div id="25" class="line none">   25  *</div><div id="26" class="line none">   26  * Note that the fields of this structure are const; this ensures not only that</div><div id="27" class="line none">   27  * they cannot be modified, but also that you can't assign the structure using</div><div id="28" class="line none">   28  * the = operator accidentally.</div><div id="29" class="line none">   29  */</div><div id="30" class="line none">   30 </div><div id="31" class="line none">   31 /* Using a flexible array member is the C99 compliant way to have the bytes of</div><div id="32" class="line none">   32  * the string immediately follow the header.</div><div id="33" class="line none">   33  *</div><div id="34" class="line none">   34  * MSVC doesn't know this for some reason so we need to use a pragma to make</div><div id="35" class="line none">   35  * it happy.</div><div id="36" class="line none">   36  */</div><div id="37" class="line none">   37 #ifdef _MSC_VER</div><div id="38" class="line none">   38 #    pragma warning(push)</div><div id="39" class="line none">   39 #    pragma warning(disable : 4200)</div><div id="40" class="line none">   40 #endif</div><div id="41" class="line none">   41 struct <a href="string.h.html#41">aws_string</a> {</div><div id="42" class="line none">   42     struct <a href="allocator.h.html#15">aws_allocator</a> *const <a href="ring_buffer.h.html#19">allocator</a>;</div><div id="43" class="line none">   43     const size_t <a href="byte_buf.h.html#27">len</a>;</div><div id="44" class="line none">   44     /* give this a storage specifier for C++ purposes. It will likely be larger after init. */</div><div id="45" class="line none">   45     const uint8_t <a href="string.h.html#45">bytes</a>[1];</div><div id="46" class="line none">   46 };</div><div id="47" class="line none">   47 #ifdef _MSC_VER</div><div id="48" class="line none">   48 #    pragma warning(pop)</div><div id="49" class="line none">   49 #endif</div><div id="50" class="line none">   50 </div><div id="51" class="line none">   51 AWS_EXTERN_C_BEGIN</div><div id="52" class="line none">   52 </div><div id="53" class="line none">   53 /**</div><div id="54" class="line none">   54  * Returns true if bytes of string are the same, false otherwise.</div><div id="55" class="line none">   55  */</div><div id="56" class="line none">   56 AWS_COMMON_API</div><div id="57" class="line none">   57 bool aws_string_eq(const struct <a href="string.h.html#41">aws_string</a> *a, const struct <a href="string.h.html#41">aws_string</a> *b);</div><div id="58" class="line none">   58 </div><div id="59" class="line none">   59 /**</div><div id="60" class="line none">   60  * Returns true if bytes of string are equivalent, using a case-insensitive comparison.</div><div id="61" class="line none">   61  */</div><div id="62" class="line none">   62 AWS_COMMON_API</div><div id="63" class="line none">   63 bool aws_string_eq_ignore_case(const struct <a href="string.h.html#41">aws_string</a> *a, const struct <a href="string.h.html#41">aws_string</a> *b);</div><div id="64" class="line none">   64 </div><div id="65" class="line none">   65 /**</div><div id="66" class="line none">   66  * Returns true if bytes of string and cursor are the same, false otherwise.</div><div id="67" class="line none">   67  */</div><div id="68" class="line none">   68 AWS_COMMON_API</div><div id="69" class="line none">   69 bool aws_string_eq_byte_cursor(const struct <a href="string.h.html#41">aws_string</a> *str, const struct <a href="byte_buf.h.html#38">aws_byte_cursor</a> *cur);</div><div id="70" class="line none">   70 </div><div id="71" class="line none">   71 /**</div><div id="72" class="line none">   72  * Returns true if bytes of string and cursor are equivalent, using a case-insensitive comparison.</div><div id="73" class="line none">   73  */</div><div id="74" class="line none">   74 AWS_COMMON_API</div><div id="75" class="line none">   75 bool aws_string_eq_byte_cursor_ignore_case(const struct <a href="string.h.html#41">aws_string</a> *str, const struct <a href="byte_buf.h.html#38">aws_byte_cursor</a> *cur);</div><div id="76" class="line none">   76 </div><div id="77" class="line none">   77 /**</div><div id="78" class="line none">   78  * Returns true if bytes of string and buffer are the same, false otherwise.</div><div id="79" class="line none">   79  */</div><div id="80" class="line none">   80 AWS_COMMON_API</div><div id="81" class="line none">   81 bool aws_string_eq_byte_buf(const struct <a href="string.h.html#41">aws_string</a> *str, const struct <a href="byte_buf.h.html#25">aws_byte_buf</a> *buf);</div><div id="82" class="line none">   82 </div><div id="83" class="line none">   83 /**</div><div id="84" class="line none">   84  * Returns true if bytes of string and buffer are equivalent, using a case-insensitive comparison.</div><div id="85" class="line none">   85  */</div><div id="86" class="line none">   86 AWS_COMMON_API</div><div id="87" class="line none">   87 bool aws_string_eq_byte_buf_ignore_case(const struct <a href="string.h.html#41">aws_string</a> *str, const struct <a href="byte_buf.h.html#25">aws_byte_buf</a> *buf);</div><div id="88" class="line none">   88 </div><div id="89" class="line none">   89 AWS_COMMON_API</div><div id="90" class="line none">   90 bool aws_string_eq_c_str(const struct <a href="string.h.html#41">aws_string</a> *str, const char *c_str);</div><div id="91" class="line none">   91 </div><div id="92" class="line none">   92 /**</div><div id="93" class="line none">   93  * Returns true if bytes of strings are equivalent, using a case-insensitive comparison.</div><div id="94" class="line none">   94  */</div><div id="95" class="line none">   95 AWS_COMMON_API</div><div id="96" class="line none">   96 bool aws_string_eq_c_str_ignore_case(const struct <a href="string.h.html#41">aws_string</a> *str, const char *c_str);</div><div id="97" class="line none">   97 </div><div id="98" class="line none">   98 /**</div><div id="99" class="line none">   99  * Constructor functions which copy data from null-terminated C-string or array of bytes.</div><div id="100" class="line none">  100  */</div><div id="101" class="line none">  101 AWS_COMMON_API</div><div id="102" class="line none">  102 struct <a href="string.h.html#41">aws_string</a> *aws_string_new_from_c_str(struct <a href="allocator.h.html#15">aws_allocator</a> *<a href="ring_buffer.h.html#19">allocator</a>, const char *c_str);</div><div id="103" class="line none">  103 </div><div id="104" class="line none">  104 /**</div><div id="105" class="line none">  105  * Allocate a new string with the same contents as array.</div><div id="106" class="line none">  106  */</div><div id="107" class="line none">  107 AWS_COMMON_API</div><div id="108" class="line none">  108 struct <a href="string.h.html#41">aws_string</a> *<a href="string.h.html#108">aws_string_new_from_array</a>(struct <a href="allocator.h.html#15">aws_allocator</a> *<a href="ring_buffer.h.html#19">allocator</a>, const uint8_t *<a href="string.h.html#45">bytes</a>, size_t <a href="byte_buf.h.html#27">len</a>);</div><div id="109" class="line none">  109 </div><div id="110" class="line none">  110 /**</div><div id="111" class="line none">  111  * Allocate a new string with the same contents as another string.</div><div id="112" class="line none">  112  */</div><div id="113" class="line none">  113 AWS_COMMON_API</div><div id="114" class="line none">  114 struct <a href="string.h.html#41">aws_string</a> *aws_string_new_from_string(struct <a href="allocator.h.html#15">aws_allocator</a> *<a href="ring_buffer.h.html#19">allocator</a>, const struct <a href="string.h.html#41">aws_string</a> *str);</div><div id="115" class="line none">  115 </div><div id="116" class="line none">  116 /**</div><div id="117" class="line none">  117  * Allocate a new string with the same contents as cursor.</div><div id="118" class="line none">  118  */</div><div id="119" class="line none">  119 AWS_COMMON_API</div><div id="120" class="line none">  120 struct <a href="string.h.html#41">aws_string</a> *aws_string_new_from_cursor(struct <a href="allocator.h.html#15">aws_allocator</a> *<a href="ring_buffer.h.html#19">allocator</a>, const struct <a href="byte_buf.h.html#38">aws_byte_cursor</a> *cursor);</div><div id="121" class="line none">  121 </div><div id="122" class="line none">  122 /**</div><div id="123" class="line none">  123  * Allocate a new string with the same contents as buf.</div><div id="124" class="line none">  124  */</div><div id="125" class="line none">  125 AWS_COMMON_API</div><div id="126" class="line none">  126 struct <a href="string.h.html#41">aws_string</a> *aws_string_new_from_buf(struct <a href="allocator.h.html#15">aws_allocator</a> *<a href="ring_buffer.h.html#19">allocator</a>, const struct <a href="byte_buf.h.html#25">aws_byte_buf</a> *buf);</div><div id="127" class="line none">  127 </div><div id="128" class="line none">  128 /**</div><div id="129" class="line none">  129  * Deallocate string.</div><div id="130" class="line none">  130  */</div><div id="131" class="line none">  131 AWS_COMMON_API</div><div id="132" class="line none">  132 void <a href="string.h.html#132">aws_string_destroy</a>(struct <a href="string.h.html#41">aws_string</a> *str);</div><div id="133" class="line none">  133 </div><div id="134" class="line none">  134 /**</div><div id="135" class="line none">  135  * Zeroes out the data bytes of string and then deallocates the memory.</div><div id="136" class="line none">  136  * Not safe to run on a string created with AWS_STATIC_STRING_FROM_LITERAL.</div><div id="137" class="line none">  137  */</div><div id="138" class="line none">  138 AWS_COMMON_API</div><div id="139" class="line none">  139 void aws_string_destroy_secure(struct <a href="string.h.html#41">aws_string</a> *str);</div><div id="140" class="line none">  140 </div><div id="141" class="line none">  141 /**</div><div id="142" class="line none">  142  * Compares lexicographical ordering of two strings. This is a binary</div><div id="143" class="line none">  143  * byte-by-byte comparison, treating bytes as unsigned integers. It is suitable</div><div id="144" class="line none">  144  * for either textual or binary data and is unaware of unicode or any other byte</div><div id="145" class="line none">  145  * encoding. If both strings are identical in the bytes of the shorter string,</div><div id="146" class="line none">  146  * then the longer string is lexicographically after the shorter.</div><div id="147" class="line none">  147  *</div><div id="148" class="line none">  148  * Returns a positive number if string a &gt; string b. (i.e., string a is</div><div id="149" class="line none">  149  * lexicographically after string b.) Returns zero if string a = string b.</div><div id="150" class="line none">  150  * Returns negative number if string a &lt; string b.</div><div id="151" class="line none">  151  */</div><div id="152" class="line none">  152 AWS_COMMON_API</div><div id="153" class="line none">  153 int aws_string_compare(const struct <a href="string.h.html#41">aws_string</a> *a, const struct <a href="string.h.html#41">aws_string</a> *b);</div><div id="154" class="line none">  154 </div><div id="155" class="line none">  155 /**</div><div id="156" class="line none">  156  * A convenience function for sorting lists of (const struct aws_string *) elements. This can be used as a</div><div id="157" class="line none">  157  * comparator for aws_array_list_sort. It is just a simple wrapper around aws_string_compare.</div><div id="158" class="line none">  158  */</div><div id="159" class="line none">  159 AWS_COMMON_API</div><div id="160" class="line none">  160 int aws_array_list_comparator_string(const void *a, const void *b);</div><div id="161" class="line none">  161 </div><div id="162" class="line none">  162 /**</div><div id="163" class="line none">  163  * Defines a (static const struct aws_string *) with name specified in first</div><div id="164" class="line none">  164  * argument that points to constant memory and has data bytes containing the</div><div id="165" class="line none">  165  * string literal in the second argument.</div><div id="166" class="line none">  166  *</div><div id="167" class="line none">  167  * GCC allows direct initilization of structs with variable length final fields</div><div id="168" class="line none">  168  * However, this might not be portable, so we can do this instead</div><div id="169" class="line none">  169  * This will have to be updated whenever the aws_string structure changes</div><div id="170" class="line none">  170  */</div><div id="171" class="line none">  171 #define <a href="string.h.html#171">AWS_STATIC_STRING_FROM_LITERAL</a>(<a href="../../../../../../include/aws/cryptosdk/materials.h.html#377">name</a>, literal)                                                                  \</div><div id="172" class="line none">  172     static const struct {                                                                                              \</div><div id="173" class="line none">  173         struct <a href="allocator.h.html#15">aws_allocator</a> *const <a href="ring_buffer.h.html#19">allocator</a>;                                                                         \</div><div id="174" class="line none">  174         const size_t <a href="byte_buf.h.html#27">len</a>;                                                                                              \</div><div id="175" class="line none">  175         const uint8_t <a href="string.h.html#45">bytes</a>[sizeof(literal)];                                                                          \</div><div id="176" class="line none">  176     } <a href="../../../../../../include/aws/cryptosdk/materials.h.html#377">name</a>##_s = {NULL, sizeof(literal) - 1, literal};                                                                 \</div><div id="177" class="line none">  177     static const struct <a href="string.h.html#41">aws_string</a> *(<a href="../../../../../../include/aws/cryptosdk/materials.h.html#377">name</a>) = (struct <a href="string.h.html#41">aws_string</a> *)(&amp;<a href="../../../../../../include/aws/cryptosdk/materials.h.html#377">name</a>##_s)</div><div id="178" class="line none">  178 </div><div id="179" class="line none">  179 /*</div><div id="180" class="line none">  180  * A related macro that declares the string pointer without static, allowing it to be externed as a global constant</div><div id="181" class="line none">  181  */</div><div id="182" class="line none">  182 #define <a href="string.h.html#182">AWS_STRING_FROM_LITERAL</a>(<a href="../../../../../../include/aws/cryptosdk/materials.h.html#377">name</a>, literal)                                                                         \</div><div id="183" class="line none">  183     static const struct {                                                                                              \</div><div id="184" class="line none">  184         struct <a href="allocator.h.html#15">aws_allocator</a> *const <a href="ring_buffer.h.html#19">allocator</a>;                                                                         \</div><div id="185" class="line none">  185         const size_t <a href="byte_buf.h.html#27">len</a>;                                                                                              \</div><div id="186" class="line none">  186         const uint8_t <a href="string.h.html#45">bytes</a>[sizeof(literal)];                                                                          \</div><div id="187" class="line none">  187     } <a href="../../../../../../include/aws/cryptosdk/materials.h.html#377">name</a>##_s = {NULL, sizeof(literal) - 1, literal};                                                                 \</div><div id="188" class="line none">  188     const struct <a href="string.h.html#41">aws_string</a> *(<a href="../../../../../../include/aws/cryptosdk/materials.h.html#377">name</a>) = (struct <a href="string.h.html#41">aws_string</a> *)(&amp;<a href="../../../../../../include/aws/cryptosdk/materials.h.html#377">name</a>##_s)</div><div id="189" class="line none">  189 </div><div id="190" class="line none">  190 /**</div><div id="191" class="line none">  191  * Copies all bytes from string to buf.</div><div id="192" class="line none">  192  *</div><div id="193" class="line none">  193  * On success, returns true and updates the buf pointer/length</div><div id="194" class="line none">  194  * accordingly. If there is insufficient space in the buf, returns</div><div id="195" class="line none">  195  * false, leaving the buf unchanged.</div><div id="196" class="line none">  196  */</div><div id="197" class="line none">  197 AWS_COMMON_API</div><div id="198" class="line none">  198 bool aws_byte_buf_write_from_whole_string(</div><div id="199" class="line none">  199     struct <a href="byte_buf.h.html#25">aws_byte_buf</a> *AWS_RESTRICT buf,</div><div id="200" class="line none">  200     const struct <a href="string.h.html#41">aws_string</a> *AWS_RESTRICT src);</div><div id="201" class="line none">  201 </div><div id="202" class="line none">  202 /**</div><div id="203" class="line none">  203  * Creates an aws_byte_cursor from an existing string.</div><div id="204" class="line none">  204  */</div><div id="205" class="line none">  205 AWS_COMMON_API</div><div id="206" class="line none">  206 struct <a href="byte_buf.h.html#38">aws_byte_cursor</a> <a href="string.h.html#206">aws_byte_cursor_from_string</a>(const struct <a href="string.h.html#41">aws_string</a> *src);</div><div id="207" class="line none">  207 </div><div id="208" class="line none">  208 /**</div><div id="209" class="line none">  209  * If the string was dynamically allocated, clones it. If the string was statically allocated (i.e. has no allocator),</div><div id="210" class="line none">  210  * returns the original string.</div><div id="211" class="line none">  211  */</div><div id="212" class="line none">  212 AWS_COMMON_API</div><div id="213" class="line none">  213 struct <a href="string.h.html#41">aws_string</a> *aws_string_clone_or_reuse(struct <a href="allocator.h.html#15">aws_allocator</a> *<a href="ring_buffer.h.html#19">allocator</a>, const struct <a href="string.h.html#41">aws_string</a> *str);</div><div id="214" class="line none">  214 </div><div id="215" class="line none">  215 /* Computes the length of a c string in bytes assuming the character set is either ASCII or UTF-8. If no NULL character</div><div id="216" class="line none">  216  * is found within max_read_len of str, AWS_ERROR_C_STRING_BUFFER_NOT_NULL_TERMINATED is raised. Otherwise, str_len</div><div id="217" class="line none">  217  * will contain the string length minus the NULL character, and AWS_OP_SUCCESS will be returned. */</div><div id="218" class="line none">  218 AWS_COMMON_API</div><div id="219" class="line none">  219 int aws_secure_strlen(const char *str, size_t max_read_len, size_t *str_len);</div><div id="220" class="line none">  220 </div><div id="221" class="line none">  221 /**</div><div id="222" class="line none">  222  * Equivalent to str-&gt;bytes.</div><div id="223" class="line none">  223  */</div><div id="224" class="line none">  224 AWS_STATIC_IMPL</div><div id="225" class="line none">  225 const uint8_t *<a href="string.inl.html#15">aws_string_bytes</a>(const struct <a href="string.h.html#41">aws_string</a> *str);</div><div id="226" class="line none">  226 </div><div id="227" class="line none">  227 /**</div><div id="228" class="line none">  228  * Equivalent to `(const char *)str-&gt;bytes`.</div><div id="229" class="line none">  229  */</div><div id="230" class="line none">  230 AWS_STATIC_IMPL</div><div id="231" class="line none">  231 const char *<a href="string.inl.html#24">aws_string_c_str</a>(const struct <a href="string.h.html#41">aws_string</a> *str);</div><div id="232" class="line none">  232 </div><div id="233" class="line none">  233 /**</div><div id="234" class="line none">  234  * Evaluates the set of properties that define the shape of all valid aws_string structures.</div><div id="235" class="line none">  235  * It is also a cheap check, in the sense it run in constant time (i.e., no loops or recursion).</div><div id="236" class="line none">  236  */</div><div id="237" class="line none">  237 AWS_STATIC_IMPL</div><div id="238" class="line none">  238 bool <a href="string.inl.html#34">aws_string_is_valid</a>(const struct <a href="string.h.html#41">aws_string</a> *str);</div><div id="239" class="line none">  239 </div><div id="240" class="line none">  240 /**</div><div id="241" class="line none">  241  * Best-effort checks aws_string invariants, when the str-&gt;len is unknown</div><div id="242" class="line none">  242  */</div><div id="243" class="line none">  243 AWS_STATIC_IMPL</div><div id="244" class="line none">  244 bool <a href="string.inl.html#42">aws_c_string_is_valid</a>(const char *str);</div><div id="245" class="line none">  245 </div><div id="246" class="line none">  246 /**</div><div id="247" class="line none">  247  * Evaluates if a char is a white character.</div><div id="248" class="line none">  248  */</div><div id="249" class="line none">  249 AWS_STATIC_IMPL</div><div id="250" class="line none">  250 bool <a href="string.inl.html#55">aws_char_is_space</a>(uint8_t c);</div><div id="251" class="line none">  251 </div><div id="252" class="line none">  252 #ifndef AWS_NO_STATIC_IMPL</div><div id="253" class="line none">  253 #    include &lt;aws/common/string.inl&gt;</div><div id="254" class="line none">  254 #endif /* AWS_NO_STATIC_IMPL */</div><div id="255" class="line none">  255 </div><div id="256" class="line none">  256 AWS_EXTERN_C_END</div><div id="257" class="line none">  257 </div><div id="258" class="line none">  258 #endif /* AWS_COMMON_STRING_H */</div>
</div>
</body>
</html>
